// ==UserScript==
// @name          KG_Latest_Games
// @namespace     klavogonki
// @version      1.8.5
// @description   Fast game creation buttons on all the pages
// @match         *://klavogonki.ru/*
// @author        Patcher
// @icon          https://www.google.com/s2/favicons?sz=64&domain=klavogonki.ru
// ==/UserScript==

(()=>{"use strict";var e={56:(e,t,a)=>{e.exports=function(e){var t=a.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function a(e){for(var a=-1,n=0;n<t.length;n++)if(t[n].identifier===e){a=n;break}return a}function n(e,n){for(var o={},s=[],i=0;i<e.length;i++){var l=e[i],c=n.base?l[0]+n.base:l[0],p=o[c]||0,g="".concat(c," ").concat(p);o[c]=p+1;var d=a(g),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(u);else{var m=r(u,n);n.byIndex=i,t.splice(i,0,{identifier:g,updater:m,references:1})}s.push(g)}return s}function r(e,t){var a=t.domAPI(t);a.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;a.update(e=t)}else a.remove()}}e.exports=function(e,r){var o=n(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var i=a(o[s]);t[i].references--}for(var l=n(e,r),c=0;c<o.length;c++){var p=a(o[c]);0===t[p].references&&(t[p].updater(),t.splice(p,1))}o=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a="",n=void 0!==t[5];return t[4]&&(a+="@supports (".concat(t[4],") {")),t[2]&&(a+="@media ".concat(t[2]," {")),n&&(a+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),a+=e(t),n&&(a+="}"),t[2]&&(a+="}"),t[4]&&(a+="}"),a})).join("")},t.i=function(e,a,n,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(n)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var p=[].concat(e[c]);n&&s[p[0]]||(void 0!==o&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=o),a&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=a):p[2]=a),r&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=r):p[4]="".concat(r)),t.push(p))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,a){var n=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(a)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(a){!function(e,t,a){var n="";a.supports&&(n+="@supports (".concat(a.supports,") {")),a.media&&(n+="@media ".concat(a.media," {"));var r=void 0!==a.layer;r&&(n+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),n+=a.css,r&&(n+="}"),a.media&&(n+="}"),a.supports&&(n+="}");var o=a.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,a)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},911:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(601),r=a.n(n),o=a(314),s=a.n(o)()(r());s.push([e.id,'.vocabulary-types-popup,.game-migration-popup,.vocabulary-creation-popup,.game-popup{position:fixed;display:flex;flex-direction:column;gap:5px;padding:5px;background-color:var(--rg-bg-primary);border:1px solid var(--rg-border-primary);border-radius:8px !important;box-shadow:0 2px 10px rgba(0,0,0,.1) !important;max-height:50vh;max-width:400px;overflow-y:auto;scrollbar-width:none;z-index:2000;user-select:none}.vocabulary-types-popup .popup-header-qualification,.game-migration-popup .popup-header-qualification,.vocabulary-creation-popup .popup-header-qualification,.game-popup .popup-header-qualification{display:flex;align-items:center;justify-content:center;width:16px;height:16px;cursor:pointer}.vocabulary-types-popup .popup-header,.game-migration-popup .popup-header,.vocabulary-creation-popup .popup-header,.game-popup .popup-header{display:inline-flex;font:600 14px "Montserrat",sans-serif;color:var(--rg-header-text);padding:6px;justify-content:space-between}.vocabulary-types-popup .popup-subheader,.game-migration-popup .popup-subheader,.vocabulary-creation-popup .popup-subheader,.game-popup .popup-subheader{font:600 14px "Montserrat",sans-serif;color:var(--rg-text-secondary);padding:6px}.vocabulary-types-popup .timeouts-container,.game-migration-popup .timeouts-container,.vocabulary-creation-popup .timeouts-container,.game-popup .timeouts-container{display:flex;flex-direction:row;gap:5px}.vocabulary-types-popup .timeouts-container .game-popup-button,.game-migration-popup .timeouts-container .game-popup-button,.vocabulary-creation-popup .timeouts-container .game-popup-button,.game-popup .timeouts-container .game-popup-button{display:inline-block;padding:5px 15px;font:600 14px "Montserrat",sans-serif;border-radius:4px !important;background:var(--rg-bg-card) !important;color:var(--rg-text-primary) !important;border:1.5px solid var(--rg-border-primary);cursor:pointer;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:left;text-decoration:none}.vocabulary-types-popup .timeouts-container .game-popup-button:hover,.vocabulary-types-popup .timeouts-container .game-popup-button:focus,.game-migration-popup .timeouts-container .game-popup-button:hover,.game-migration-popup .timeouts-container .game-popup-button:focus,.vocabulary-creation-popup .timeouts-container .game-popup-button:hover,.vocabulary-creation-popup .timeouts-container .game-popup-button:focus,.game-popup .timeouts-container .game-popup-button:hover,.game-popup .timeouts-container .game-popup-button:focus{border-color:var(--rg-border-hover);background:var(--rg-bg-hover);color:var(--rg-text-primary)}.vocabulary-types-popup .group-tab,.vocabulary-types-popup .popup-button,.game-migration-popup .group-tab,.game-migration-popup .popup-button,.vocabulary-creation-popup .group-tab,.vocabulary-creation-popup .popup-button,.game-popup .group-tab,.game-popup .popup-button{display:inline-flex;padding:5px 15px;min-height:30px;max-width:300px;font:600 14px "Montserrat",sans-serif;border-radius:4px !important;background:var(--rg-bg-card);color:var(--rg-text-primary);border:2px solid var(--rg-border-primary);cursor:pointer;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:fit-content;transition:border .1s ease,background-color .1s ease}.vocabulary-types-popup .group-tab:hover,.vocabulary-types-popup .group-tab:focus,.vocabulary-types-popup .popup-button:hover,.vocabulary-types-popup .popup-button:focus,.game-migration-popup .group-tab:hover,.game-migration-popup .group-tab:focus,.game-migration-popup .popup-button:hover,.game-migration-popup .popup-button:focus,.vocabulary-creation-popup .group-tab:hover,.vocabulary-creation-popup .group-tab:focus,.vocabulary-creation-popup .popup-button:hover,.vocabulary-creation-popup .popup-button:focus,.game-popup .group-tab:hover,.game-popup .group-tab:focus,.game-popup .popup-button:hover,.game-popup .popup-button:focus{border-color:var(--rg-border-hover);background:var(--rg-bg-hover);color:var(--rg-text-primary)}.vocabulary-types-popup .group-tab.active,.vocabulary-types-popup .popup-button.active,.game-migration-popup .group-tab.active,.game-migration-popup .popup-button.active,.vocabulary-creation-popup .group-tab.active,.vocabulary-creation-popup .popup-button.active,.game-popup .group-tab.active,.game-popup .popup-button.active{color:var(--rg-gametype-normal) !important;background-color:var(--rg-bg-card-pinned-normal) !important;border:2px solid var(--rg-border-pinned-normal) !important}.vocabulary-types-popup .group-tab.warning,.vocabulary-types-popup .popup-button.warning,.game-migration-popup .group-tab.warning,.game-migration-popup .popup-button.warning,.vocabulary-creation-popup .group-tab.warning,.vocabulary-creation-popup .popup-button.warning,.game-popup .group-tab.warning,.game-popup .popup-button.warning{color:var(--rg-gametype-chars) !important;background-color:var(--rg-bg-card-pinned-chars) !important;border:2px solid var(--rg-border-pinned-chars) !important}.vocabulary-types-popup .group-tab.danger,.vocabulary-types-popup .popup-button.danger,.game-migration-popup .group-tab.danger,.game-migration-popup .popup-button.danger,.vocabulary-creation-popup .group-tab.danger,.vocabulary-creation-popup .popup-button.danger,.game-popup .group-tab.danger,.game-popup .popup-button.danger{color:var(--rg-gametype-marathon) !important;background-color:var(--rg-bg-card-pinned-marathon) !important;border:2px solid var(--rg-border-pinned-marathon) !important}.vocabulary-types-popup .rank-slider-container,.game-migration-popup .rank-slider-container,.vocabulary-creation-popup .rank-slider-container,.game-popup .rank-slider-container{display:flex;flex-direction:column;align-items:stretch;margin:6px}.vocabulary-types-popup .rank-slider-container .rank-slider-display,.game-migration-popup .rank-slider-container .rank-slider-display,.vocabulary-creation-popup .rank-slider-container .rank-slider-display,.game-popup .rank-slider-container .rank-slider-display{margin:0 0 12px;font:600 14px "Montserrat",sans-serif;color:var(--rg-text-secondary)}.vocabulary-types-popup .rank-slider-container .rank-slider-track,.game-migration-popup .rank-slider-container .rank-slider-track,.vocabulary-creation-popup .rank-slider-container .rank-slider-track,.game-popup .rank-slider-container .rank-slider-track{position:relative;height:8px;background:var(--rg-rank-slider-track-bg);border-radius:4px !important;cursor:pointer;border:2px solid var(--rg-rank-slider-border);box-sizing:border-box}.vocabulary-types-popup .rank-slider-container .rank-slider-range,.game-migration-popup .rank-slider-container .rank-slider-range,.vocabulary-creation-popup .rank-slider-container .rank-slider-range,.game-popup .rank-slider-container .rank-slider-range{position:absolute;height:100%;background:var(--rg-rank-slider-range);border-radius:4px !important;z-index:1}.vocabulary-types-popup .rank-slider-container .rank-slider-handle,.game-migration-popup .rank-slider-container .rank-slider-handle,.vocabulary-creation-popup .rank-slider-container .rank-slider-handle,.game-popup .rank-slider-container .rank-slider-handle{position:absolute;top:50%;width:18px;height:18px;background:var(--rg-rank-slider-handle-bg);border:2px solid var(--rg-rank-slider-border);border-radius:50% !important;transform:translate(-50%, -50%);z-index:2;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.08) !important;transition:border-color .2s,background .2s}.vocabulary-types-popup .rank-slider-container .rank-slider-handle:focus,.game-migration-popup .rank-slider-container .rank-slider-handle:focus,.vocabulary-creation-popup .rank-slider-container .rank-slider-handle:focus,.game-popup .rank-slider-container .rank-slider-handle:focus{outline:none;border-color:var(--rg-rank-slider-border-focus)}.vocabulary-types-popup .rank-slider-container .rank-slider-handle.overlap-left,.game-migration-popup .rank-slider-container .rank-slider-handle.overlap-left,.vocabulary-creation-popup .rank-slider-container .rank-slider-handle.overlap-left,.game-popup .rank-slider-container .rank-slider-handle.overlap-left{transform:translate(-100%, -50%)}.vocabulary-types-popup .rank-slider-container .rank-slider-handle.overlap-right,.game-migration-popup .rank-slider-container .rank-slider-handle.overlap-right,.vocabulary-creation-popup .rank-slider-container .rank-slider-handle.overlap-right,.game-popup .rank-slider-container .rank-slider-handle.overlap-right{transform:translate(0, -50%)}.latest-games-search-container{position:relative;margin:10px 10px 0;display:flex;flex-direction:row;align-items:center}.latest-games-search-container.latest-games-hidden{display:none}.latest-games-search-container #latest-games-search-input{width:100%;box-sizing:border-box;padding:8px 12px;font-size:15px;font-family:"Montserrat",sans-serif;border:1.5px solid var(--rg-border-primary);border-radius:6px !important;background:var(--rg-bg-card);color:var(--rg-text-primary);outline:none;transition:border-color .2s,background .2s,color .2s}.latest-games-search-container #latest-games-search-input:focus{border-color:var(--rg-border-hover);background:var(--rg-bg-hover);color:var(--rg-text-primary)}.latest-games-search-container .latest-games-clear-btn{position:absolute;top:50%;transform:translateY(-50%);width:24px;height:24px;border:none;outline:none;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:opacity .15s ease;z-index:1}.latest-games-search-container .latest-games-clear-btn svg{width:14px;height:14px}.latest-games-search-container .latest-games-clear-btn.visible{opacity:1;visibility:visible}.latest-games-search-noresults{display:inline-flex;padding:5px 15px;max-width:300px;font:500 14px "Montserrat",sans-serif;border-radius:4px !important;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:auto;justify-content:center;align-items:center;color:var(--rg-gametype-marathon);border:2px solid var(--rg-border-pinned-marathon);background-color:var(--rg-bg-card-pinned-marathon)}.latest-games-search-more{display:inline-flex;padding:5px 15px;max-width:300px;font:500 14px "Montserrat",sans-serif;border-radius:4px !important;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:auto;justify-content:center;align-items:center;color:var(--rg-gametype-chars);border:2px solid var(--rg-border-pinned-chars);background-color:var(--rg-bg-card-pinned-chars);cursor:pointer}.games-data-container .indicator{transition:.2s ease-in-out;font-family:"Montserrat",sans-serif;font-size:1.5em;font-weight:500;font-variant-numeric:tabular-nums;padding:8px;display:flex;justify-content:flex-start;align-items:center;cursor:default;border-radius:.2em !important;height:fit-content}.games-data-container{position:fixed;display:flex;flex-direction:row;top:50px;right:5px;gap:5px;user-select:none;z-index:2000}.games-data-container .period-indicators-container{display:flex;flex-direction:row;gap:5px}.games-data-container .period-indicators-container .period-indicator-description{padding-right:5px;font-family:"Montserrat",sans-serif;font-size:.5em;font-weight:600;text-transform:uppercase}.games-data-container .sleep-start-indicator{color:hsl(88,50%,55%);background-color:hsl(88,40%,20%);border:1px solid hsl(88,45%,35%)}.games-data-container .sleep-replay-indicator{color:hsl(208,50%,70%);background-color:hsl(208,40%,25%);border:1px solid hsl(208,45%,50%)}.games-data-container .remaining-count-indicator{color:hsl(50,0%,75%);background-color:hsl(50,0%,15%);border:1px solid hsl(50,0%,30%)}.games-data-container .today-play-count-indicator{color:hsl(30,60%,65%);background-color:hsl(30,45%,20%);border:1px solid #963;cursor:pointer}.games-data-container .week-play-count-indicator{color:hsl(150,60%,65%);background-color:hsl(150,45%,20%);border:1px solid #396}.games-data-container .month-play-count-indicator{color:hsl(340,55%,65%);background-color:hsl(340,40%,20%);border:1px solid hsl(340,45%,40%)}.games-data-container .year-play-count-indicator{color:hsl(200,55%,65%);background-color:hsl(200,40%,20%);border:1px solid hsl(200,45%,40%)}.games-data-container .period-indicator:not(.show){display:none !important}.games-data-container .period-indicator.show{display:flex !important;animation:fallDown 320ms cubic-bezier(0.22, 0.9, 0.31, 1) both;animation-delay:var(--fall-delay, 0ms)}@keyframes fallDown{0%{transform:translateY(-20px) scaleY(0.98);opacity:0}100%{transform:translateY(0) scaleY(1);opacity:1}}.vocabulary-tooltip-popup{font:500 14px "Montserrat",sans-serif;position:fixed;background:var(--rg-bg-primary);color:var(--rg-text-primary);padding:.5em;z-index:1200;font-size:.9em;pointer-events:auto;white-space:pre-wrap;border:1px solid var(--rg-border-primary) !important;border-radius:4px !important;box-shadow:0 2px 5px rgba(0,0,0,.3) !important;max-width:700px;width:auto;max-height:400px;overflow-y:auto;overflow-x:hidden;scrollbar-width:thin;scrollbar-color:var(--rg-text-tertiary) var(--rg-bg-primary);word-wrap:break-word;overflow-wrap:break-word}.vocabulary-tooltip-popup .tooltip-number{color:var(--rg-text-secondary);opacity:.8}.vocabulary-tooltip-popup::-webkit-scrollbar{width:8px;height:8px}.vocabulary-tooltip-popup::-webkit-scrollbar-track{background:var(--rg-bg-primary) !important}.vocabulary-tooltip-popup::-webkit-scrollbar-thumb{background-color:var(--rg-text-tertiary) !important}.vocabulary-tooltip-popup::-webkit-scrollbar-thumb:hover{background-color:var(--rg-text-secondary) !important}.vocabularies-manager-popup{position:fixed;background:var(--rg-bg-primary);color:var(--rg-text-primary);padding:1em;z-index:1200;font-size:.9em;font-family:"Montserrat","Noto Color Emoji",sans-serif !important;pointer-events:auto;white-space:nowrap;border:1px solid var(--rg-border-primary) !important;border-radius:4px !important;box-shadow:0 2px 5px rgba(0,0,0,.3) !important;min-width:300px;max-width:500px;overflow-y:auto;overflow-x:hidden;scrollbar-width:thin;scrollbar-color:var(--rg-border-hover) var(--rg-bg-primary)}.vocabularies-manager-popup .popup-header{font-weight:600 !important;color:var(--rg-text-primary) !important;margin-bottom:.8em !important;padding-bottom:.5em;border-bottom:1px solid var(--rg-border-primary);font-size:1.1em;position:relative}.vocabularies-manager-popup .popup-actions{display:flex;justify-content:flex-start;align-items:center;margin-bottom:.8em;padding-bottom:.5em;border-bottom:1px solid var(--rg-border-primary);gap:.5em;flex-wrap:wrap}.vocabularies-manager-popup .popup-actions .copy-all-btn,.vocabularies-manager-popup .popup-actions .remove-all-btn,.vocabularies-manager-popup .popup-actions .sort-all-btn,.vocabularies-manager-popup .popup-actions .force-fetch-btn,.vocabularies-manager-popup .popup-actions .save-btn,.vocabularies-manager-popup .popup-actions .revert-btn{background:var(--rg-bg-card);border-radius:3px !important;padding:.4em .8em;font-size:.85em;font-weight:500;cursor:pointer;transition:all .2s ease;font-family:inherit}.vocabularies-manager-popup .popup-actions .copy-all-btn:disabled,.vocabularies-manager-popup .popup-actions .remove-all-btn:disabled,.vocabularies-manager-popup .popup-actions .sort-all-btn:disabled,.vocabularies-manager-popup .popup-actions .force-fetch-btn:disabled,.vocabularies-manager-popup .popup-actions .save-btn:disabled,.vocabularies-manager-popup .popup-actions .revert-btn:disabled{opacity:.5;cursor:not-allowed}.vocabularies-manager-popup .popup-actions .copy-all-btn{color:hsl(var(--rg-popup-btn-copy));border:1px solid hsla(var(--rg-popup-btn-copy)/0.5)}.vocabularies-manager-popup .popup-actions .copy-all-btn:hover{background:hsla(var(--rg-popup-btn-copy)/0.15);border-color:hsl(var(--rg-popup-btn-copy))}.vocabularies-manager-popup .popup-actions .copy-all-btn:active{background:hsla(var(--rg-popup-btn-copy)/0.25)}.vocabularies-manager-popup .popup-actions .remove-all-btn{color:hsl(var(--rg-popup-btn-remove));border:1px solid hsla(var(--rg-popup-btn-remove)/0.5)}.vocabularies-manager-popup .popup-actions .remove-all-btn:hover:not(:disabled){background:hsla(var(--rg-popup-btn-remove)/0.15);border-color:hsl(var(--rg-popup-btn-remove))}.vocabularies-manager-popup .popup-actions .remove-all-btn:active:not(:disabled){background:hsla(var(--rg-popup-btn-remove)/0.25)}.vocabularies-manager-popup .popup-actions .sort-all-btn{color:hsl(var(--rg-popup-btn-sort));border:1px solid hsla(var(--rg-popup-btn-sort)/0.5)}.vocabularies-manager-popup .popup-actions .sort-all-btn:hover:not(:disabled){background:hsla(var(--rg-popup-btn-sort)/0.15);border-color:hsl(var(--rg-popup-btn-sort))}.vocabularies-manager-popup .popup-actions .sort-all-btn:active:not(:disabled){background:hsla(var(--rg-popup-btn-sort)/0.25)}.vocabularies-manager-popup .popup-actions .force-fetch-btn{color:hsl(var(--rg-popup-btn-fetch));border:1px solid hsla(var(--rg-popup-btn-fetch)/0.5)}.vocabularies-manager-popup .popup-actions .force-fetch-btn:hover:not(:disabled){background:hsla(var(--rg-popup-btn-fetch)/0.15);border-color:hsl(var(--rg-popup-btn-fetch))}.vocabularies-manager-popup .popup-actions .force-fetch-btn:active:not(:disabled){background:hsla(var(--rg-popup-btn-fetch)/0.25)}.vocabularies-manager-popup .popup-actions .save-btn{color:hsl(var(--rg-popup-btn-save));border:1px solid hsla(var(--rg-popup-btn-save)/0.5);font-weight:600;box-shadow:0 0 8px hsla(var(--rg-popup-btn-save)/0.3)}.vocabularies-manager-popup .popup-actions .save-btn:hover:not(:disabled){background:hsla(var(--rg-popup-btn-save)/0.15);border-color:hsl(var(--rg-popup-btn-save));box-shadow:0 0 12px hsla(var(--rg-popup-btn-save)/0.5)}.vocabularies-manager-popup .popup-actions .save-btn:active:not(:disabled){background:hsla(var(--rg-popup-btn-save)/0.25);box-shadow:0 0 6px hsla(var(--rg-popup-btn-save)/0.4)}.vocabularies-manager-popup .popup-actions .revert-btn{color:hsl(var(--rg-popup-btn-revert));border:1px solid hsla(var(--rg-popup-btn-revert)/0.5)}.vocabularies-manager-popup .popup-actions .revert-btn:hover:not(:disabled){background:hsla(var(--rg-popup-btn-revert)/0.15);border-color:hsl(var(--rg-popup-btn-revert))}.vocabularies-manager-popup .popup-actions .revert-btn:active:not(:disabled){background:hsla(var(--rg-popup-btn-revert)/0.25)}.vocabularies-manager-popup .popup-search-filters{padding:.5em 0;margin-bottom:.5em;border-bottom:1px solid var(--rg-border-primary);display:flex;flex-direction:column;gap:.6em}.vocabularies-manager-popup .popup-search-filters .search-input{width:100%;background:var(--rg-bg-card);color:var(--rg-text-primary);border:1px solid var(--rg-border-primary);border-radius:3px !important;padding:.5em .7em;font-size:.85em;font-family:inherit;transition:all .2s ease}.vocabularies-manager-popup .popup-search-filters .search-input:focus{outline:none;border-color:var(--rg-border-hover);background:var(--rg-bg-hover)}.vocabularies-manager-popup .popup-search-filters .search-input::placeholder{color:var(--rg-text-tertiary);font-style:italic}.vocabularies-manager-popup .popup-search-filters .filter-buttons{display:flex;gap:.4em;justify-content:flex-start;flex-wrap:wrap}.vocabularies-manager-popup .popup-search-filters .filter-buttons .filter-btn{background:var(--rg-bg-card);color:var(--rg-text-secondary);border:1px solid var(--rg-border-primary);border-radius:3px !important;padding:.35em .7em;font-size:.8em;font-weight:500;cursor:pointer;transition:all .2s ease;font-family:inherit;white-space:nowrap}.vocabularies-manager-popup .popup-search-filters .filter-buttons .filter-btn:hover{background:var(--rg-bg-hover);border-color:var(--rg-border-hover);color:var(--rg-text-primary)}.vocabularies-manager-popup .popup-search-filters .filter-buttons .filter-btn:active{background:var(--rg-bg-secondary);transform:translateY(1px)}.vocabularies-manager-popup .popup-search-filters .filter-buttons .filter-btn.active{background:hsl(var(--rg-popup-btn-save)) !important;color:var(--rg-bg-primary) !important;border-color:hsl(var(--rg-popup-btn-save)) !important;box-shadow:0 1px 3px hsla(var(--rg-popup-btn-save)/0.3)}.vocabularies-manager-popup .popup-search-filters .filter-buttons .filter-btn.active:hover{background:hsla(var(--rg-popup-btn-save)/0.9) !important;border-color:hsl(var(--rg-popup-btn-save)) !important}.vocabularies-manager-popup .popup-search-filters .filter-buttons .filter-btn.active:active{background:hsla(var(--rg-popup-btn-save)/0.8) !important;transform:translateY(1px)}.vocabularies-manager-popup .vocab-list{display:flex;flex-direction:column;gap:.3em;max-height:60vh;overflow-y:auto;overflow-x:hidden}.vocabularies-manager-popup .vocab-list .vocab-labels-container{padding:.5em .7em;margin:.6em 0 .3em 0;background:hsl(var(--rg-popup-item-new));border-radius:2px;position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center;gap:1em;font-family:"Montserrat","Noto Color Emoji",sans-serif}.vocabularies-manager-popup .vocab-list .vocab-labels-container .vocab-date,.vocabularies-manager-popup .vocab-list .vocab-labels-container .vocab-count{font-weight:600;font-size:.85em;color:var(--rg-bg-primary)}.vocabularies-manager-popup .vocab-list .vocab-item{display:flex;justify-content:space-between;align-items:center;padding:.4em .6em;background:var(--rg-bg-card);border:1px solid var(--rg-border-primary);border-radius:3px !important;transition:all .2s ease;gap:.8em}.vocabularies-manager-popup .vocab-list .vocab-item:hover{background:var(--rg-bg-hover);border-color:var(--rg-border-hover)}.vocabularies-manager-popup .vocab-list .vocab-item.vocab-item-new{background:hsla(var(--rg-popup-item-new)/0.15) !important;border:1px solid hsla(var(--rg-popup-item-new)/0.6) !important}.vocabularies-manager-popup .vocab-list .vocab-item.vocab-item-new:hover{background:hsla(var(--rg-popup-item-new)/0.25) !important;border-color:hsl(var(--rg-popup-item-new)) !important}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-left{display:inline-flex;align-items:center;flex-shrink:0}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-left .vocab-play-count-badge{display:inline-flex;align-items:center;justify-content:center;margin-left:.5em;padding:4px 8px;background:var(--rg-vocab-badge-bg);color:var(--rg-vocab-badge-text);border-radius:6px;font-size:1em;font-weight:600;font-family:"Montserrat","Courier New",monospace}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-left .vocab-play-btn,.vocabularies-manager-popup .vocab-list .vocab-item .vocab-left .vocab-info-btn{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;margin-right:.5em;padding:0;background:rgba(0,0,0,0);border:none;outline:none;appearance:none;cursor:pointer;border-radius:4px;transition:background .15s ease;color:var(--rg-text-secondary)}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-left .vocab-play-btn svg,.vocabularies-manager-popup .vocab-list .vocab-item .vocab-left .vocab-info-btn svg{width:16px;height:16px}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-left .vocab-play-btn:hover,.vocabularies-manager-popup .vocab-list .vocab-item .vocab-left .vocab-info-btn:hover{background:var(--rg-vocab-play-hover-bg);color:var(--rg-bg-primary)}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-left .vocab-id{color:var(--rg-text-primary);font-weight:500;font-family:"Montserrat","Courier New",monospace;font-size:.9em}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-right{flex:1;min-width:0;text-align:right}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-right .vocab-name{color:var(--rg-text-secondary);font-size:.85em;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-right .vocab-author,.vocabularies-manager-popup .vocab-list .vocab-item .vocab-right .vocab-type{color:var(--rg-text-tertiary);font-size:.75em;margin-top:.2em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vocabularies-manager-popup .vocab-list .vocab-item .vocab-right .vocab-loading{color:hsl(var(--rg-popup-btn-fetch));font-size:.8em;font-style:italic}.vocabularies-manager-popup .vocab-list .vocab-item .remove-btn{flex-shrink:0;background:rgba(0,0,0,0);color:hsl(var(--rg-popup-btn-remove));border:1px solid hsla(var(--rg-popup-btn-remove)/0.5);border-radius:3px !important;padding:.2em .5em;font-size:.8em;cursor:pointer;transition:all .2s ease;font-weight:500;font-family:inherit;min-width:60px}.vocabularies-manager-popup .vocab-list .vocab-item .remove-btn:hover{background:hsla(var(--rg-popup-btn-remove)/0.15);color:hsl(var(--rg-popup-btn-remove));border-color:hsl(var(--rg-popup-btn-remove))}.vocabularies-manager-popup .vocab-list .vocab-item .remove-btn:active{background:hsla(var(--rg-popup-btn-remove)/0.25)}.vocabularies-manager-popup .empty-state{text-align:center;color:var(--rg-text-tertiary);font-style:italic;padding:1em 0}.vocabularies-manager-popup::-webkit-scrollbar{width:8px;height:8px}.vocabularies-manager-popup::-webkit-scrollbar-track{background:var(--rg-bg-primary) !important}.vocabularies-manager-popup::-webkit-scrollbar-thumb{background-color:var(--rg-border-hover) !important}.vocabularies-manager-popup::-webkit-scrollbar-thumb:hover{background-color:var(--rg-text-secondary) !important}.vocabularies-manager-popup .vocab-list::-webkit-scrollbar{width:6px}.vocabularies-manager-popup .vocab-list::-webkit-scrollbar-track{background:var(--rg-bg-card) !important}.vocabularies-manager-popup .vocab-list::-webkit-scrollbar-thumb{background-color:var(--rg-border-hover) !important;border-radius:3px}.vocabularies-manager-popup .vocab-list::-webkit-scrollbar-thumb:hover{background-color:var(--rg-text-secondary) !important}:root.latest-games-light-theme{--rg-bg-primary:#fff;--rg-bg-secondary:hsl(0,0%,98%);--rg-bg-card:hsl(0,0%,98%);--rg-bg-card-pinned:hsl(120,50%,96%);--rg-bg-hover:hsl(0,0%,96%);--rg-border-primary:hsl(0,0%,88%);--rg-border-hover:hsl(0,0%,74%);--rg-border-pinned:hsl(122,39%,49%);--rg-text-primary:hsl(0,0%,15%);--rg-text-secondary:#666;--rg-text-tertiary:hsl(0,0%,55%);--rg-text-options:hsl(0,0%,30%);--rg-enabled-yellow:#960;--rg-bg-enabled-yellow:rgba(204,136,0,.2);--rg-enabled-blue:hsl(215,75%,50%);--rg-bg-enabled-blue:hsla(215,75%,50%,.2);--rg-gametype-voc:hsl(215,75%,50%);--rg-gametype-normal:hsl(130,50%,30%);--rg-gametype-abra:hsl(215,20%,40%);--rg-gametype-referats:hsl(80,55%,30%);--rg-gametype-noerror:hsl(200,45%,35%);--rg-gametype-marathon:hsl(340,65%,45%);--rg-gametype-chars:rgb(153,89.25,0);--rg-gametype-digits:hsl(0,0%,50%);--rg-gametype-sprint:hsl(5,40%,40%);--rg-icon-primary:currentColor;--rg-icon-delete:hsl(4,90%,58%);--rg-bg-hover-delete:hsla(4,90%,58%,.2);--rg-icon-pin:hsl(122,39%,49%);--rg-bg-hover-pin:hsla(122,39%,49%,.2);--rg-icon-info:hsl(0,0%,55%);--rg-bg-hover-info:hsla(0,0%,55%,.2);--rg-icon-edit:#c90;--rg-bg-hover-edit:rgba(204,153,0,.2);--rg-icon-theme-sun:hsl(48,100%,41%);--rg-icon-theme-moon:hsl(207,89%,76%);--rg-hover-control:hsl(0,0%,92%);--rg-hover-control-btn:hsl(213,77%,96%);--rg-bg-card-pinned-voc:hsl(215,80%,95%);--rg-border-pinned-voc:hsl(215,80%,80%);--rg-bg-card-pinned-normal:hsl(130,50%,90%);--rg-border-pinned-normal:hsl(130,50%,70%);--rg-bg-card-pinned-abra:hsl(215,20%,90%);--rg-border-pinned-abra:hsl(215,20%,70%);--rg-bg-card-pinned-referats:hsl(80,55%,90%);--rg-border-pinned-referats:hsl(80,55%,70%);--rg-bg-card-pinned-noerror:hsl(200,45%,90%);--rg-border-pinned-noerror:hsl(200,45%,70%);--rg-bg-card-pinned-marathon:hsl(340,65%,90%);--rg-border-pinned-marathon:hsl(340,65%,70%);--rg-bg-card-pinned-chars:hsl(35,100%,90%);--rg-border-pinned-chars:hsl(35,100%,70%);--rg-bg-card-pinned-digits:hsl(0,0%,90%);--rg-border-pinned-digits:hsl(0,0%,70%);--rg-bg-card-pinned-sprint:hsl(5,40%,90%);--rg-border-pinned-sprint:hsl(5,40%,70%);--rg-bg-tab:hsl(0,0%,97%);--rg-bg-tab-hover:hsl(0,0%,94%);--rg-bg-tab-active:#fff;--rg-icon-accent:hsl(215,75%,50%);--rg-qualification-icon:hsl(48,100%,41%);--rg-panel-toggle-background:hsl(215,80%,95%);--rg-panel-toggle-stroke:hsl(215,75%,50%);--rg-panel-toggle-border:hsl(215,80%,80%);--rg-panel-toggle-bg-hover:hsl(215,80%,88%);--rg-header-text:hsl(77,100%,30%);--rg-rank-slider-track-bg:hsl(215,80%,95%);--rg-rank-slider-border:hsl(215,80%,80%);--rg-rank-slider-range:hsl(215,80%,80%);--rg-rank-slider-handle-bg:hsl(215,80%,95%);--rg-rank-slider-border-focus:hsl(215,80%,60%);--rg-popup-btn-copy:215 75% 45%;--rg-popup-btn-remove:4 90% 45%;--rg-popup-btn-sort:130 50% 35%;--rg-popup-btn-fetch:40 100% 35%;--rg-popup-btn-save:195 75% 40%;--rg-popup-btn-revert:30 100% 40%;--rg-popup-item-new:120 30% 50%;--rg-vocab-badge-bg:hsla(195,75%,40%,.9);--rg-vocab-badge-text:hsl(0,0%,95%);--rg-vocab-play-hover-bg:hsl(30,75%,50%)}:root.latest-games-dark-theme{--rg-bg-primary:hsl(210,10%,11%);--rg-bg-secondary:hsl(220,10%,15%);--rg-bg-card:hsl(220,10%,15%);--rg-bg-card-pinned:hsl(140,20%,15%);--rg-bg-hover:hsl(220,10%,15%);--rg-border-primary:hsl(220,10%,15%);--rg-border-hover:hsl(0,0%,38%);--rg-border-pinned:hsl(133,43%,47%);--rg-text-primary:hsl(0,0%,88%);--rg-text-secondary:hsl(0,0%,88%);--rg-text-tertiary:hsl(0,0%,88%);--rg-text-options:hsl(0,0%,88%);--rg-enabled-yellow:#fc0;--rg-bg-enabled-yellow:rgba(255,204,0,.2);--rg-enabled-blue:hsl(207,89%,76%);--rg-bg-enabled-blue:hsla(207,89%,76%,.2);--rg-gametype-voc:hsl(215,80%,65%);--rg-gametype-normal:#6c7;--rg-gametype-abra:hsl(215,20%,60%);--rg-gametype-referats:hsl(80,55%,40%);--rg-gametype-noerror:hsl(200,45%,65%);--rg-gametype-marathon:hsl(340,70%,55%);--rg-gametype-chars:hsl(35,100%,45%);--rg-gametype-digits:hsl(0,0%,50%);--rg-gametype-sprint:hsl(5,40%,60%);--rg-icon-primary:hsl(207,89%,76%);--rg-icon-delete:hsl(4,100%,75%);--rg-bg-hover-delete:hsla(4,100%,75%,.2);--rg-icon-pin:hsl(133,43%,47%);--rg-bg-hover-pin:hsla(133,43%,47%,.2);--rg-icon-info:hsl(0,0%,88%);--rg-bg-hover-info:hsla(0,0%,88%,.2);--rg-icon-edit:#fc3;--rg-bg-hover-edit:rgba(255,204,51,.2);--rg-icon-theme-sun:#fc0;--rg-icon-theme-moon:hsl(207,89%,76%);--rg-hover-control:hsl(0,0%,38%);--rg-hover-control-btn:hsl(213,81.6%,29.8%);--rg-bg-card-pinned-voc:hsl(215,80%,10%);--rg-border-pinned-voc:hsl(215,80%,30%);--rg-bg-card-pinned-normal:hsl(130,50%,10%);--rg-border-pinned-normal:hsl(130,50%,30%);--rg-bg-card-pinned-abra:hsl(215,20%,10%);--rg-border-pinned-abra:hsl(215,20%,30%);--rg-bg-card-pinned-referats:hsl(80,55%,10%);--rg-border-pinned-referats:hsl(80,55%,30%);--rg-bg-card-pinned-noerror:hsl(200,45%,10%);--rg-border-pinned-noerror:hsl(200,45%,30%);--rg-bg-card-pinned-marathon:hsl(340,65%,10%);--rg-border-pinned-marathon:hsl(340,65%,30%);--rg-bg-card-pinned-chars:#320;--rg-border-pinned-chars:#960;--rg-bg-card-pinned-digits:hsl(0,0%,10%);--rg-border-pinned-digits:hsl(0,0%,30%);--rg-bg-card-pinned-sprint:hsl(5,40%,10%);--rg-border-pinned-sprint:hsl(5,40%,30%);--rg-bg-tab:hsl(220,10%,15%);--rg-bg-tab-hover:hsl(220,10%,18%);--rg-bg-tab-active:hsl(210,10%,11%);--rg-icon-accent:hsl(207,89%,76%);--rg-qualification-icon:#fc0;--rg-panel-toggle-background:hsl(215,80%,20%);--rg-panel-toggle-stroke:hsl(215,80%,65%);--rg-panel-toggle-border:hsl(215,80%,30%);--rg-panel-toggle-bg-hover:hsl(215,80%,25%);--rg-header-text:#fc0;--rg-rank-slider-track-bg:hsl(215,80%,10%);--rg-rank-slider-border:hsl(215,80%,30%);--rg-rank-slider-range:hsl(215,80%,30%);--rg-rank-slider-handle-bg:hsl(215,80%,10%);--rg-rank-slider-border-focus:hsl(215,80%,50%);--rg-popup-btn-copy:195 53% 79%;--rg-popup-btn-remove:0 90% 75%;--rg-popup-btn-sort:120 90% 70%;--rg-popup-btn-fetch:40 100% 70%;--rg-popup-btn-save:195 100% 70%;--rg-popup-btn-revert:30 100% 70%;--rg-popup-item-new:120 40% 40%;--rg-vocab-badge-bg:hsla(195,100%,70%,.9);--rg-vocab-badge-text:hsl(0,0%,11%);--rg-vocab-play-hover-bg:hsl(30,100%,70%)}#latest-games-container{display:flex;flex-direction:column;font-family:"Montserrat",sans-serif;position:fixed;top:50px;width:auto;min-width:200px;max-width:330px;background-color:var(--rg-bg-primary);border:1px solid var(--rg-border-primary);border-left:none;border-radius:0 8px 8px 0 !important;box-shadow:2px 0 10px rgba(0,0,0,.1) !important;z-index:1020;padding:10px 0;opacity:0;pointer-events:none;user-select:none;transition:left .3s ease,opacity .3s ease;overflow:hidden;color:var(--rg-text-primary)}#latest-games-container #latest-games-content{overflow-y:auto;overflow-x:hidden;scrollbar-width:none;height:calc(100% - 40px);width:100%}#latest-games-container.visible{left:0 !important;opacity:1;pointer-events:auto;user-select:auto}#latest-games-container.display-mode-wrap{max-width:none;width:95vw;display:flex;flex-direction:row;flex-wrap:wrap;align-items:flex-start;position:fixed}#latest-games-container.display-mode-wrap .latest-games-controls{flex-direction:row}#latest-games-container #latest-games{margin:0;position:relative;padding:0;list-style:none;display:flex;flex-direction:column;gap:5px}#latest-games-container #latest-games .group-header{display:inline-flex;padding:5px 15px;min-height:30px;max-width:300px;font:600 14px "Montserrat",sans-serif;border-radius:4px !important;background:var(--rg-bg-card);color:var(--rg-text-primary);border:2px solid var(--rg-border-primary);cursor:pointer;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:fit-content;transition:border .1s ease,background-color .1s ease;width:100%;margin:0 10px}#latest-games-container #latest-games .group-header:hover,#latest-games-container #latest-games .group-header:focus{border-color:var(--rg-border-hover);background:var(--rg-bg-hover);color:var(--rg-text-primary)}#latest-games-container #latest-games .group-header.active{color:var(--rg-gametype-normal) !important;background-color:var(--rg-bg-card-pinned-normal) !important;border:2px solid var(--rg-border-pinned-normal) !important}#latest-games-container #latest-games .group-header.warning{color:var(--rg-gametype-chars) !important;background-color:var(--rg-bg-card-pinned-chars) !important;border:2px solid var(--rg-border-pinned-chars) !important}#latest-games-container #latest-games .group-header.danger{color:var(--rg-gametype-marathon) !important;background-color:var(--rg-bg-card-pinned-marathon) !important;border:2px solid var(--rg-border-pinned-marathon) !important}#latest-games-container #latest-games.display-mode-wrap{display:flex;flex-direction:row;flex-wrap:wrap;max-height:none;margin:0 10px}#latest-games-container #latest-games.display-mode-wrap .latest-game,#latest-games-container #latest-games.display-mode-wrap .group-header{margin:0 !important;max-width:none}#latest-games-container #latest-games .latest-game{position:relative;margin:0 10px;border:2px solid var(--rg-border-primary);border-radius:4px !important;background-color:var(--rg-bg-card);transition:border .1s ease,background-color .1s ease;display:inline-flex;max-width:300px}#latest-games-container #latest-games .latest-game.pin-game{cursor:move}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-voc{border:2px solid var(--rg-border-pinned-voc);background-color:var(--rg-bg-card-pinned-voc)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-normal{border:2px solid var(--rg-border-pinned-normal);background-color:var(--rg-bg-card-pinned-normal)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-abra{border:2px solid var(--rg-border-pinned-abra);background-color:var(--rg-bg-card-pinned-abra)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-referats{border:2px solid var(--rg-border-pinned-referats);background-color:var(--rg-bg-card-pinned-referats)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-noerror{border:2px solid var(--rg-border-pinned-noerror);background-color:var(--rg-bg-card-pinned-noerror)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-marathon{border:2px solid var(--rg-border-pinned-marathon);background-color:var(--rg-bg-card-pinned-marathon)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-chars{border:2px solid var(--rg-border-pinned-chars);background-color:var(--rg-bg-card-pinned-chars)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-digits{border:2px solid var(--rg-border-pinned-digits);background-color:var(--rg-bg-card-pinned-digits)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-sprint{border:2px solid var(--rg-border-pinned-sprint);background-color:var(--rg-bg-card-pinned-sprint)}#latest-games-container #latest-games .latest-game:hover{border-color:var(--rg-border-hover);background-color:var(--rg-bg-hover)}#latest-games-container #latest-games .latest-game.dragging{opacity:.7;z-index:1021;transition:transform .1s ease}#latest-games-container #latest-games .latest-game.display-mode-wrap{margin:0}#latest-games-container #latest-games .latest-game a{display:block;width:100%;padding:5px 15px;text-decoration:none;color:inherit}#latest-games-container #latest-games .latest-game .latest-game-name{display:flex;font-weight:bold;font-size:12px;margin-bottom:2px;align-items:center}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-voc{color:var(--rg-gametype-voc) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-normal{color:var(--rg-gametype-normal) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-abra{color:var(--rg-gametype-abra) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-referats{color:var(--rg-gametype-referats) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-noerror{color:var(--rg-gametype-noerror) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-marathon{color:var(--rg-gametype-marathon) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-chars{color:var(--rg-gametype-chars) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-digits{color:var(--rg-gametype-digits) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-sprint{color:var(--rg-gametype-sprint) !important}#latest-games-container #latest-games .latest-game .latest-game-description{display:inline-flex;font-size:10px;color:var(--rg-text-secondary)}#latest-games-container #latest-games .latest-game .latest-game-qual,#latest-games-container #latest-games .latest-game .latest-game-state-icon{display:inline-flex;align-items:center;justify-content:center;margin-left:4px}#latest-games-container #latest-games .latest-game .latest-game-qual svg,#latest-games-container #latest-games .latest-game .latest-game-state-icon svg{width:14px;height:14px}#latest-games-container #latest-games .latest-game .latest-game-levels{display:block;font-size:9px;color:var(--rg-text-tertiary);margin-top:1px}#latest-games-container #latest-games .latest-game .latest-game-buttons{position:absolute;display:flex;flex-direction:row;justify-content:center;align-items:center;gap:2px;top:0;right:0;transform:translateY(-100%);background-color:var(--rg-bg-card);border-radius:4px !important;border:2px solid var(--rg-border-primary);box-shadow:0 1px 4px rgba(0,0,0,.2) !important;visibility:hidden}#latest-games-container #latest-games .latest-game:hover .latest-game-buttons{opacity:1}#latest-games-container #latest-games .latest-game .latest-game-pin{width:24px;height:24px;cursor:pointer;border-radius:2px !important;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease;background-color:rgba(0,0,0,0)}#latest-games-container #latest-games .latest-game .latest-game-pin:hover{background-color:var(--rg-bg-hover-pin)}#latest-games-container #latest-games .latest-game .latest-game-pin svg{width:16px;height:16px;stroke:var(--rg-icon-pin);fill:none}#latest-games-container #latest-games .latest-game .latest-game-delete{width:24px;height:24px;cursor:pointer;border-radius:2px !important;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease;background-color:rgba(0,0,0,0)}#latest-games-container #latest-games .latest-game .latest-game-delete:hover{background-color:var(--rg-bg-hover-delete)}#latest-games-container #latest-games .latest-game .latest-game-delete svg{width:16px;height:16px;stroke:var(--rg-icon-delete);fill:none}#latest-games-container #latest-games .latest-game .latest-game-info{width:24px;height:24px;cursor:pointer;border-radius:2px !important;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease;background-color:rgba(0,0,0,0)}#latest-games-container #latest-games .latest-game .latest-game-info:hover{background-color:var(--rg-bg-hover-info)}#latest-games-container #latest-games .latest-game .latest-game-info svg{width:16px;height:16px;stroke:var(--rg-icon-info);fill:none}#latest-games-container #latest-games .latest-game .latest-game-edit{width:24px;height:24px;cursor:pointer;border-radius:2px !important;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease;background-color:rgba(0,0,0,0)}#latest-games-container #latest-games .latest-game .latest-game-edit:hover{background-color:var(--rg-bg-hover-edit)}#latest-games-container #latest-games .latest-game .latest-game-edit svg{width:16px;height:16px;stroke:var(--rg-icon-edit);fill:none}#latest-games-container #latest-games .latest-game.previous-game,#latest-games-container #latest-games .latest-game.dragged-game{animation:tilt-n-move-shaking .3s ease 5}#latest-games-container .latest-games-controls{display:flex;flex-direction:column;align-items:flex-start;padding:0 10px 10px;top:0;position:sticky;width:100%;z-index:10;background-color:var(--rg-bg-primary);border-bottom:1px solid var(--rg-border-primary)}#latest-games-container .latest-games-controls .controls-buttons{gap:2px;display:flex;flex-wrap:wrap;position:relative}#latest-games-container .latest-games-controls .controls-buttons .controls-visible{display:flex;gap:6px;align-items:center;flex-basis:100%}#latest-games-container .latest-games-controls .controls-buttons .controls-limiter{width:100%;display:flex;justify-content:center;gap:8px;align-items:center;padding-bottom:6px;border-bottom:1px solid var(--rg-border-primary)}#latest-games-container .latest-games-controls .controls-buttons .controls-more{display:none;position:absolute;left:0;top:100%;margin-top:6px;background:var(--rg-bg-card);padding:8px;border-radius:8px !important;border:1px solid var(--rg-border-primary);box-shadow:0 6px 18px rgba(0,0,0,.15);flex-wrap:wrap;gap:6px;z-index:2000;min-width:400px}#latest-games-container .latest-games-controls .controls-buttons .controls-more.open{display:flex}#latest-games-container .latest-games-controls .controls-buttons .latest-games-more-toggle{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:4px !important;background:rgba(0,0,0,0)}#latest-games-container .latest-games-controls .controls-buttons .latest-games-more-toggle.open{color:var(--rg-enabled-yellow)}#latest-games-container .latest-games-controls .controls-buttons .latest-games-replay.replay-next-game,#latest-games-container .latest-games-controls .controls-buttons .latest-games-random.random-global{background-color:var(--rg-bg-enabled-yellow)}#latest-games-container .latest-games-controls .controls-buttons .latest-games-replay.replay-next-game svg,#latest-games-container .latest-games-controls .controls-buttons .latest-games-random.random-global svg{stroke:var(--rg-enabled-yellow)}#latest-games-container #latest-games-options{display:flex;align-items:center;font-size:13px;gap:5px;color:var(--rg-text-options);user-select:none}#latest-games-container #latest-games-count{margin:0 6px;font-weight:bold;font-size:14px;min-width:18px;text-align:center;color:var(--rg-enabled-yellow);cursor:pointer}#latest-games-container #latest-games-count-inc,#latest-games-container #latest-games-count-dec{height:24px;width:24px;cursor:pointer;font-size:16px;border-radius:3px !important;transition:background .15s;user-select:none;display:flex;align-items:center;justify-content:center;color:var(--rg-icon-primary)}#latest-games-container #latest-games-count-inc:hover,#latest-games-container #latest-games-count-dec:hover{background:var(--rg-hover-control-btn)}#latest-games-container #latest-games-count-inc svg,#latest-games-container #latest-games-count-dec svg{width:16px;height:16px}#latest-games-container .theme-toggle,#latest-games-container .display-mode-toggle,#latest-games-container .control-button{cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:3px !important;width:24px;height:24px;background-color:rgba(0,0,0,0);border-radius:4px;transition:background .15s;user-select:none}#latest-games-container .theme-toggle svg,#latest-games-container .display-mode-toggle svg,#latest-games-container .control-button svg{width:16px;height:16px;display:block;transition:stroke .2s,fill .2s}#latest-games-container .theme-toggle svg.feather-sun,#latest-games-container .display-mode-toggle svg.feather-sun,#latest-games-container .control-button svg.feather-sun{stroke:var(--rg-icon-theme-sun);fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}#latest-games-container .theme-toggle svg.feather-moon,#latest-games-container .display-mode-toggle svg.feather-moon,#latest-games-container .control-button svg.feather-moon{stroke:var(--rg-icon-theme-moon);fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}#latest-games-container .control-button{box-sizing:border-box}#latest-games-container .control-button svg{pointer-events:none}#latest-games-container #latest-games-groups{display:flex;flex-direction:column;align-items:start;margin-bottom:0}#latest-games-container #latest-games-groups .tabs-container{display:inline-flex;flex-direction:row;gap:5px;flex-wrap:wrap;align-items:center;margin:0 10px 10px}#latest-games-container #latest-games-groups .group-tab{display:inline-flex;padding:5px 15px;min-height:30px;max-width:300px;font:600 14px "Montserrat",sans-serif;border-radius:4px !important;background:var(--rg-bg-card);color:var(--rg-text-primary);border:2px solid var(--rg-border-primary);cursor:pointer;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:fit-content;transition:border .1s ease,background-color .1s ease}#latest-games-container #latest-games-groups .group-tab:hover,#latest-games-container #latest-games-groups .group-tab:focus{border-color:var(--rg-border-hover);background:var(--rg-bg-hover);color:var(--rg-text-primary)}#latest-games-container #latest-games-groups .group-tab.active{color:var(--rg-gametype-normal) !important;background-color:var(--rg-bg-card-pinned-normal) !important;border:2px solid var(--rg-border-pinned-normal) !important}#latest-games-container #latest-games-groups .group-tab.warning{color:var(--rg-gametype-chars) !important;background-color:var(--rg-bg-card-pinned-chars) !important;border:2px solid var(--rg-border-pinned-chars) !important}#latest-games-container #latest-games-groups .group-tab.danger{color:var(--rg-gametype-marathon) !important;background-color:var(--rg-bg-card-pinned-marathon) !important;border:2px solid var(--rg-border-pinned-marathon) !important}#latest-games-container #latest-games-groups .group-controls{gap:2px;display:inline-flex;align-items:center;padding:10px}#latest-games-container .group-tab.previous-game-group,#latest-games-container .group-header.previous-game-group{color:var(--rg-gametype-chars) !important;background-color:var(--rg-bg-card-pinned-chars) !important;border:2px solid var(--rg-border-pinned-chars) !important}#latest-games-container .resize-handle-horizontal{position:absolute;top:0;bottom:0;right:0;width:4px;height:100%;cursor:ew-resize;background:rgba(0,0,0,0);z-index:1021;border-radius:4px 0 0 4px;transition:background .2s}#latest-games-container .resize-handle-horizontal:hover{background-color:rgba(0,0,0,.18)}#latest-games-container .resize-handle-vertical{position:absolute;left:0;right:0;width:100%;height:4px;cursor:ns-resize;background-color:rgba(0,0,0,0);z-index:1021;border-radius:0 0 4px 4px;transition:background .2s}#latest-games-container .resize-handle-vertical:hover{background-color:rgba(0,0,0,.18)}#latest-games-container .resize-handle-vertical-top{top:0}#latest-games-container .resize-handle-vertical-bottom{bottom:0}#latest-games-container #latest-games.display-mode-wrap .drop-indicator{border-left:2px solid var(--rg-gametype-voc)}#latest-games-hover-area{position:fixed;left:0;top:0;width:4px;height:100vh;z-index:1023;background-color:rgba(0,0,0,0);pointer-events:auto}.latest-games-panel-toggle{position:fixed;left:0;top:50%;transform:translateY(-50%);z-index:1024;background:var(--rg-panel-toggle-background);border:2px solid var(--rg-panel-toggle-border);border-radius:0 .5em .5em 0 !important;box-shadow:0 2px 8px rgba(0,0,0,.15) !important;width:40px;height:40px;display:flex;justify-content:center;align-items:center;cursor:pointer;transition:background .2s;outline:none}.latest-games-panel-toggle:hover,.latest-games-panel-toggle:focus{background:var(--rg-panel-toggle-bg-hover)}.latest-games-panel-toggle svg{stroke:var(--rg-panel-toggle-stroke);width:1.5em;height:1.5em;display:block;pointer-events:none}.custom-tooltip-popup{position:fixed;background:#161616;color:#dedede;padding:.5em;z-index:2010 !important;font-size:.9em;font-family:"Montserrat","Noto Color Emoji",sans-serif !important;pointer-events:none;white-space:nowrap;opacity:0;transition:opacity .1s;display:none;flex-direction:column;left:0;top:0;border:1px solid #3c3c3c !important;border-radius:4px !important;box-shadow:0 2px 5px rgba(0,0,0,.3) !important}.custom-tooltip-popup .tooltip-item{display:inline-flex !important;align-items:center !important}.custom-tooltip-popup .tooltip-header{font-weight:500 !important;color:gray !important;margin:.5em !important}.custom-tooltip-popup .tooltip-action{font-weight:500 !important;color:#add8e6 !important}.latest-games-disabled{background-color:rgba(0,0,0,0) !important;filter:grayscale(1);opacity:.5}.latest-games-hidden{display:none !important}@keyframes tilt-n-move-shaking{0%{transform:translate(0, 0) rotate(0deg)}25%{transform:translate(4px, 0) rotate(2deg)}50%{transform:translate(0, 0) rotate(0eg)}75%{transform:translate(-4px, 0) rotate(-2deg)}100%{transform:translate(0, 0) rotate(0deg)}}',""]);const i=s}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={id:n,exports:{}};return e[n](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.nc=void 0;var n=a(72),r=a.n(n),o=a(825),s=a.n(o),i=a(659),l=a.n(i),c=a(56),p=a.n(c),g=a(540),d=a.n(g),u=a(113),m=a.n(u),h=a(911),v={};v.styleTagTransform=m(),v.setAttributes=p(),v.insert=l().bind(null,"head"),v.domAPI=s(),v.insertStyleElement=d();r()(h.A,v);h.A&&h.A.locals&&h.A.locals;const b={montserrat:{id:"kg-latest-games-montserrat-font",url:"https://fonts.googleapis.com/css2?family=Montserrat&display=swap"},notoColorEmoji:{id:"kg-latest-games-noto-emoji-font",url:"https://fonts.googleapis.com/css2?family=Montserrat&family=Noto+Color+Emoji&display=swap"}};const y="",f="",x="",w="",k="",M="",C={normal:"O",abra:"",referats:".",noerror:"",marathon:"",chars:"",digits:"",sprint:"",voc:""},S={words:"",phrases:"",texts:"",book:""},E={:"words",:"phrases",:"texts",:"books",:"generator"},G={normal:"",practice:"",private:""},L=["","","","","","","","",""],I={:1,:2,:3,:4,:5,:6,:7,:8,:9},T=[5,10,20,30,45,60],D={maxGameCount:5,currentTheme:"light",displayMode:"scroll",previousScrollPosition:0,panelWidth:"70vw",panelHeight:"40vh",panelWidths:{},panelHeights:{},hoverTimeout:null,isHovered:!1,enableDragging:!0,wasDragging:!1,shouldAutoSave:!0,hidePanelDelay:1e3,shouldStart:!1,startDelay:1e3,shouldReplay:!1,replayDelay:1e3,replayNextGame:!1,shouldReplayMore:!1,replayNextGameCount:1,remainingReplayCount:null,replayWithoutWaiting:!1,randomGameId:!1,randomVocabulariesType:{words:!0,phrases:!0,texts:!0,books:!0,generator:!0},showSearchBox:!1,showButtonDescriptions:!0,showHelpTooltips:!0,showBlockedVocabAlert:!0,qualificationEnabled:!1,rankRange:[0,8],panelYPosition:{main:0,gamelist:0,profile:0,chatlogs:0,rating:0,vocabularies:0,about:0,donation:0,forum:0,game:0},alwaysVisiblePanel:{main:!0,gamelist:!1,profile:!1,chatlogs:!1,rating:!1,vocabularies:!1,about:!1,donation:!1,forum:!1,game:!0}},N="http://www.w3.org/2000/svg",$={sun:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="12" r="5"></circle>\n      <line x1="12" y1="1" x2="12" y2="3"></line>\n      <line x1="12" y1="21" x2="12" y2="23"></line>\n      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>\n      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>\n      <line x1="1" y1="12" x2="3" y2="12"></line>\n      <line x1="21" y1="12" x2="23" y2="12"></line>\n      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>\n      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>\n    </svg>\n  `,moon:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>\n    </svg>\n  `,delete:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round">\n      <line x1="18" y1="6" x2="6" y2="18"></line>\n      <line x1="6" y1="6" x2="18" y2="18"></line>\n    </svg>\n  `,decrease:`\n    <svg xmlns="${N}" viewBox="0 0 24 24">\n      <path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z" fill="currentColor"/>\n    </svg>\n  `,increase:`\n    <svg xmlns="${N}" viewBox="0 0 24 24">\n      <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" fill="currentColor"/>\n    </svg>\n  `,play:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="9 18 15 12 9 6"></polyline>\n    </svg>\n  `,replay:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="13 17 18 12 13 7"></polyline>\n      <polyline points="6 17 11 12 6 7"></polyline>\n    </svg>\n  `,replayImmediately:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="15 17 20 12 15 7"></polyline>\n      <polyline points="9.5 17 14.5 12 9.5 7"></polyline>\n      <polyline points="4 17 9 12 4 7"></polyline>\n    </svg>\n  `,replayMore:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>\n      <line x1="4" y1="22" x2="4" y2="15"></line>\n    </svg>\n  `,pin:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>\n      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>\n    </svg>\n  `,unpin:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>\n      <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>\n    </svg>\n  `,sort:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="currentColor" stroke="none"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <g transform="scale(0.85) translate(2.4, 2.4)">\n        <path d="M23.899,21.958L16.609,3.142c-1.512-4.142-7.711-4.139-9.222,.006L.101,21.958c-.299,.772,\n        .084,1.642,.857,1.941,.773,.299,1.642-.084,1.941-.857l1.953-5.042h14.296l1.953,5.042c.299,.78,1.188,\n        1.154,1.941,.857,.772-.299,1.156-1.168,.857-1.941ZM6.014,15L10.183,4.238c.697-1.668,2.933-1.672,3.632-.006l4.171,10.768H6.014Z"/>\n      </g>\n    </svg>\n  `,import:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n      <polyline points="7 10 12 15 17 10"></polyline>\n      <line x1="12" y1="15" x2="12" y2="3"></line>\n    </svg>\n  `,export:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n      <polyline points="17 8 12 3 7 8"></polyline>\n      <line x1="12" y1="3" x2="12" y2="15"></line>\n    </svg>\n  `,trashNothing:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <polyline points="3 6 5 6 21 6"></polyline>\n      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n    </svg>\n  `,trashSomething:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="3 6 5 6 21 6"></polyline>\n      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n      <line x1="10" y1="11" x2="10" y2="17"></line>\n      <line x1="14" y1="11" x2="14" y2="17"></line>\n    </svg>\n  `,wrap:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="3" y="3" width="7" height="7"/>\n      <rect x="14" y="3" width="7" height="7"/>\n      <rect x="14" y="14" width="7" height="7"/>\n      <rect x="3" y="14" width="7" height="7"/>\n    </svg>\n  `,scroll:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="2" y="2" width="20" height="20" rx="2"/>\n      <line x1="2" y1="8" x2="22" y2="8"/>\n      <line x1="2" y1="16" x2="22" y2="16"/>\n    </svg>\n  `,addGroup:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <line x1="12" y1="5" x2="12" y2="19"></line>\n      <line x1="5" y1="12" x2="19" y2="12"></line>\n    </svg>\n  `,renameGroup:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>\n    </svg>\n  `,qualification:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="var(--rg-qualification-icon)"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="8" r="7"></circle>\n      <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>\n    </svg>\n  `,panelToggleClosed:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>\n      <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>\n    </svg>\n  `,panelToggleOpened:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>\n      <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>\n    </svg>\n  `,moreHorizontal:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="12" r="1"></circle>\n      <circle cx="19" cy="12" r="1"></circle>\n      <circle cx="5" cy="12" r="1"></circle>\n    </svg>\n  `,broom:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none"\n    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <line x1="12" y1="2" x2="12" y2="8.5"/>\n      <path d="M12 8.5c3.63,0 6.61,2.76 6.96,6.3 0.02,0.18 -0.03,0.35 -0.16,0.49 -0.12,0.14 -0.29,0.21 -0.47,0.21l-12.66 0c-0.18,0 -0.35,-0.07 -0.47,-0.21 -0.13,-0.14 -0.18,-0.31 -0.16,-0.49 0.35,-3.54 3.33,-6.3 6.96,-6.3z"/>\n      <path d="M5 15.5l14 0 1.04 5.74c0.03,0.2 -0.02,0.38 -0.14,0.53 -0.13,0.15 -0.3,0.23 -0.49,0.23l-14.81 0c-0.2,0 -0.37,-0.08 -0.49,-0.23 -0.13,-0.15 -0.18,-0.33 -0.14,-0.53l1.03 -5.74z"/>\n    </svg>\n  `,checkmark:`\n    <svg xmlns="${N}" width="16" height="16" viewBox="0 0 24 24" fill="none"\n    stroke="#4caf50" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="20 6 9 17 4 12"></polyline>\n    </svg>\n  `,dragToggle:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none"\n    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="5 9 2 12 5 15"></polyline>\n      <polyline points="9 5 12 2 15 5"></polyline>\n      <polyline points="15 19 12 22 9 19"></polyline>\n      <polyline points="19 9 22 12 19 15"></polyline>\n      <line x1="2" y1="12" x2="22" y2="12"></line>\n      <line x1="12" y1="2" x2="12" y2="22"></line>\n    </svg>\n  `,search:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none"\n    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="11" cy="11" r="8"></circle>\n      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>\n    </svg>\n  `,info:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none"\n    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="12" r="10"></circle>\n      <line x1="12" y1="16" x2="12" y2="12"></line>\n      <line x1="12" y1="8" x2="12.01" y2="8"></line>\n    </svg>\n  `,help:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none"\n    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="12" r="10"></circle>\n      <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>\n      <line x1="12" y1="17" x2="12.01" y2="17"></line>\n    </svg>\n  `,parameters:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none"\n    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <line x1="4" y1="21" x2="4" y2="14"></line>\n      <line x1="4" y1="10" x2="4" y2="3"></line>\n      <line x1="12" y1="21" x2="12" y2="12"></line>\n      <line x1="12" y1="8" x2="12" y2="3"></line>\n      <line x1="20" y1="21" x2="20" y2="16"></line>\n      <line x1="20" y1="12" x2="20" y2="3"></line>\n      <line x1="1" y1="14" x2="7" y2="14"></line>\n      <line x1="9" y1="8" x2="15" y2="8"></line>\n      <line x1="17" y1="16" x2="23" y2="16"></line>\n    </svg>\n  `,refresh:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="1 4 1 10 7 10"></polyline>\n      <polyline points="23 20 23 14 17 14"></polyline>\n      <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>\n    </svg>\n  `,reset:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path>\n      <line x1="18" y1="9" x2="12" y2="15"></line>\n      <line x1="12" y1="9" x2="18" y2="15"></line>\n    </svg>\n  `,paused:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="6" y="4" width="4" height="16"></rect>\n      <rect x="14" y="4" width="4" height="16"></rect>\n    </svg>\n  `,playing:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polygon points="5 3 19 12 5 21 5 3"></polygon>\n    </svg>\n  `,random:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="16 3 21 3 21 8"></polyline>\n      <line x1="4" y1="20" x2="21" y2="3"></line>\n      <polyline points="21 16 21 21 16 21"></polyline>\n      <line x1="15" y1="15" x2="21" y2="21"></line>\n      <line x1="4" y1="4" x2="9" y2="9"></line>\n    </svg>\n  `,start:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="12" r="10"></circle>\n      <polygon points="10 8 16 12 10 16 10 8"></polygon>\n    </svg>\n  `,slash:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="12" r="10"></circle>\n      <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>\n    </svg>\n  `,book:`\n    <svg xmlns="${N}" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>\n      <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>\n    </svg>\n  `};let A=null,H=null,V=null,B=!1,j=!1,O=null,P=null;const q=e=>{if("info"===e){return!0===(()=>{if(null===P)try{const e=localStorage.getItem("latestGamesSettings");P=e?JSON.parse(e):{}}catch(e){console.warn("Failed to parse latestGamesSettings from localStorage:",e),P={}}return P})().showHelpTooltips}return!0},R=(e,t)=>{if(!A)return;let a=e+10;const n=A.offsetWidth,r=window.innerWidth;a=Math.min(Math.max(a,10),r-n-10),A.style.left=`${a}px`,A.style.top=`${t+18}px`},z=e=>A&&R(e.clientX,e.clientY);function _(){B=!1,O=null,clearTimeout(V),clearTimeout(H),H=setTimeout((()=>{A&&(A.style.opacity="0",j=!1,setTimeout((()=>{!B&&A&&(A.style.display="none",A.textContent="",document.removeEventListener("mousemove",z))}),50))}),100)}function W(e,t,a="info"){null!=t&&q(a)&&(e._tooltipContent=t,e._tooltipType=a,e._tooltipInitialized||(e._tooltipInitialized=!0,A||=(()=>{const e=document.createElement("div");return e.classList.add("custom-tooltip-popup"),e.style.display="none",e.style.opacity="0",document.body.appendChild(e),e})(),e.addEventListener("mouseenter",(t=>{q(e._tooltipType||"info")&&(B=!0,O=e,clearTimeout(H),clearTimeout(V),A.innerHTML=K(e._tooltipContent),A.style.display="flex",A.style.opacity="0",A.offsetHeight,R(t.clientX,t.clientY),document.addEventListener("mousemove",z),V=setTimeout((()=>{A.style.opacity="1",j=!0}),600))})),e.addEventListener("mouseleave",(()=>{_(),document.removeEventListener("mousemove",z)})),e.addEventListener("click",_)))}function Y(e,t,a="info"){if(e._tooltipInitialized){if(q(a)&&(e._tooltipContent=t,e._tooltipType=a,O===e&&B&&A)){A.innerHTML=K(t),j||(clearTimeout(V),A.style.opacity="1",j=!0);const a=e.getBoundingClientRect();R(a.left+a.width/2,a.bottom)}}else W(e,t,a)}function K(e){let t="";const a=/\[([^\]]+)\]([^\[]*)/g;return e.split(/(## [^[]*)/g).forEach((e=>{if(e.startsWith("## ")){const a=e.slice(3).trim();t+=`<div class="tooltip-header">${a}</div>`}else{a.lastIndex=0;const n=[...e.matchAll(a)];n.length?n.forEach((e=>{const a=e[1],n=e[2].trim();t+=`\n            <div class="tooltip-item">\n              <span class="tooltip-action">${a}&nbsp;</span>\n              <span class="tooltip-message">${n}</span>\n            </div>`})):e.trim()&&(t+=`\n          <div class="tooltip-item">\n            <span class="tooltip-message">${e.trim()}</span>\n          </div>`)}})),t}function U(e){const t=new Set([...e.map((e=>e.id)),...e.flatMap((e=>e.games.map((e=>e.id))))]);let a;do{a=Array.from(crypto.getRandomValues(new Uint8Array(32))).map((e=>(e%36).toString(36))).join("")}while(t.has(a));return a}function F(e){let t;const a=new Promise((a=>{t=setTimeout(a,e)}));return a.cancel=()=>{t&&(clearTimeout(t),t=null)},a}function J(){const e=window.location.pathname;return"/"===e?"main":"/gamelist/"===e?"gamelist":"/u/"===e?"profile":e.startsWith("/chatlogs/")?"chatlogs":e.startsWith("/top/")?"rating":e.startsWith("/vocs/")?"vocabularies":"/about/"===e?"about":"/fuel/"===e?"donation":e.startsWith("/forum/")?"forum":"/g/"===e?"game":"unknown"}function X(e,t={}){const a=document.createElement(e);return t.className&&(a.className=t.className),t.id&&(a.id=t.id),t.innerHTML&&(a.innerHTML=t.innerHTML),t.textContent&&(a.textContent=t.textContent),t.href&&(a.href=t.href),t.title&&(a.title=t.title),t.src&&(a.src=t.src),t.style&&Object.assign(a.style,t.style),t.attributes&&Object.entries(t.attributes).forEach((([e,t])=>{a.setAttribute(e,t)})),a}function Z(){const e=J();return"vocabularies"===e?".columns.voclist":"profile"===e?".profile-root, .dlg-profile-vocs .vocs":"forum"===e?"#posts-list .list":"gamelist"===e?"#gamelist":"game"===e?"#gamedesc":null}function Q(e){const t=e.getAttribute("href");if(/\/create\//.test(t)){const e=t.match(/[?&]voc=(\d+)/);return e?e[1]:null}try{const e=new URL(t,window.location.origin),a=e.pathname.match(/^\/vocs\/(\d+)\/?$/);return a?a[1]:null}catch(e){return null}}function ee(){const e=document.querySelector("#gamedesc");if(!e)return{category:"default",subtype:"Unknown"};const t=e.textContent.toLowerCase(),a=e.querySelector("span");if(!a)return{category:"default",subtype:"Unknown"};const n=a.className.match(/gametype-(\w+)/),r=n?n[1]:null,o=r&&C[r]||"Unknown";if(t.includes(""))return{category:"competition",subtype:o};if(t.includes(""))return{category:"qualification",subtype:o};if("voc"===r){if(e.querySelector('a[href*="/vocs/"]'))return{category:"vocabulary",subtype:o}}return{category:"default",subtype:o}}new MutationObserver((()=>{O&&!document.contains(O)&&_()})).observe(document,{childList:!0,subtree:!0});class te{constructor(e){this.main=e}applyTheme(){document.documentElement.classList.remove("latest-games-light-theme","latest-games-dark-theme"),document.documentElement.classList.add("light"===this.main.currentTheme?"latest-games-light-theme":"latest-games-dark-theme"),this.updateThemeIcon()}updateThemeIcon(){const e=document.querySelector("#latest-games-container .theme-toggle");e&&(e.innerHTML="light"===this.main.currentTheme?$.sun:$.moon)}toggleTheme(e){this.main.currentTheme="light"===this.main.currentTheme?"dark":"light",W(e,"   "+("light"===this.main.currentTheme?"":"")),this.main.settingsManager.saveSettings(),this.applyTheme()}createThemeToggle(){const e=X("div",{className:"theme-toggle control-button"});return e.innerHTML="light"===this.main.currentTheme?$.sun:$.moon,e.addEventListener("click",(()=>this.toggleTheme(e))),W(e,"   "+("light"===this.main.currentTheme?"":"")),e}}class ae{constructor(e){this.main=e}loadSettings(){try{const e=JSON.parse(localStorage.getItem("latestGamesSettings")||"{}");this.main.maxGameCount=e.maxGameCount??this.main.maxGameCount,this.main.currentTheme=e.currentTheme??this.main.currentTheme,this.main.displayMode=e.displayMode??this.main.displayMode,this.main.groupsManager.groupViewMode=e.groupViewMode??this.main.groupsManager.groupViewMode,this.main.previousScrollPosition=e.previousScrollPosition??this.main.previousScrollPosition,this.main.enableDragging=e.enableDragging??this.main.enableDragging,this.main.shouldAutoSave=e.shouldAutoSave??this.main.shouldAutoSave,this.main.hidePanelDelay=e.hidePanelDelay??this.main.hidePanelDelay,this.main.shouldStart=e.shouldStart??this.main.shouldStart,this.main.startDelay=e.startDelay??this.main.startDelay,this.main.shouldReplay=e.shouldReplay??this.main.shouldReplay,this.main.replayDelay=e.replayDelay??this.main.replayDelay,this.main.replayNextGame=e.replayNextGame??this.main.replayNextGame,this.main.shouldReplayMore=e.shouldReplayMore??this.main.shouldReplayMore,this.main.replayNextGameCount=e.replayNextGameCount??this.main.replayNextGameCount,this.main.remainingReplayCount=null!=e.remainingReplayCount?e.remainingReplayCount:this.main.replayNextGameCount,this.main.replayWithoutWaiting=e.replayWithoutWaiting??this.main.replayWithoutWaiting,this.main.showSearchBox=e.showSearchBox??this.main.showSearchBox,this.main.showButtonDescriptions=e.showButtonDescriptions??this.main.showButtonDescriptions,this.main.showHelpTooltips=e.showHelpTooltips??this.main.showHelpTooltips,this.main.randomGameId=e.randomGameId??this.main.randomGameId,this.main.showBlockedVocabAlert=e.showBlockedVocabAlert??this.main.showBlockedVocabAlert,this.main.qualificationEnabled=e.qualificationEnabled??this.main.qualificationEnabled,this.main.rankRange=e.rankRange??this.main.rankRange,this.loadValidVocabularies(),e.randomVocabulariesType&&"object"==typeof e.randomVocabulariesType&&(this.main.randomVocabulariesType={...this.main.randomVocabulariesType,...e.randomVocabulariesType}),e.panelYPosition&&"object"==typeof e.panelYPosition&&(this.main.panelYPosition={...this.main.panelYPosition,...e.panelYPosition}),e.panelWidths&&"object"==typeof e.panelWidths&&(this.main.panelWidths={...this.main.panelWidths,...e.panelWidths}),e.panelHeights&&"object"==typeof e.panelHeights&&(this.main.panelHeights={...this.main.panelHeights,...e.panelHeights}),e.alwaysVisiblePanel&&"object"==typeof e.alwaysVisiblePanel&&(this.main.alwaysVisiblePanel={...this.main.alwaysVisiblePanel,...e.alwaysVisiblePanel})}catch(e){console.warn("Could not load settings from localStorage:",e)}}loadValidVocabularies(){try{const e=localStorage.getItem("validVocabularies");if(e){const t=JSON.parse(e);if(!t||"object"!=typeof t||Array.isArray(t))return void(this.main.validVocabularies={});const a={};for(const[e,n]of Object.entries(t))Array.isArray(n)&&(a[e]=this._normalizeVocabList(n));try{const e=localStorage.getItem("bannedVocabularies"),t=localStorage.getItem("playedVocabularies"),n=e?JSON.parse(e):[],r=t?JSON.parse(t):[];if(Array.isArray(n)||Array.isArray(r)){const e=Array.isArray(n)?n.map((e=>"string"==typeof e?e:"object"==typeof e&&null!==e&&e.id||String(e))):[],t=Array.isArray(r)?r.map((e=>"string"==typeof e?e:"object"==typeof e&&null!==e&&e.id||String(e))):[],o=new Set(e.map((e=>String(e)))),s=new Set(t.map((e=>String(e)))),i=new Set([...o,...s]),l={};for(const[e,t]of Object.entries(a))l[e]=t.filter((e=>!i.has(String(e))));const c=Object.values(l).flat().length,p=Object.values(a).flat().length;if(0===c&&p>0){if(confirm("     .        ?")){localStorage.removeItem("playedVocabularies");const e={};for(const[t,n]of Object.entries(a))e[t]=n.filter((e=>!o.has(String(e))));this.main.validVocabularies=e}else this.main.validVocabularies={};return}return void(this.main.validVocabularies=l)}}catch(e){console.warn("Could not parse banned/played vocabularies from localStorage",e)}return void(this.main.validVocabularies=a)}}catch(e){console.warn("Could not parse validVocabularies from localStorage",e)}this.main.validVocabularies={}}saveValidVocabularies(e){try{let t;if(Array.isArray(e))t={all:this._normalizeVocabList(e)};else if(e&&"object"==typeof e){t={};for(const[a,n]of Object.entries(e))Array.isArray(n)&&(t[a]=this._normalizeVocabList(n))}else t={};return localStorage.setItem("validVocabularies",JSON.stringify(t)),this.main.validVocabularies=t,this.main.uiManager&&"function"==typeof this.main.uiManager.refreshContainer&&this.main.uiManager.refreshContainer(),t}catch(e){return console.warn("Could not save validVocabularies to localStorage",e),{}}}_normalizeVocabList(e){const t=new Set,a=[];for(let n of e){if(null==n)continue;if("string"==typeof n&&(n=n.trim()),""===n||null==n)continue;if(!/^\d+$/.test(String(n)))continue;const e=String(n);t.has(e)||(t.add(e),a.push(n))}return a}saveSettings(){try{const e={maxGameCount:this.main.maxGameCount,currentTheme:this.main.currentTheme,displayMode:this.main.displayMode,groupViewMode:this.main.groupsManager.groupViewMode,previousScrollPosition:this.main.previousScrollPosition,panelWidths:this.main.panelWidths,panelHeights:this.main.panelHeights,panelYPosition:this.main.panelYPosition,enableDragging:this.main.enableDragging,shouldAutoSave:this.main.shouldAutoSave,hidePanelDelay:this.main.hidePanelDelay,shouldStart:this.main.shouldStart,startDelay:this.main.startDelay,shouldReplay:this.main.shouldReplay,replayDelay:this.main.replayDelay,replayNextGame:this.main.replayNextGame,shouldReplayMore:this.main.shouldReplayMore,replayNextGameCount:this.main.replayNextGameCount,remainingReplayCount:this.main.remainingReplayCount,replayWithoutWaiting:this.main.replayWithoutWaiting,showSearchBox:this.main.showSearchBox,showButtonDescriptions:this.main.showButtonDescriptions,showHelpTooltips:this.main.showHelpTooltips,showBlockedVocabAlert:this.main.showBlockedVocabAlert,qualificationEnabled:this.main.qualificationEnabled,rankRange:this.main.rankRange,randomGameId:this.main.randomGameId,randomVocabulariesType:this.main.randomVocabulariesType,alwaysVisiblePanel:this.main.alwaysVisiblePanel};localStorage.setItem("latestGamesSettings",JSON.stringify(e))}catch(e){console.warn("Could not save settings to localStorage:",e)}}async importSettings(e){const t=document.createElement("input");t.type="file",t.accept=".json,application/json",t.style.display="none",t.onchange=async t=>{const a=t.target.files[0];if(a)try{const t=await a.text(),n=JSON.parse(t);"object"==typeof n&&null!==n?(n.validVocabularies&&localStorage.setItem("validVocabularies",JSON.stringify(n.validVocabularies)),n.bannedVocabularies&&localStorage.setItem("bannedVocabularies",JSON.stringify(n.bannedVocabularies)),n.playedVocabularies&&localStorage.setItem("playedVocabularies",JSON.stringify(n.playedVocabularies)),n.latestGamesSettings&&localStorage.setItem("latestGamesSettings",JSON.stringify(n.latestGamesSettings)),n.latestGamesData&&localStorage.setItem("latestGamesData",JSON.stringify(n.latestGamesData)),e.settingsManager.loadSettings(),e.gamesManager.loadGameData(),e.uiManager.refreshContainer(),e.themeManager.applyTheme()):alert("    JSON .")}catch(e){alert("  : "+e)}},document.body.appendChild(t),t.click(),setTimeout((()=>t.remove()),1e3)}exportSettings(e){const t={latestGamesSettings:JSON.parse(localStorage.getItem("latestGamesSettings")||"{}"),latestGamesData:{groups:e.groupsManager.groups,currentGroupId:e.groupsManager.currentGroupId},validVocabularies:JSON.parse(localStorage.getItem("validVocabularies")||"[]"),bannedVocabularies:JSON.parse(localStorage.getItem("bannedVocabularies")||"[]"),playedVocabularies:JSON.parse(localStorage.getItem("playedVocabularies")||"[]")},a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download="kg-latest-games-settings.json",document.body.appendChild(r),r.click(),setTimeout((()=>{URL.revokeObjectURL(n),r.remove()}),1e3)}removeAllSettings(e){localStorage.removeItem("latestGamesSettings"),localStorage.removeItem("latestGamesData"),e.groupsManager.groups=[e.groupsManager.createGroup("-1")],e.groupsManager.currentGroupId=e.groupsManager.groups[0].id,e.gamesManager.saveGameData(),e.uiManager.refreshContainer()}}class ne{constructor(e){this.main=e,this.groups=[],this.currentGroupId=null,this.groupViewMode="tabs"}createGroup(e){let t;if(e&&e.trim())t=e.trim();else{let e,a=1;do{e="-"+a++}while(this.groups.some((t=>t.title===e)));t=e}return{id:U(this.groups),title:t,games:[]}}renameGroup(e,t){const a=this.groups.find((t=>t.id===e));a&&(a.title=t)}removeGroup(e){const t=this.groups.findIndex((t=>t.id===e));return-1!==t&&this.groups.splice(t,1),this.groups}initializeGroups(){if(0===this.groups.length){const e=this.createGroup();this.groups=[e],this.currentGroupId=e.id}else this.currentGroupId&&this.groups.some((e=>e.id===this.currentGroupId))||(this.currentGroupId=this.groups[0].id)}getCurrentGroup(){return this.groups.find((e=>e.id===this.currentGroupId))||null}setGroups(e,t){this.groups=e,this.currentGroupId=t}setGroupViewMode(e){this.groupViewMode=e}getGroupViewMode(){return this.groupViewMode}createGroupViewToggle(){const e=X("div",{className:"group-view-toggle control-button"});return e.innerHTML="tabs"===this.groupViewMode?$.wrap:$.scroll,W(e,"tabs"===this.groupViewMode?"      ":"     "),e.addEventListener("click",(()=>{this.groupViewMode="tabs"===this.groupViewMode?"unified":"tabs",this.main.settingsManager.saveSettings(),this.updateGroupViewToggle(e),this.main.uiManager.refreshContainer()})),e}updateGroupViewToggle(e){e.innerHTML="tabs"===this.groupViewMode?$.wrap:$.scroll,W(e,"tabs"===this.groupViewMode?"      ":"     ")}moveGroup(e){const t=this.groups.findIndex((e=>e.id===this.currentGroupId));if(-1===t)return;const a=t+e;if(a<0||a>=this.groups.length)return;const n=this.groups[t];this.groups[t]=this.groups[a],this.groups[a]=n,this.main.gamesManager.saveGameData(),this.main.uiManager.refreshContainer()}updateGroupControlStates(){const e=document.querySelector(".move-group-left"),t=document.querySelector(".move-group-right");if(e&&t){const a=this.groups.findIndex((e=>e.id===this.currentGroupId)),n=0===a,r=a===this.groups.length-1;e.classList.toggle("latest-games-disabled",n),t.classList.toggle("latest-games-disabled",r)}}createGroupHeader(e){const t=X("div",{className:this.getGroupClass(e,"group-header"),textContent:e.title,dataset:{groupId:e.id}});return t.addEventListener("click",(()=>this.selectGroup(e.id))),t}createGroupTab(e){const t=X("span",{className:this.getGroupClass(e,"group-tab"),textContent:e.title,dataset:{groupId:e.id}});return t.addEventListener("click",(()=>this.selectGroup(e.id))),t}getGroupClass(e,t=""){const a=e.id===this.currentGroupId,n=this.main.gamesManager.latestGamesData?.previousGameId;return`${t}${a?" active":""}${e.games.some((e=>e.id===n))&&!a?" previous-game-group":""}`.trim()}createGroupsContainer(){const e=X("div",{id:"latest-games-groups"}),t=X("div",{className:"group-controls"+("unified"===this.groupViewMode?" unified-controls":"")}),a=X("span",{className:"add-group control-button",innerHTML:$.addGroup});W(a," "),a.addEventListener("click",(()=>this.addGroup()));const n=X("span",{className:"rename-group control-button",innerHTML:$.renameGroup});W(n," "),n.addEventListener("click",(()=>this.renameActiveGroup()));const r=X("span",{className:"remove-group control-button",innerHTML:$.trashNothing});W(r,"\n      []      \n      [Shift + ]      \n    "),r.addEventListener("click",(e=>this.removeActiveGroup(e)));const o=this.createGroupViewToggle(),s=X("span",{className:"move-group-left control-button",innerHTML:$.decrease});W(s,"  "),s.addEventListener("click",(()=>{s.classList.contains("latest-games-disabled")||this.moveGroup(-1)}));const i=X("span",{className:"move-group-right control-button",innerHTML:$.increase});W(i,"  "),i.addEventListener("click",(()=>{i.classList.contains("latest-games-disabled")||this.moveGroup(1)})),t.append(a,n,r,o,s,i),e.appendChild(t);const l=X("div",{className:"tabs-container"});return this.groups.forEach((e=>{const t=this.createGroupTab(e);l.appendChild(t)})),"unified"===this.groupViewMode&&l.classList.add("latest-games-hidden"),e.appendChild(l),e}selectGroup(e){this.groups.some((t=>t.id===e))&&(this.currentGroupId=e,this.main.gamesManager.saveGameData(),this.updateActiveGroup(),this.main.uiManager.refreshContainer())}updateActiveGroup(){document.querySelectorAll(".group-header").forEach((e=>e.classList.toggle("active",e.dataset.groupId===this.currentGroupId))),document.querySelectorAll(".group-tab").forEach((e=>e.classList.toggle("active",e.dataset.groupId===this.currentGroupId)))}addGroup(){const e=prompt("  :");if(null===e)return;const t=this.createGroup(e?.trim()||null);this.groups.push(t),this.currentGroupId=t.id,this.main.gamesManager.saveGameData(),this.main.uiManager.refreshContainer()}renameActiveGroup(){const e=this.getCurrentGroup(),t=prompt("   :",e?.title)?.trim();t&&(this.renameGroup(this.currentGroupId,t),this.main.gamesManager.saveGameData(),this.main.uiManager.refreshContainer())}removeActiveGroup(e){if(this.groups.length<=1)return void alert("   .");const t=this.groups.findIndex((e=>e.id===this.currentGroupId));let a;this.removeGroup(this.currentGroupId),e&&e.shiftKey?a=t>=this.groups.length?this.groups.length-1:t:(a=t-1,a<0&&(a=0)),this.currentGroupId=this.groups[a].id,this.main.gamesManager.saveGameData(),this.main.uiManager.refreshContainer()}refreshGroupsContainer(){const e=document.getElementById("latest-games-groups");if(e){const t=e.querySelector(".group-controls");t&&(t.className="group-controls"+("unified"===this.groupViewMode?" unified-controls":""));const a=e.querySelector(".tabs-container");a&&(a.innerHTML="","tabs"===this.groupViewMode?(this.groups.forEach((e=>{const t=this.createGroupTab(e);a.appendChild(t)})),a.classList.remove("latest-games-hidden")):a.classList.add("latest-games-hidden"))}this.updateGroupControlStates()}isCyrillic(e){const t=e.charCodeAt(0);return t>=1040&&t<=1103||1025===t||1105===t}compareGameNames(e,t){const a=this.main.gamesManager.generateGameName(e).toLowerCase(),n=this.main.gamesManager.generateGameName(t).toLowerCase(),r=this.isCyrillic(a[0]),o=this.isCyrillic(n[0]);return r&&!o?-1:!r&&o?1:a.localeCompare(n,"ru")}sortActiveGroupGames(){const e=this.getCurrentGroup();if(!e)return;const t=e.games.filter((e=>e.pin)),a=e.games.filter((e=>!e.pin));t.sort(((e,t)=>this.compareGameNames(e,t))),a.sort(((e,t)=>this.compareGameNames(e,t))),e.games=[...t,...a],this.main.gamesManager.saveGameData(),this.main.uiManager.refreshContainer()}getPinnedGameCount(){const e=this.getCurrentGroup();return e?e.games.filter((e=>e.pin)).length:0}}class re{constructor(e){this.main=e}getDisplayMode(){return this.main.displayMode}setDisplayMode(e){this.main.displayMode=e,this.main.settingsManager.saveSettings()}createDisplayModeToggle(){const e=X("div",{className:"display-mode-toggle control-button"});return e.innerHTML="wrap"===this.getDisplayMode()?$.wrap:$.scroll,W(e,"wrap"===this.getDisplayMode()?"     ":"     "),e.addEventListener("click",(()=>{const t="scroll"===this.getDisplayMode()?"wrap":"scroll";if(this.setDisplayMode(t),e.innerHTML="wrap"===t?$.wrap:$.scroll,this.updateDisplayModeClass(),W(e,"wrap"===t?"     ":"     "),"scroll"===t){const e=document.getElementById("latest-games-container");e&&setTimeout((()=>e.scrollTop=e.scrollHeight),0)}})),e}updateDisplayModeClass(){const e=document.getElementById("latest-games-container"),t=document.getElementById("latest-games");if(!e||!t)return;const a=this.getDisplayMode();e.classList.toggle("display-mode-wrap","wrap"===a),t.classList.toggle("display-mode-wrap","wrap"===a),this.updateContainerLeftOffset()}updateContainerLeftOffset(){const e=document.getElementById("latest-games-container");if(!e)return;if("wrap"===this.getDisplayMode()){const t=this.main.panelWidth||D.panelWidth;e.style.left=`calc(-1 * (${t} - 100px))`}else e.style.left="-330px"}}let oe=new Map,se=null;const ie='a[href*="/vocs/"], a[href*="/create/"]',le=["#latest-games-container",".game-popup",".userpanel","#head","#footer"];function ce(e){for(const t of le)if(e.closest(t))return!1;return!0}function pe(e){const t=Q(e);if(!t)return;const a=e.parentNode,n=a.querySelector(".kg-voc-checkmark");if(n&&n.remove(),oe.has(t)){const e=document.createElement("span");e.className="kg-voc-checkmark",e.innerHTML=$.checkmark,W(e,"    : "+oe.get(t).join(", "));const n=window.location.pathname.startsWith("/vocs/"),r=a.querySelector(".desc");n&&r?a.insertBefore(e,r):a.insertBefore(e,a.firstChild)}}function ge(e){e.forEach((e=>{if(e.addedNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE&&ce(e)){e.matches&&e.matches(ie)&&pe(e);const t=e.querySelectorAll&&e.querySelectorAll(ie);t&&t.forEach((e=>{ce(e)&&pe(e)}))}})),"attributes"===e.type&&"href"===e.attributeName){const t=e.target;ce(t)&&t.matches&&t.matches("a")&&pe(t)}}))}function de(e){const t=J();["profile","forum","vocabularies","gamelist","game"].includes(t)&&(oe.clear(),e.forEach((e=>{e.games.forEach((t=>{if(t.params&&t.params.vocId){const a=String(t.params.vocId);oe.has(a)||oe.set(a,[]),oe.get(a).push(e.name||e.title||"")}}))})),document.querySelectorAll(ie).forEach((e=>{ce(e)&&pe(e)})),se&&se.disconnect(),se=new MutationObserver(ge),se.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["href"]}))}function ue(e,t,a="popup",n,r=!1){const o=document.querySelector(`.${a}`);o&&o.remove();const s=X("div",{className:a});if(n){const e=X("div",{className:"popup-header",textContent:n});s.appendChild(e)}e.forEach((e=>{const t=X("button",{className:e.className||"popup-button",textContent:e.text,...e.dataset&&{dataset:e.dataset}});e.onClick&&t.addEventListener("click",(()=>{e.onClick(t),r||s.remove()})),s.appendChild(t)})),s.style.visibility="hidden",document.body.appendChild(s),s.querySelectorAll("button").forEach((e=>{e.scrollWidth>e.clientWidth&&W(e,e.textContent)}));const i=s.getBoundingClientRect(),l=window.innerWidth,c=window.innerHeight;let p=Math.max(10,Math.min(t.clientX,l-i.width-10)),g=Math.max(10,Math.min(t.clientY,c-i.height-10));s.style.left=`${p}px`,s.style.top=`${g}px`,s.style.visibility="visible";const d=e=>{e&&"keydown"===e.type&&"Escape"!==e.key||(s.remove(),document.removeEventListener("click",u),document.removeEventListener("keydown",m))},u=e=>{s.contains(e.target)||d(e)},m=e=>{"Escape"===e.key&&d(e)};return requestAnimationFrame((()=>{document.addEventListener("click",u),document.addEventListener("keydown",m)})),s}async function me(e){try{const t=await fetch(`https://klavogonki.ru/vocs/${e}/`),a=await t.text(),n=new DOMParser,r=n.parseFromString(a,"text/html").querySelector(".words");if(!r)return console.warn(`No element with class "words" found for vocId ${e}`)," ";const o=r.querySelectorAll("tr");if(0===o.length)return console.warn(`No table rows found for vocId ${e}`),"  ";return Array.from(o).map(((e,t)=>{const a=e.querySelector("td.num"),n=e.querySelector("td.text");if(!n)return null;const r=n.innerHTML.replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]*>/g,"").trim();if(""===r||""===r)return null;if(a){const e=a.textContent.trim();return""===e||""===e?null:`${e}. ${r}`}return`${t+1}. ${r}`})).filter((e=>null!==e)).join("\n\n")}catch(t){return console.error(`Error fetching vocabulary content for vocId ${e}:`,t),"  "}}let he=null,ve=null,be=null,ye=null;function fe(e){const t=document.createElement("div");t.className="vocabulary-tooltip-popup";const a=e.replace(/^(\d+)\.\s/gm,'<span class="tooltip-number">$1.</span> ');return t.innerHTML=a,document.body.appendChild(t),t}function xe(e,t){if(ve&&(clearTimeout(ve),ve=null),be&&(clearTimeout(be),be=null),!he||ye!==e){if(he&&we(),!e)return ye=null,he=fe(t),Ce(null,he),he.addEventListener("mouseenter",(()=>{ve&&(clearTimeout(ve),ve=null)})),void he.addEventListener("mouseleave",(()=>{ke()}));be=setTimeout((()=>{ye=e,he=fe(t),Ce(e,he),he.addEventListener("mouseenter",(()=>{ve&&(clearTimeout(ve),ve=null)})),he.addEventListener("mouseleave",(()=>{ke()})),be=null}),400)}}function we(){he&&(he.remove(),he=null,ye=null),ve&&(clearTimeout(ve),ve=null),be&&(clearTimeout(be),be=null)}function ke(){ve&&clearTimeout(ve);try{if(he&&he.matches(":hover"))return}catch(e){}ve=setTimeout((()=>{we()}),300)}function Me(){try{const e=document.querySelector('#status #gamedesc a, #status a[href*="/vocs/"]');if(e){const t=(e.getAttribute("href")||"").match(/\/vocs\/(\d+)(?:\/|$)/);if(t&&t[1])return String(t[1])}const t=sessionStorage.getItem("latestGames_showVocTooltip");if(!t)return null;return(JSON.parse(t)||{}).vocId||null}catch(e){return console.warn("Could not determine session voc id:",e),null}}function Ce(e,t){const a=window.innerWidth,n=window.innerHeight,r=10,o=t.getBoundingClientRect();let s,i;if(!e)return s=Math.max(r,Math.floor((a-o.width)/2)),i=Math.max(r,Math.floor((n-o.height)/2)),t.style.left=`${s}px`,void(t.style.top=`${i}px`);const l=e.getBoundingClientRect();if(s=l.left,i=l.bottom+5,s+o.width>a-r&&(s=a-o.width-r),s<r&&(s=r),i+o.height>n-r){const e=l.top-o.height-5;i=e>=r?e:r}i<r&&(i=r),t.style.left=`${s}px`,t.style.top=`${i}px`}async function Se(e){const t=new AbortController,a=t.signal;try{const n=await fetch(`https://klavogonki.ru/vocs/${e}/`,{signal:a});if(!n.ok)return console.error("Failed to fetch vocabulary content for vocId:",e),null;const r=n.body.getReader(),o=new TextDecoder;let s="";for(;;){const{done:a,value:n}=await r.read();if(a)break;if(s+=o.decode(n,{stream:!0}),!s.includes("</td>"))continue;const i=(new DOMParser).parseFromString(s,"text/html"),l=i.querySelector(".user-title");if(!l)continue;const c=l.querySelector("td.title");if(!c)continue;const p=c.querySelector("#rating_cnt"),g=c.querySelector("#fav_cnt");if(p&&g){t.abort();const a=c.childNodes[0].textContent.trim(),n=parseInt(p.textContent.trim(),10),r=parseInt(g.textContent.trim(),10);let o="",s=null;const l=i.querySelectorAll(".user-content dl");for(const e of l){const t=e.querySelector("dt"),a=e.querySelector("dd");if(!t||!a)continue;const n=t.textContent.trim();if(":"===n){const e=a.querySelector('a[href^="/profile/"]');e&&(o=e.textContent.trim())}if(" :"===n){const e=a.childNodes[0]?.textContent?.trim();e&&E[e]&&(s=E[e])}}return{vocId:e,vocabularyName:a,ratingCount:n,fansCount:r,vocabularyAuthor:o,vocabularyType:s}}}return null}catch(e){return"AbortError"===e.name||console.error("Error fetching/parsing vocabulary basic data:",e),null}}function Ee(e,t,a,n,r,o){if(e.games.some((e=>String(e.params?.vocId)===String(t))))return void alert(`     ${e.title}`);const s={id:U(r),params:{gametype:"voc",vocName:a,vocId:t,vocType:n||null,type:"normal",level_from:1,level_to:9,timeout:10,qual:0,premium_abra:0},pin:1};e.games.push(s);let i=o.gamesManager.latestGamesData||{};i={...i,latestGroupAddedGameId:e.id},o.gamesManager.latestGamesData=i,o.gamesManager.saveGameData(),o.uiManager.refreshContainer(),de(r)}!async function(){let e;try{e=JSON.parse(localStorage.getItem("latestGamesSettings")||"{}").randomGameId}catch(t){console.warn("Could not read randomGameId from localStorage:",t),e=void 0}if(await new Promise((e=>setTimeout(e,500))),"game"===J())try{const e=Me();if(!e)return;if("vocabulary"!==ee().category)return;const t=await me(e);try{xe(null,t),setTimeout((()=>{try{ke()}catch(e){}}),5e3)}catch(e){}}catch(e){}}();const Ge=new WeakSet;function Le(e,t,a){async function n(e,t){const a=await Se(e);return a&&a.vocabularyName?{success:!0,vocName:a.vocabularyName,vocType:a.vocabularyType||null}:(alert("     .  ."),{success:!1})}Ge.has(e)||(Ge.add(e),e.addEventListener("contextmenu",(async e=>{const r=e.target.closest("a");if(!r)return;const o=r.getAttribute("href");if(!o||!o.includes("/vocs/")&&!o.includes("/create/"))return;const s=Q(r);if(!s)return void console.warn("Invalid vocabulary link (extra path segments present), ignoring:",o);let i=a.gamesManager.latestGamesData||{};if(e.ctrlKey){const r=i.latestGroupAddedGameId;if(r){const o=t.find((e=>e.id===r));if(o){e.preventDefault(),e.stopPropagation();const r=await n(s);if(!r.success)return;return void Ee(o,s,r.vocName,r.vocType,t,a)}}return}e.preventDefault(),e.stopPropagation();const l=await n(s);l.success&&function(e,t,a,n,r,o){we(),ue(e.map((t=>{const s=t.games.some((e=>String(e.params?.vocId)===String(a)));return{text:t.title,className:"group-tab"+(s?" active":""),dataset:{groupId:t.id},onClick:()=>{Ee(t,a,n,r,e,o)}}})),t,"vocabulary-creation-popup","")}(t,e,s,l.vocName,l.vocType,a)})))}function Ie(e,t){const a=Z();if(!a)return void console.warn("Vocabulary creation is not supported on this page.");a.split(",").map((e=>e.trim())).forEach((a=>{const n=document.querySelector(a);n&&Le(n,e,t),function(e,t){new MutationObserver((a=>{a.forEach((a=>{"childList"===a.type&&a.addedNodes.forEach((a=>{a.nodeType===Node.ELEMENT_NODE&&(a.matches(e)&&t(a),a.querySelectorAll(e).forEach((e=>t(e))))}))}))})).observe(document.body,{childList:!0,subtree:!0})}(a,(a=>Le(a,e,t)))}))}class Te{constructor(e){this.main=e,this.container=null,this.startIndicator=null,this.replayIndicator=null,this.startTimer=null,this.replayTimer=null,this.playCountIndicators={day:null,week:null,month:null,year:null}}ensureContainer(){if(this.container)return;const e=document.createElement("div");e.className="games-data-container",document.body.appendChild(e),this.container=e}createIndicator(e,t,a=null,n=null){this.ensureContainer();const r=document.createElement("div");return r.className=`indicator ${e}`,r.textContent=t,a&&W(r,a),(n||this.container).appendChild(r),r}getPlayCount(e){try{const t=JSON.parse(localStorage.getItem("playedVocabularies")||"[]"),a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime(),r=(a.getDay()+6)%7,o=new Date(a.getFullYear(),a.getMonth(),a.getDate()-r).getTime(),s=new Date(a.getFullYear(),a.getMonth(),1).getTime(),i=new Date(a.getFullYear(),0,1).getTime();return t.reduce(((t,a)=>a.playHistory?t+a.playHistory.reduce(((t,a)=>{const r=new Date(a.date),l=new Date(r.getFullYear(),r.getMonth(),r.getDate()).getTime();return t+(("day"===e&&l===n||"week"===e&&l>=o&&l<=n||"month"===e&&l>=s&&l<=n||"year"===e&&l>=i&&l<=n)&&a.count||0)}),0):t),0)}catch(t){return console.error(`Error calculating ${e} play count:`,t),0}}createGamesDataContainer(){this.ensureContainer(),this.createPlayCountIndicators(),this.createRemainingCountIndicator()}createPlayCountIndicators(){const e=document.createElement("div");e.className="period-indicators-container",this.container.appendChild(e);let t=0;[{period:"day",class:"today-play-count-indicator",tooltip:"   ( )  ",description:""},{period:"week",class:"week-play-count-indicator",tooltip:"   ( )  ",description:""},{period:"month",class:"month-play-count-indicator",tooltip:"   ( )  ",description:""},{period:"year",class:"year-play-count-indicator",tooltip:"   ( )  ",description:""}].forEach((({period:a,class:n,tooltip:r,description:o})=>{const s=this.getPlayCount(a);if(0===s&&"day"!==a)return;const i=this.createIndicator(n,"",r,e);this.playCountIndicators[a]=i;const l=document.createElement("span");l.className="period-indicator-description",l.textContent=o,l.style.display="none";const c=document.createTextNode(s);i.appendChild(l),i.appendChild(c),i._descSpan=l,"day"!==a&&(i.classList.add("period-indicator"),i.style.setProperty("--fall-delay",90*t+++"ms"))})),e.addEventListener("mouseenter",(()=>this.toggleExtendedIndicators(!0))),e.addEventListener("mouseleave",(()=>this.toggleExtendedIndicators(!1)))}toggleExtendedIndicators(e){["day","week","month","year"].forEach((t=>{const a=this.playCountIndicators[t];a&&("day"!==t&&a.classList.toggle("show",e),a._descSpan.style.display=e?"":"none")}))}createRemainingCountIndicator(){this.main.shouldReplayMore&&this.createIndicator("remaining-count-indicator",`${this.main.remainingReplayCount}`,"    ")}createSleepIndicator(e,t){this.ensureContainer();const a=document.createElement("div");a.className="indicator "+("start"===e?"sleep-start-indicator":"sleep-replay-indicator"),this.container.insertBefore(a,this.container.firstChild);W(a,"start"===e?"   ":"   "),"start"===e?this.startIndicator=a:this.replayIndicator=a;let n=t;const r=Date.now(),o=()=>{const s=Date.now()-r;n=Math.max(0,t-s);const i=Math.floor(n/1e3),l=Math.floor(n%1e3/10);if(a.textContent=`${i.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`,n>0){const t=requestAnimationFrame(o);"start"===e?this.startTimer=t:this.replayTimer=t}};o()}removeSleepIndicator(e){"start"===e?(this.startTimer&&(cancelAnimationFrame(this.startTimer),this.startTimer=null),this.startIndicator&&(this.startIndicator.remove(),this.startIndicator=null)):"replay"===e&&(this.replayTimer&&(cancelAnimationFrame(this.replayTimer),this.replayTimer=null),this.replayIndicator&&(this.replayIndicator.remove(),this.replayIndicator=null))}}class De{constructor(e){this.main=e,this.gamesDataContainer=new Te(e),this.replaySleep=null,this.startSleep=null,this.isHoveringLatestGames=!1,this.remainingReplayCount=this.main.replayNextGameCount}handlePageSpecificLogic(){const{href:e}=location;if(/https?:\/\/klavogonki\.ru\/g\/\?gmid=/.test(e)){this.gamesDataContainer.createGamesDataContainer(),this.setupHoverListeners();const e=new MutationObserver((()=>{const t=document.querySelector("#gamedesc");t&&t.textContent&&(e.disconnect(),this.saveCurrentGameParams(),this.handleStartAction())}));e.observe(document.body,{childList:!0,subtree:!0});const t=this.main.replayWithoutWaiting?document.querySelector("#typeblock #bookinfo"):document.querySelector("#status-inner #finished");if(t){const e=new MutationObserver((()=>{e.disconnect();try{const e=Me();if(e)try{if("vocabulary"===ee().category)try{this.main.gamesManager.markVocabAsPlayed(e)}catch(e){}}catch(e){}}catch(e){}this.handleReplayAction()}));e.observe(t,{attributes:!0})}}null!==Z()&&(de(this.main.groupsManager.groups),Ie(this.main.groupsManager.groups,this.main),function(){const e=[".columns.voclist","#gamelist","#gamedesc"].map((e=>document.querySelector(e))).filter((e=>e));if(0===e.length)return void console.warn("No supported containers found.");const t=async e=>{if(!e.shiftKey)return;const t=e.target.closest('a[href*="/vocs/"]');if(t){const e=t.getAttribute("href"),a=e.match(/\/vocs\/(\d+)(?:\/|$)/);if(!a)return void console.warn(`Invalid vocabulary href: ${e}`);const n=a[1];t._tooltipContent?xe(t,t._tooltipContent):me(n).then((e=>{t._tooltipContent=e,xe(t,e)}))}},a=e=>{const t=e.target.closest('a[href*="/vocs/"]');t&&ye===t&&ke(),be&&(clearTimeout(be),be=null)};e.forEach((e=>{e.addEventListener("mouseenter",t,{capture:!0}),e.addEventListener("mouseleave",a,{capture:!0})}))}())}setupHoverListeners(){const e=document.querySelector("#latest-games-container");e&&(e.addEventListener("mouseenter",(()=>{this.isHoveringLatestGames=!0,this.replaySleep&&"function"==typeof this.replaySleep.cancel&&(this.replaySleep.cancel(),this.replaySleep=null,this.gamesDataContainer.removeSleepIndicator("replay"))})),e.addEventListener("mouseleave",(()=>{this.isHoveringLatestGames=!1,this.handleReplayAction()})))}saveCurrentGameParams(){const e=document.querySelector("#gamedesc");if(!e)throw new Error("#gamedesc element not found.");const t=e.querySelector("span");if(!t)throw new Error("#gamedesc span element not found.");const a=e.textContent;if(//.test(a)||!this.main.maxGameCount||!1===this.main.shouldAutoSave)return!1;const n=this.main.gamesManager.parseGameParams(t,a),r=JSON.stringify(n),o=this.main.groupsManager.getCurrentGroup(this.main.groupsManager.groups,this.main.groupsManager.currentGroupId);if(!o)return;if(o.games.some((e=>JSON.stringify(e.params)===r)))return;const s={params:n,id:U(this.main.groupsManager.groups),pin:0},i=o.games.filter((e=>e.pin)).length;o.games.splice(i,0,s);const l=i+this.main.maxGameCount;o.games.length>l&&o.games.splice(l,o.games.length-l),this.main.gamesManager.assignGameIds(),this.main.gamesManager.saveGameData()}handleStartAction(){if(this.main.shouldStart){const e=document.querySelector("#status-inner #paused");e&&"none"!==e.style.display&&"undefined"!=typeof game&&game.hostStart&&(this.gamesDataContainer.removeSleepIndicator("start"),this.gamesDataContainer.createSleepIndicator("start",this.main.startDelay),this.startSleep=F(this.main.startDelay),this.startSleep.then((()=>{this.gamesDataContainer.removeSleepIndicator("start"),game.hostStart()})).catch((()=>{this.gamesDataContainer.removeSleepIndicator("start"),this.startSleep=null})))}}replayNextGame(){const e=this.main.groupsManager,t=this.main.gamesManager;let a=null,n=null,r=null,o=null;if(this.main.randomGameId){const s=t.getRandomGameId();if(!s)return;if("global"===s.mode)return void(async()=>{const e=await t.getValidRandomGameId();if(!e)return alert("      .   .");if(a=e.id,o=e.url,a)try{t.registerPendingPlayed(a)}catch(e){}window.location.href=o})();if("local"===s.mode){const i=e.groups.find((e=>e.games.some((e=>e.id===s.id))));if(i&&e.selectGroup(i.id),t.latestGamesData=t.latestGamesData||{},t.latestGamesData.previousGameId=s.id,t.saveGameData(),a=String(s.game?.params?.vocId||""),n=s.game?.params?.vocName||null,r=s.game?.params?.vocType||null,o=s.game?t.generateGameLink(s.game):s.url,a)try{t.registerPendingPlayed(a,n||null,r||null)}catch(e){}o&&(window.location.href=o)}return}const s=e.getCurrentGroup(e.groups,e.currentGroupId);if(!s||!Array.isArray(s.games)||0===s.games.length)return;const i=t.latestGamesData?.previousGameId;let l=s.games.findIndex((e=>e.id===i));l=-1===l?0:(l+1)%s.games.length;const c=s.games[l];if(c){if(t.latestGamesData.previousGameId=c.id,t.saveGameData(),a=String(c.params.vocId||""),n=c.params.vocName||null,r=c.params.vocType||null,o=t.generateGameLink(c),a)try{t.registerPendingPlayed(a,n||null,r||null)}catch(e){}window.location.href=o}}handleReplayAction(){if(!["competition","qualification"].includes(ee().category)&&this.main.shouldReplay){const e=this.main.replayWithoutWaiting?document.querySelector("#typeblock #bookinfo"):document.querySelector("#status-inner #finished");if(e&&"none"!==e.style.display){const e=location.href.match(/gmid=(\d+)/);if(e){const t=e[1];this.isHoveringLatestGames||(this.gamesDataContainer.removeSleepIndicator("replay"),this.gamesDataContainer.createSleepIndicator("replay",this.main.replayDelay),this.replaySleep=F(this.main.replayDelay),this.replaySleep.then((()=>{this.gamesDataContainer.removeSleepIndicator("replay"),this.main.shouldReplayMore?this.main.remainingReplayCount>1?(this.main.remainingReplayCount--,this.main.settingsManager.saveSettings(),window.location.href=`https://klavogonki.ru/g/${t}.replay`):(this.main.remainingReplayCount=this.main.replayNextGameCount,this.main.settingsManager.saveSettings(),this.main.replayNextGame?this.replayNextGame():window.location.href=`https://klavogonki.ru/g/${t}.replay`):this.main.replayNextGame?this.replayNextGame():window.location.href=`https://klavogonki.ru/g/${t}.replay`})).catch((()=>{this.gamesDataContainer.removeSleepIndicator("replay"),this.replaySleep=null})))}}}}}function Ne(e,t,a,n,r){_();const o=t.filter((e=>e.id!==a)).map((t=>({text:t.title,className:"group-tab",dataset:{groupId:t.id},onClick:()=>{!function(e,t,a){const n=e.groupsManager.groups.find((e=>e.games.some((e=>e.id===t)))),r=e.groupsManager.groups.find((e=>e.id===a));if(!n||!r)return;if(n.id===r.id)return;const o=n.games.findIndex((e=>e.id===t));if(-1===o)return;const[s]=n.games.splice(o,1);r.games.push(s),e.gamesManager.saveGameData(),e.uiManager.refreshContainer()}(e,r,t.id)}})));ue(o,n,"game-migration-popup","")}const $e=10;const Ae=Object.keys(G),He=0,Ve=5,Be=5,je=8,Oe=[".popup-header",".popup-header-title",".popup-subheader",".rank-slider-display",".timeouts-container"],Pe=[".game-popup-button",".rank-slider-handle",".rank-slider-track",".rank-slider-range",".popup-header-qualification"];function qe(e,t){return t?Math.max(He,Math.min(Ve,e)):Math.max(Be,Math.min(je,e))}function Re(e,t,a,n="game-popup"){_();const r=document.querySelector(`.${n}`);r&&r.remove();const o=X("div",{className:n}),s=X("div",{className:"popup-header"}),i=X("div",{className:"popup-header-title",textContent:""}),l=X("span",{className:"popup-header-qualification",innerHTML:$.qualification});let c=a.qualificationEnabled??!1;l.classList.toggle("latest-games-disabled",!c),W(l," "+(c?"":"")),l.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),c=!c,a.qualificationEnabled=c,a.settingsManager.saveSettings(),l.classList.toggle("latest-games-disabled",!c),W(l," "+(c?"":"")),f()})),s.append(i,l),o.appendChild(s);const p=X("div",{className:"rank-slider-container"}),g=X("div",{className:"rank-slider-track"}),d=X("div",{className:"rank-slider-range"}),u=[X("div",{className:"rank-slider-handle",tabIndex:0}),X("div",{className:"rank-slider-handle",tabIndex:0})],m=X("div",{className:"rank-slider-display"});let[h,v]=a.rankRange||[He,je];h=qe(h,!0),v=qe(v,!1),h>v&&(h=v),v<h&&(v=h);const b=[];function y(){h=qe(h,!0),v=qe(v,!1),h>v&&(h=v),v<h&&(v=h);const e=h/(L.length-1)*100,t=v/(L.length-1)*100;u[0].style.left=e+"%",u[1].style.left=t+"%",d.style.left=e+"%",d.style.width=t-e+"%",m.textContent=L[h]+(h===v?"":"  "+L[v]);const a=h===v,n=[["overlap","overlap-left"],["overlap","overlap-right"]];u.forEach(((e,t)=>{n[t].forEach((t=>e.classList.toggle(t,a)))})),f()}function f(){const t=h!==He||v!==je;b.forEach((({btn:n,type:r,timeout:o})=>{const s={...e,params:{...e.params,type:r,timeout:o,level_from:t?h+1:e.params.level_from,level_to:t?v+1:e.params.level_to}};c&&(s.params.qual=1);const i=a.gamesManager.generateGameLink(s);n.setAttribute("href",i),n.onclick=e=>{e.preventDefault(),window.location.href=i}}))}function x(){a.rankRange=[h,v],a.settingsManager.saveSettings()}return g.addEventListener("click",(e=>{const t=g.getBoundingClientRect(),a=(e.clientX-t.left)/t.width;let n=Math.round(a*(L.length-1));Math.abs(n-h)<Math.abs(n-v)?h=Math.min(qe(n,!0),v):v=Math.max(qe(n,!1),h),y(),x()})),u.forEach(((e,t)=>{e.addEventListener("mousedown",(e=>{e.preventDefault();let a=0===t?h:v;const n=({clientX:e})=>{const{left:n,width:r}=g.getBoundingClientRect();let o=Math.round((e-n)/r*(L.length-1));o=qe(o,0===t);const s=0===t?Math.min(o,v):Math.max(o,h);s!==a&&(a=s,0===t?h=s:v=s,y())},r=()=>{x(),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",r)}))})),g.appendChild(d),u.forEach((e=>g.appendChild(e))),p.appendChild(m),p.appendChild(g),o.appendChild(p),y(),Ae.forEach((t=>{const n=X("div",{className:"popup-subheader",textContent:G[t]});o.appendChild(n);const r=X("div",{className:"timeouts-container"});T.forEach((n=>{if("normal"===t&&5===n)return;const o=h!==He||v!==je,s={...e,params:{...e.params,type:t,timeout:n,level_from:o?h+1:e.params.level_from,level_to:o?v+1:e.params.level_to}};c&&(s.params.qual=1);const i=a.gamesManager.generateGameLink(s),l=X("a",{href:i,className:"game-popup-button",textContent:n});l.addEventListener("click",(e=>{e.preventDefault(),window.location.href=i})),b.push({btn:l,type:t,timeout:n}),r.appendChild(l)})),o.appendChild(r)})),function(e,t){e.querySelectorAll("a").forEach((e=>{e.scrollWidth>e.clientWidth&&W(e,e.textContent)})),function(e,t,a={}){const{draggableSelectors:n=[],interactiveSelectors:r=[],onClose:o=null}=a;e.parentNode||(e.style.visibility="hidden",document.body.appendChild(e));const s=(t,a)=>{const n=window.innerWidth,r=window.innerHeight,o=e.getBoundingClientRect(),s=n-o.width-$e,i=r-o.height-$e,l=Math.max($e,Math.min(t,s)),c=Math.max($e,Math.min(a,i));e.style.left=`${l}px`,e.style.top=`${c}px`};s(t.clientX,t.clientY),e.style.visibility="visible";const i={clickOutside:null,keydown:null,popupMouseDown:t=>{if((a=t.target)!==e&&!n.some((e=>a.matches&&a.matches(e)))||(e=>r.some((t=>e.matches&&(e.matches(t)||e.closest(t)))))(t.target))return;var a;if(0!==t.button)return;t.preventDefault();const o=t.clientX,l=t.clientY,c=parseInt(e.style.left,$e),p=parseInt(e.style.top,$e),g=e=>{const t=e.clientX-o,a=e.clientY-l;s(c+t,p+a)},d=()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",d),i.currentDrag=null};i.currentDrag={onMouseMove:g,onMouseUp:d},document.addEventListener("mousemove",g),document.addEventListener("mouseup",d)},currentDrag:null};e.addEventListener("mousedown",i.popupMouseDown),e.style.cursor="move";const l=t=>{t&&"keydown"===t.type&&"Escape"!==t.key||(o&&o(),c(),e.remove())},c=()=>{i.clickOutside&&document.removeEventListener("click",i.clickOutside),i.keydown&&document.removeEventListener("keydown",i.keydown),i.popupMouseDown&&e.removeEventListener("mousedown",i.popupMouseDown),i.currentDrag&&(document.removeEventListener("mousemove",i.currentDrag.onMouseMove),document.removeEventListener("mouseup",i.currentDrag.onMouseUp))};i.clickOutside=t=>{e.contains(t.target)||l(t)},i.keydown=e=>{"Escape"===e.key&&l(e)},requestAnimationFrame((()=>{document.addEventListener("click",i.clickOutside),document.addEventListener("keydown",i.keydown)}))}(e,t,{draggableSelectors:Oe,interactiveSelectors:Pe})}(o,t),o}function ze(e,t,a,n){let r,o,s=!1;const i=e=>{if(!s)return;const n=t(e,r);a(n,o)},l=()=>{s&&(s=!1,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",l),n())};e.onmousedown=e=>{0===e.button&&(s=!0,[r,o]=t(e),document.addEventListener("mousemove",i),document.addEventListener("mouseup",l),e.preventDefault())}}function _e(e,t,a,n,r){const o=e.main.viewManager.getDisplayMode(),s=J();if("wrap"===o){const n=e.main.panelWidths?.[s]||e.main.panelWidth;t.style.width=n,a.style.display="",ze(a,((e,a)=>void 0===a?[e.clientX,t.offsetWidth]:e.clientX-a),((e,a)=>{let n=a+e;const r=.95*window.innerWidth;n=Math.max(350,Math.min(n,r));const o=Math.round(n/window.innerWidth*100*10)/10;t.style.width=`${o}vw`}),(()=>{e.main.panelWidths=e.main.panelWidths||{},e.main.panelWidths[s]=t.style.width,e.main.settingsManager.saveSettings()}))}else a.style.display="none",t.style.width="",a.onmousedown=null;const i=e.main.panelHeights?.[s]||D.panelHeight;t.style.height=i,n&&(n.style.display="",ze(n,((e,a)=>void 0===a?[e.clientY,t.offsetHeight]:e.clientY-a),((e,a)=>{let n=a+e;const r=.95*window.innerHeight;n=Math.max(200,Math.min(n,r));const o=Math.round(n/window.innerHeight*100*10)/10;t.style.height=`${o}vh`}),(()=>{e.main.panelHeights=e.main.panelHeights||{},e.main.panelHeights[s]=t.style.height,e.main.settingsManager.saveSettings()}))),r&&(r.style.display="",ze(r,((e,a)=>{if(void 0===a){const a=parseFloat(t.style.top)||0;return[e.clientY,{height:t.offsetHeight,top:a}]}return a-e.clientY}),((e,a)=>{let n=a.height+e;const r=.95*window.innerHeight;n=Math.max(200,Math.min(n,r));const o=(n-a.height)/window.innerHeight*100;let s=a.top-o;s=Math.max(0,s);const i=Math.round(n/window.innerHeight*100*10)/10,l=Math.round(10*s)/10;t.style.height=`${i}vh`,t.style.top=`${l}vh`}),(()=>{const a=J();e.main.panelHeights=e.main.panelHeights||{},e.main.panelHeights[a]=t.style.height,e.main.panelYPosition=e.main.panelYPosition||{};const n=parseFloat(t.style.top)||0;e.main.panelYPosition[a]=n,e.main.settingsManager.saveSettings()})))}function We(e,t){if("wrap"===e.main.viewManager.getDisplayMode()){const a=J(),n=e.main.panelYPosition[a]??0;"number"==typeof n&&n>=0&&n<=100&&(t.style.top=`${n}vh`);let r,o,s=!1;const i=e=>{if(!s)return;const a=e.clientY-r,n=o+a/window.innerHeight*100,i=t.offsetHeight,l=Math.max(0,(window.innerHeight-i)/window.innerHeight*100),c=Math.max(0,Math.min(n,l)),p=Math.round(10*c)/10;t.style.top=`${p}vh`},l=()=>{if(!s)return;s=!1,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",l);const a=J(),n=t.getBoundingClientRect(),r=Math.round(n.top/window.innerHeight*100*10)/10;e.main.panelYPosition[a]=r,e.main.settingsManager.saveSettings()},c=e=>{if(0!==e.button)return;if([".latest-game",".group-tab",".control-button",".resize-handle-horizontal",".resize-handle-vertical","#latest-games-search-input"].some((t=>e.target.closest(t))))return;s=!0,r=e.clientY;const a=t.getBoundingClientRect();o=a.top/window.innerHeight*100,document.addEventListener("mousemove",i),document.addEventListener("mouseup",l),e.preventDefault()};t.addEventListener("mousedown",c)}}const Ye={draggedElement:null,isDragging:!1,isRightHalf:!1,dragDirection:0,lastDragDirection:0,lastPanelDragY:0,dragOffset:{x:0,y:0},initialX:0,initialY:0,dragThreshold:1,rotationAccumulator:0,rotationDegreeLimit:5,globalEvents:{},reset(){this.draggedElement=null,this.isDragging=!1,this.isRightHalf=!1,this.dragDirection=0,this.lastDragDirection=0,this.lastPanelDragY=0,this.dragOffset={x:0,y:0},this.initialX=0,this.initialY=0,this.rotationAccumulator=0,this.globalEvents={}},cleanup(){this.globalEvents.handleDragMove&&document.removeEventListener("mousemove",this.globalEvents.handleDragMove),this.globalEvents.handleDragEnd&&document.removeEventListener("mouseup",this.globalEvents.handleDragEnd),this.globalEvents={}}};function Ke(e){const t=e.getBoundingClientRect(),a=e.parentElement.getBoundingClientRect(),n=e.parentElement;return{element:{rect:t,width:e.offsetWidth,height:e.offsetHeight},parent:{rect:a,width:n.offsetWidth,height:n.offsetHeight}}}let Ue=null;function Fe(){Ue&&Ue.parentNode&&Ue.parentNode.removeChild(Ue)}function Je(e,t){const a=Ke(Ye.draggedElement);let n=e.clientX-Ye.dragOffset.x-a.parent.rect.left,r=e.clientY-Ye.dragOffset.y-a.parent.rect.top;n=Math.max(0,Math.min(n,a.parent.width-a.element.width)),r=Math.max(0,Math.min(r,a.parent.height-a.element.height)),Ye.draggedElement.style.left=`${n}px`,Ye.draggedElement.style.top=`${r}px`;const o=Array.from(t.querySelectorAll(".pin-game:not(.dragging)"));let s=null,i=1/0;if(o.forEach((t=>{const a=t.getBoundingClientRect(),n=a.left+a.width/2,r=a.top+a.height/2,o=Math.hypot(e.clientX-n,e.clientY-r);o<i&&(i=o,s=t)})),Fe(),s){const a=s.getBoundingClientRect(),n=e.clientX<a.left+a.width/2,r=(Ue||(Ue=document.createElement("div"),Ue.className="drop-indicator",Ue.style.position="relative"),Ue);n?(t.insertBefore(r,s),t.insertBefore(Ye.draggedElement,r)):(t.insertBefore(r,s.nextSibling),t.insertBefore(Ye.draggedElement,r.nextSibling))}}function Xe(e,t){Ye.cleanup(),t.addEventListener("mousedown",(a=>{if(a.preventDefault(),0!==a.button)return;if(a.target.closest(".latest-game-buttons"))return;Ye.cleanup(),e.wasDragging=!1,Ye.initialX=a.clientX,Ye.initialY=a.clientY,Ye.isDragging=!0,Ye.draggedElement=t;const n=Ke(t),r=a.clientX-n.element.rect.left;Ye.isRightHalf=r>n.element.rect.width/2,Ye.lastPanelDragY=a.clientY,Ye.dragOffset={x:a.clientX-n.element.rect.left,y:a.clientY-n.element.rect.top},Ye.globalEvents.handleDragMove=t=>function(e,t){if(!Ye.isDragging||!Ye.draggedElement)return;if(document.querySelectorAll(".dragged-game").forEach((e=>e.classList.remove("dragged-game"))),!t.wasDragging&&function(e){return Math.abs(e.clientX-Ye.initialX)>Ye.dragThreshold||Math.abs(e.clientY-Ye.initialY)>Ye.dragThreshold}(e)&&(t.wasDragging=!0,Ye.draggedElement.classList.add("dragging"),"wrap"===t.viewManager.getDisplayMode())){const e=Ke(Ye.draggedElement);Ye.draggedElement.style.position="absolute",Ye.draggedElement.style.left=e.element.rect.left-e.parent.rect.left+"px",Ye.draggedElement.style.top=e.element.rect.top-e.parent.rect.top+"px",Ye.draggedElement.style.width=`${e.element.rect.width}px`}e.preventDefault();const a=t.viewManager.getDisplayMode(),n=document.getElementById("latest-games");"scroll"===a?function(e,t){const a=Array.from(t.querySelectorAll(".pin-game:not(.dragging)"));let n=null;for(const t of a){const a=t.getBoundingClientRect(),r=a.top+a.height/2;if(e.clientY<r)break;n=t}if(n)t.insertBefore(Ye.draggedElement,n.nextSibling);else{const e=t.querySelector(".pin-game:not(.dragging)");e&&t.insertBefore(Ye.draggedElement,e)}}(e,n):Je(e,n);const r=e.clientY,o=r-Ye.lastPanelDragY;if(Ye.lastPanelDragY=r,0!==o){const e=.2;Ye.rotationAccumulator=(Ye.rotationAccumulator||0)+(Ye.isRightHalf?o:-o)*e,Ye.rotationAccumulator=Math.max(-Ye.rotationDegreeLimit,Math.min(Ye.rotationDegreeLimit,Ye.rotationAccumulator)),Ye.draggedElement.style.transform=`rotate(${Ye.rotationAccumulator}deg)`}}(t,e),Ye.globalEvents.handleDragEnd=()=>function(e){if(Ye.cleanup(),Fe(),!Ye.isDragging||!Ye.draggedElement)return void Ye.reset();Ye.isDragging=!1,Ye.draggedElement.classList.remove("dragging"),Ye.draggedElement.classList.add("dragged-game");const t=e.viewManager.getDisplayMode();"wrap"===t&&(Ye.draggedElement.style.position="",Ye.draggedElement.style.left="",Ye.draggedElement.style.top="",Ye.draggedElement.style.width="");Ye.draggedElement.style.transform="",e.gamesManager.updateGameOrderFromDOM(),Ye.reset()}(e),document.addEventListener("mousemove",Ye.globalEvents.handleDragMove),document.addEventListener("mouseup",Ye.globalEvents.handleDragEnd)}))}const Ze=new class{constructor(){this.cache=new Map}getUserId(){const e=document.querySelector(".userpanel .user-block .name img");if(!e)return null;const t=e.src.match(/\/avatars\/(\d+)_/);return t?t[1]:null}parseGameParams(e){const t=e.href,a=new URL(t),n={};for(const[e,t]of a.searchParams)n[e]=t;return n}getGameId(e){const t=this.parseGameParams(e);return"voc"===t.gametype&&t.voc?t.voc:t.gametype?t.gametype:"normal"}buildApiUrl(e,t){const a=new URLSearchParams({userId:e}),n=Object.keys(C);return"voc"===t.gametype&&t.voc?a.append("gametype",`voc-${t.voc}`):t.gametype&&n.includes(t.gametype)?a.append("gametype",t.gametype):(console.warn(`Unsupported gametype "${t.gametype}", defaulting to "normal"`),a.append("gametype","normal")),`https://klavogonki.ru/api/profile/get-stats-details?${a.toString()}`}async fetchGameStats(e){if(this.cache.has(e))return this.cache.get(e);try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return this.cache.set(e,a),a}catch(e){return console.error("Failed to fetch game stats:",e),null}}formatTime(e){if(!e)return"N/A";return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`}formatDate(e){if(!e)return"N/A";try{return new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){return e}}formatStats(e,t,a){if(!e||!e.ok)return" ";const{gametype:n,info:r}=e;let o="";if(o+="## ",n){if(n.name&&(o+=`[] ${n.name}`),n.id&&(o+=`[ID ] ${n.id}`),n.type){o+=`[] ${S[n.type]||n.type}`}n.symbols&&(o+=`[] ${n.symbols.toLocaleString()}`),n.rows&&(o+=`[] ${n.rows.toLocaleString()}`)}if(o+="## ",r&&(r.num_races&&(o+=`[] ${r.num_races}`),r.avg_speed&&(o+=`[ ] ${Math.round(r.avg_speed)} /`),r.best_speed&&(o+=`[ ] ${r.best_speed} /`),void 0!==r.avg_error&&(o+=`[ % ] ${r.avg_error.toFixed(2)}%`),void 0!==r.qual&&(o+="[] "+(0===r.qual?"":"")),r.haul&&r.haul.total&&(o+=`[ ] ${this.formatTime(r.haul.total)}`),r.haul)){const e=[];r.haul.hour&&e.push(`${r.haul.hour}`),r.haul.min&&e.push(`${r.haul.min}`),e.length&&(o+=`[  ] ${e.join(" ")}`)}return o.trim()}async getGameStats(e){const t=e.closest("li").querySelector("a");if(!t)return"[]     ";const a=this.getGameId(t);if(!a)return"[]    ID ";const n=this.getUserId();if(!n)return`[Game ID] ${a} []    ID `;const r=this.parseGameParams(t),o=this.buildApiUrl(n,r);try{const e=await this.fetchGameStats(o);return this.formatStats(e,a,r)}catch(e){return console.error("Error getting game stats:",e),`[Game ID] ${a} []   `}}};async function Qe(e,t){const a="voc"===t.params.gametype&&t.params.vocId,n=t.params.gametype,r="https://klavogonki.ru";let o=[{text:`${y} `,className:"popup-button",onClick:()=>{const e=a?`${r}/vocs/${t.params.vocId}/top/day/`:`${r}/top/day/${n}/`;window.open(e,"_blank")}},{text:`${f} `,className:"popup-button",onClick:()=>{const e=a?`${r}/vocs/${t.params.vocId}/top/week/`:`${r}/top/week/${n}/`;window.open(e,"_blank")}}];if(a){const e=t.params.vocId,a=`${r}/vocs/${e}`,n=Ze.getUserId(),s=`${r}/u/#/${n}/stats`;if(o.unshift({text:`${x} `,className:"popup-button",onClick:()=>window.open(a+"/","_blank")}),o.push({text:`${w} `,className:"popup-button",onClick:()=>window.open(a+"/history/","_blank")},{text:`${k} `,className:"popup-button",onClick:()=>window.open(a+"/comments/","_blank")}),n){const a={gametype:t.params.gametype,voc:t.params.vocId||t.params.voc},r=Ze.buildApiUrl(n,a),i=await Ze.fetchGameStats(r);i&&i.ok&&i.info&&i.info.num_races>0&&o.push({text:`${M} `,className:"popup-button",onClick:()=>window.open(s+`/voc-${e}/`,"_blank")})}}return ue(o,e,"game-popup","")}function et(e,t,a){const n=e.gamesManager.getPreviousGameId(),r=t.pin?"pin-game":"",o=t.params&&t.params.gametype?`pin-gametype-${t.params.gametype}`:"",s=a===n?"previous-game":"";let i="";a===n&&(i="game"===J()?$.playing:$.paused);const l=X("li",{className:`latest-game ${r} ${o} ${s}`.trim(),id:`latest-game-${a}`});let c;const p=X("div",{className:"latest-game-buttons"});l.addEventListener("mouseenter",(()=>{c=setTimeout((()=>{p.style.visibility="visible"}),400)})),l.addEventListener("mouseleave",(()=>{clearTimeout(c),p.style.visibility="hidden"}));const g=X("div",{className:"latest-game-pin",innerHTML:t.pin?$.unpin:$.pin});W(g,t.pin?"[]   . [Shift + ]   .":"[]   . [Shift + ]   ."),g.addEventListener("click",(n=>{(n.shiftKey||confirm(t.pin?" ?":" ?"))&&e.gamesManager.pinGame(a)}));const d=X("div",{className:"latest-game-delete",innerHTML:$.delete});W(d,"[]   . [Shift + ]   ."),d.addEventListener("click",(t=>{(t.shiftKey||confirm(" ?"))&&e.gamesManager.deleteGame(a)}));const u=X("div",{className:"latest-game-info",innerHTML:$.info});W(u,"voc"===t.params.gametype&&t.params.vocId?"   ":"   "),u.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),Qe(e,t)})),p.append(u,g,d);const m=X("a",{href:e.gamesManager.generateGameLink(t),innerHTML:e.gamesManager.generateGameName(t,{stateIcon:i})});m.addEventListener("click",(a=>{e.wasDragging&&(a.preventDefault(),e.wasDragging=!1);try{const e=m.closest("li");if(e&&e.id&&e.id.startsWith("latest-game-")){const t=e.id.replace("latest-game-",""),a=JSON.parse(localStorage.getItem("latestGamesData"))||{};a.previousGameId=t,localStorage.setItem("latestGamesData",JSON.stringify(a))}}catch(e){}const n=String(t.params.vocId||"");if(n)try{e.gamesManager.registerPendingPlayed(n,t.params.vocName||null,t.params.vocType||null)}catch(e){}}));const h={vocabulary:new WeakMap,stats:new WeakMap};return m.addEventListener("mouseover",(async e=>{const a="voc"===t.params?.gametype&&t.params?.vocId;if(e.shiftKey&&a){e.preventDefault(),e.stopPropagation(),_();try{if(!h.vocabulary.has(m)){const e=await me(t.params.vocId);h.vocabulary.set(m,e)}xe(m,h.vocabulary.get(m))}catch(e){console.error("Error loading vocabulary:",e)}}else if(e.ctrlKey){we(),Y(m,"[Loading]  ...","stats");try{if(!h.stats.has(m)){const e=await Ze.getGameStats(m);h.stats.set(m,e)}Y(m,h.stats.get(m),"stats")}catch(e){console.error("Error loading game stats:",e),Y(m,"[]    ","stats")}}else Y(m,"\n    [Shift + ]   \n    [ ]     \n    [Shift + ]      \n    [Ctrl + ]   \n  ","info")})),m.addEventListener("mouseleave",(()=>{ke()})),l.appendChild(p),l.appendChild(m),t.pin&&e.enableDragging&&Xe(e,l),l}const tt="latestGamesSearchQuery";function at(){try{localStorage.removeItem(tt)}catch(e){console.warn("Failed to clear search query:",e)}}function nt(e,t){const a=e.value;if(!a)return void(t.style.left="");const n=function(e,t){const a=document.createElement("canvas").getContext("2d");return a.font=t,a.measureText(e).width}(a,function(e){const t=window.getComputedStyle(e);return`${t.fontWeight} ${t.fontSize} ${t.fontFamily}`}(e)),r=n+20;t.style.left=`${r}px`;r+(t.offsetWidth||24)>e.offsetWidth-8&&t.classList.remove("visible")}function rt(e){const t=X("div",{className:"latest-games-search-container "+(e.showSearchBox?"":"latest-games-hidden")}),a=X("input",{type:"search",id:"latest-games-search-input"}),n=X("div",{id:"latest-games-clear-button",className:"latest-games-clear-btn",innerHTML:$.delete});t.style.position="relative";const r=function(){try{return localStorage.getItem(tt)||""}catch(e){return console.warn("Failed to load search query:",e),""}}();return r&&(a.value=r,requestAnimationFrame((()=>{ot(n,r),nt(a,n),st(e,r)}))),a.addEventListener("input",(t=>{const r=t.target.value.trim();st(e,r),ot(n,r),nt(a,n),function(e){try{e&&e.trim()?localStorage.setItem(tt,e.trim()):localStorage.removeItem(tt)}catch(e){console.warn("Failed to save search query:",e)}}(r)})),n.addEventListener("click",(()=>{a.value="",a.focus(),st(e,""),ot(n,""),nt(a,n),at()})),a.addEventListener("keydown",(e=>{"Backspace"!==e.key&&"Delete"!==e.key||1!==a.value.length||a.value.trim()||at()})),ot(n,a.value),nt(a,n),t.appendChild(a),t.appendChild(n),t}function ot(e,t){e.classList.toggle("visible",!!t)}function st(e,t,a=!1){const n=document.getElementById("latest-games");if(!n)return;if(n.innerHTML="",!t)return void e.uiManager.populateGamesList(n);const r=[];if(e.groupsManager.groups.forEach((a=>{a.games.forEach((n=>{const o=function(e,t){const a=e.toLowerCase(),n=t.toLowerCase();if(!n)return 0;if(a===n)return-1e3;if(a.startsWith(n))return-500;if(a.includes(n))return-100;let r=0,o=0,s=0;for(;r<a.length&&o<n.length;)a[r]===n[o]?o++:s++,r++;return o===n.length?s:1/0}(e.gamesManager.generateGameName(n),t);o!==1/0&&r.push({group:a,game:n,score:o})}))})),0===r.length){const e=X("li",{className:"latest-games-search-noresults",textContent:"  "});return void n.appendChild(e)}r.sort(((e,t)=>e.score-t.score));const o=a?r.length:50,s=r.slice(0,o),i=r.length-o;if(s.forEach((({group:t,game:a})=>{const r=e.uiManager.createGameElement(a,a.id);r.classList.add("latest-games-search-result"),r.addEventListener("click",(()=>{e.groupsManager.currentGroupId=t.id,e.uiManager.refreshContainer(),setTimeout((()=>{const e=document.getElementById(`latest-game-${a.id}`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),100)})),n.appendChild(r)})),i>0){const a=X("li",{className:"latest-games-search-more",textContent:` ${i}  `});W(a,"    "),a.addEventListener("click",(()=>{st(e,t,!0)})),n.appendChild(a)}}const it={popup:null,isDragging:!1,offsetX:0,offsetY:0,hasUnsavedChanges:!1,currentListType:"bannedVocabularies",listConfigs:{bannedVocabularies:{title:" ",adjective:"",mainKey:"bannedVocabularies",backupKey:"bannedVocabularies*Backup"},playedVocabularies:{title:" ",adjective:"",mainKey:"playedVocabularies",backupKey:"playedVocabularies*Backup"}},getConfig(){return this.listConfigs[this.currentListType]},get(){try{const e=this.getConfig(),t=localStorage[e.backupKey]?e.backupKey:e.mainKey,a=JSON.parse(localStorage[t])||[];return this.hasUnsavedChanges=t===e.backupKey,a.map((e=>"string"==typeof e?{id:e,isNew:!1}:{...e,isNew:e.isNew||!1}))}catch{return[]}},save(e,t=!0){const a=this.getConfig();if(t)localStorage[a.backupKey]=JSON.stringify(e),this.hasUnsavedChanges=!0;else{const t=this.hasUnsavedChanges?a.backupKey:a.mainKey;localStorage[t]=JSON.stringify(e)}},commitSave(){const e=this.getConfig(),t=localStorage[e.backupKey];t&&(localStorage[e.mainKey]=t,delete localStorage[e.backupKey]),this.hasUnsavedChanges=!1},revertChanges(){const e=this.getConfig();delete localStorage[e.backupKey],this.hasUnsavedChanges=!1},add(e){const t=this.get();t.some((t=>t.id===e))||(t.push({id:e,isNew:!0}),this.save(t))},filterVocabs(e,t,a="all",n="all"){let r=e;if("new"===a?r=r.filter((e=>e.isNew)):"old"===a?r=r.filter((e=>!e.isNew)):"unavailable"===a&&(r=r.filter((e=>!e.name))),"all"!==n&&(r=r.filter((e=>e.vocType===n))),t?.trim()){const e=t.toLowerCase().trim();r=r.filter((t=>t.id.toLowerCase().includes(e)||t.name&&t.name.toLowerCase().includes(e)||t.author&&t.author.toLowerCase().includes(e)))}return r},async fetchAndCacheVocabData(e,t=!1){if(!t&&e.name&&e.author&&e.vocType)return e;const a=await Se(e.id);return a?{...e,name:a.vocabularyName,author:a.vocabularyAuthor,vocType:a.vocabularyType}:{...e,name:null,author:null,vocType:null}},remove(e){this.save(this.get().filter((t=>t.id!==e))),this.refresh()},toggleBtnText(e,t,a,n=1e3){const r=this.popup.querySelector(e),o=a();r.textContent=t,setTimeout((()=>r.textContent=o),n)},async copy(e=null,t=!1,a="all",n="all",r=!1){const o=e||this.get();let s;if(t){s=o.map(((e,t)=>`${t+1}. : ${e.author||" "}, : ${e.name||" "} - ${`https://klavogonki.ru/vocs/${e.id}/`}`)).join("\n")}else s=o.map((e=>e.id)).join(",");try{await navigator.clipboard.writeText(s)}catch{}this.toggleBtnText(".copy-all-btn","!",(()=>this.getButtonText("copy",a,n,o.length,r)))},removeAll(e="all",t="all",a=null){const n=this.get();let r;if(a){const e=new Set(a.map((e=>e.id)));r=n.filter((t=>!e.has(t.id)))}else r="all"===e&&"all"===t?[]:n.filter((a=>{let n=!0,r=!0;return"new"===e?n=!a.isNew:"old"===e?n=a.isNew:"unavailable"===e&&(n=!!a.name),"all"!==t&&(r=a.vocType!==t),n&&r}));const o=n.length-r.length;this.save(r),this.toggleBtnText(".remove-all-btn","!",(()=>this.getButtonText("remove",e,t,o,!!a))),this.refresh()},getButtonText(e,t,a,n,r=!1){const o={all:"",new:"",old:"",unavailable:""},s={words:"",phrases:"",texts:"",url:"URL",books:"",generator:""},i={copy:"",remove:""}[e]||"";if(r)return`${i}  (${n})`;const l=[];"all"!==t&&l.push(o[t]),"all"!==a&&l.push(s[a]);return`${i} ${l.length>0?l.join(" "):o.all} (${n})`},sortAll(){let e=this.get().map((e=>({...e,isNew:!1})));if("playedVocabularies"===this.currentListType){e.forEach((e=>{e.playHistory&&Array.isArray(e.playHistory)&&(e.playHistory=e.playHistory.sort(((e,t)=>new Date(e.date)-new Date(t.date))))}));const t={};e.forEach((e=>{if(e.playHistory&&e.playHistory.length>0){const a=e.playHistory[0].date,n=new Date(a).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"});t[n]||(t[n]=[]),t[n].push(e)}}));e=Object.keys(t).sort(((e,t)=>new Date(e)-new Date(t))).flatMap((e=>t[e].sort(((e,t)=>parseInt(e.id)-parseInt(t.id)))))}else e.sort(((e,t)=>parseInt(e.id)-parseInt(t.id)));this.save(e),this.toggleBtnText(".sort-all-btn","!",(()=>"")),this.refresh()},async forceFetchAll(){const e=this.popup.querySelector(".force-fetch-btn");e.textContent="...",e.disabled=!0;const t=this.get(),a=await Promise.all(t.map((e=>this.fetchAndCacheVocabData(e,!0)))),n=a.filter((e=>e.name)).length,r=a.filter((e=>!e.name)).length;this.save(a,!1),e.disabled=!1,this.toggleBtnText(".force-fetch-btn","!",(()=>" ")),await this.refresh(),alert(` !\n\n : ${a.length}\n: ${n}\n: ${r}`)},async handleSave(){this.commitSave(),this.toggleBtnText(".save-btn","!",(()=>"")),await this.refresh()},async handleRevert(){this.revertChanges(),this.toggleBtnText(".revert-btn","!",(()=>"")),await this.refresh()},scrollToBottom(){if(this.popup){const e=this.popup.querySelector(".vocab-list");e&&(e.scrollTop=e.scrollHeight)}},scheduleScrollToBottom(){requestAnimationFrame((()=>this.scrollToBottom()))},createSearchAndFilterSection(){const e=document.createElement("div");e.className="popup-search-filters";const t=Object.assign(document.createElement("input"),{type:"text",placeholder:"  ID,   ...",className:"search-input"}),a=document.createElement("div");a.className="filter-buttons";const n=Object.assign(document.createElement("button"),{className:"filter-btn active",textContent:""});n.setAttribute("data-filter","all"),W(n,"  ");const r=Object.assign(document.createElement("button"),{className:"filter-btn",textContent:""});r.setAttribute("data-filter","new"),W(r,"   ");const o=Object.assign(document.createElement("button"),{className:"filter-btn",textContent:""});o.setAttribute("data-filter","old"),W(o,"   ");const s=Object.assign(document.createElement("button"),{className:"filter-btn",textContent:""});s.setAttribute("data-filter","unavailable"),W(s,"   "),a.append(n,r,o,s);const i=document.createElement("div");i.className="filter-buttons type-filter-buttons";const l=Object.assign(document.createElement("button"),{className:"filter-btn active",textContent:" "});l.setAttribute("data-type-filter","all"),W(l,"   ");const c=Object.assign(document.createElement("button"),{className:"filter-btn",textContent:""});c.setAttribute("data-type-filter","words"),W(c,'    ""');const p=Object.assign(document.createElement("button"),{className:"filter-btn",textContent:""});p.setAttribute("data-type-filter","phrases"),W(p,'    ""');const g=Object.assign(document.createElement("button"),{className:"filter-btn",textContent:""});g.setAttribute("data-type-filter","texts"),W(g,'    ""');const d=Object.assign(document.createElement("button"),{className:"filter-btn",textContent:"URL"});d.setAttribute("data-type-filter","url"),W(d,'    "URL"');const u=Object.assign(document.createElement("button"),{className:"filter-btn",textContent:""});u.setAttribute("data-type-filter","books"),W(u,'    ""');const m=Object.assign(document.createElement("button"),{className:"filter-btn",textContent:""});return m.setAttribute("data-type-filter","generator"),W(m,'    ""'),i.append(l,c,p,g,d,u,m),e.append(t,a,i),{searchSection:e,searchInput:t,statusFilterContainer:a,typeFilterContainer:i}},createVocabItem(e,t=0){const a=document.createElement("div");a.className="vocab-item",e.isNew&&a.classList.add("vocab-item-new"),a.dataset.id=e.id,a.style.cursor="pointer";const n=document.createElement("div");n.className="vocab-left";const r=Object.assign(document.createElement("button"),{className:"vocab-play-btn control-button",innerHTML:$.start});r.addEventListener("click",(t=>{t.stopPropagation();const a=new URLSearchParams({gametype:"voc",type:"normal",timeout:"10",level_from:"1",level_to:"9",submit:"1",voc:String(e.id)});window.location.href=`${location.protocol}//klavogonki.ru/create/?${a.toString()}`}));const o=Object.assign(document.createElement("button"),{className:"vocab-info-btn control-button",innerHTML:$.info});o.addEventListener("click",(t=>{t.stopPropagation();Qe(t,{params:{gametype:"voc",vocId:e.id}})}));const s=Object.assign(document.createElement("span"),{className:"vocab-id",textContent:e.id});if(n.appendChild(r),n.appendChild(o),n.appendChild(s),t>1){const e=Object.assign(document.createElement("span"),{className:"vocab-play-count-badge",textContent:t.toString()});n.appendChild(e)}const i=document.createElement("div");if(i.className="vocab-right",e.name){const t=Object.assign(document.createElement("div"),{className:"vocab-name",textContent:e.name});if(i.appendChild(t),e.author){const t=Object.assign(document.createElement("div"),{className:"vocab-author",textContent:`: ${e.author}`});i.appendChild(t)}if(e.vocType){const t=Object.keys(E).find((t=>E[t]===e.vocType))||e.vocType,a=Object.assign(document.createElement("div"),{className:"vocab-type",textContent:` : ${t}`});i.appendChild(a)}}else{const e=Object.assign(document.createElement("div"),{className:"vocab-loading",textContent:"  "});i.appendChild(e)}const l=Object.assign(document.createElement("button"),{className:"remove-btn",textContent:""});return a.append(n,i,l),a},async createElements(){const e=this.get(),t=document.createElement("div");t.className="vocabularies-manager-popup";const a=document.createElement("div");a.className="popup-header";const n=this.getConfig();a.textContent=this.hasUnsavedChanges?`${n.title} *`:n.title,a.style.cursor="move",a.addEventListener("mousedown",(e=>this.startDrag(e))),t.appendChild(a);const r=document.createElement("div");r.className="popup-actions";const o=Object.assign(document.createElement("button"),{className:"copy-all-btn",textContent:this.getButtonText("copy","all","all",e.length,!1),disabled:!e.length});W(o,"[]         \n      [Shift + ]      ,   ");const s=Object.assign(document.createElement("button"),{className:"remove-all-btn",textContent:this.getButtonText("remove","all","all",e.length,!1),disabled:!e.length});W(s,"        ");const i=Object.assign(document.createElement("button"),{className:"sort-all-btn",textContent:"",disabled:!e.length,onclick:()=>this.sortAll()});W(i,"    ID    ");const l=Object.assign(document.createElement("button"),{className:"force-fetch-btn",textContent:"",disabled:!e.length,onclick:()=>this.forceFetchAll()});if(W(l,"     "),r.append(o,s,i,l),this.hasUnsavedChanges){const e=Object.assign(document.createElement("button"),{className:"save-btn",textContent:"",onclick:()=>this.handleSave()});W(e,"[Ctrl + S]  ");const t=Object.assign(document.createElement("button"),{className:"revert-btn",textContent:"",onclick:()=>this.handleRevert()});W(t,"[Ctrl + Z]   "),r.append(e,t)}t.appendChild(r);const{searchSection:c,searchInput:p,statusFilterContainer:g,typeFilterContainer:d}=this.createSearchAndFilterSection();t.appendChild(c);const u=document.createElement("div");if(u.className="vocab-list",e.length){const t=await Promise.all(e.map((e=>this.fetchAndCacheVocabData(e))));this.save(t,!1);let a=t,n="all",r="all";const i=(e,a,n,r)=>{const i=r?.trim().length>0;if(o.textContent=this.getButtonText("copy",e,a,n.length,i),o.disabled=0===n.length,i)s.textContent=this.getButtonText("remove",e,a,n.length,!0),s.disabled=0===n.length;else{const n=this.filterVocabs(t,"",e,a);s.textContent=this.getButtonText("remove",e,a,n.length,!1),s.disabled=0===n.length}},l=()=>{const e=g.querySelector('[data-filter="all"]'),a=g.querySelector('[data-filter="new"]'),n=g.querySelector('[data-filter="old"]'),r=g.querySelector('[data-filter="unavailable"]'),o=t.filter((e=>e.isNew)).length,s=t.filter((e=>!e.isNew)).length,i=t.filter((e=>!e.name)).length;e.textContent=` (${t.length})`,a.textContent=` (${o})`,n.textContent=` (${s})`,r.textContent=` (${i})`;const l=d.querySelector('[data-type-filter="all"]'),c=t.filter((e=>"words"===e.vocType)).length,p=t.filter((e=>"phrases"===e.vocType)).length,u=t.filter((e=>"texts"===e.vocType)).length,m=t.filter((e=>"url"===e.vocType)).length,h=t.filter((e=>"books"===e.vocType)).length,v=t.filter((e=>"generator"===e.vocType)).length;l.textContent=`  (${t.length})`,d.querySelector('[data-type-filter="words"]').textContent=` (${c})`,d.querySelector('[data-type-filter="phrases"]').textContent=` (${p})`,d.querySelector('[data-type-filter="texts"]').textContent=` (${u})`,d.querySelector('[data-type-filter="url"]').textContent=`URL (${m})`,d.querySelector('[data-type-filter="books"]').textContent=` (${h})`,d.querySelector('[data-type-filter="generator"]').textContent=` (${v})`},c=e=>{if(u.innerHTML="",a=e,0===e.length){const e=document.createElement("div");return e.className="empty-state",e.textContent="  ",void u.appendChild(e)}if("playedVocabularies"===this.currentListType){const t=new Map;e.forEach((e=>{e.playHistory&&Array.isArray(e.playHistory)&&e.playHistory.forEach((a=>{const n=new Date(a.date).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"});t.has(n)||t.set(n,{items:[],sortDate:new Date(a.date)}),t.get(n).items.push({vocab:e,count:a.count,date:a.date})}))}));Array.from(t.entries()).sort(((e,t)=>e[1].sortDate-t[1].sortDate)).map((([e])=>e)).forEach((e=>{const a=t.get(e).items,n=a.length,r=a.reduce(((e,{count:t})=>e+t),0),o=document.createElement("div");o.className="vocab-labels-container";const s=document.createElement("div");s.className="vocab-date",s.textContent=`${e}`;const i=document.createElement("div");i.className="vocab-count",i.textContent=r>n?`: ${n} | : ${r}`:`: ${n}`,o.appendChild(s),o.appendChild(i),u.appendChild(o),a.forEach((({vocab:e,count:t})=>{u.appendChild(this.createVocabItem(e,t))}))}))}else e.forEach((e=>u.appendChild(this.createVocabItem(e,0))));this.scheduleScrollToBottom()},m=()=>{const e=p.value,a=this.filterVocabs(t,e,n,r);c(a),i(n,r,a,e)};l(),c(t),i(n,r,a,""),o.addEventListener("click",(e=>{const t=e.shiftKey,o=p.value.trim().length>0;this.copy(a,t,n,r,o)})),s.addEventListener("click",(()=>{const e=p.value.trim().length>0;this.removeAll(n,r,e?a:null)})),p.addEventListener("input",m),g.addEventListener("click",(e=>{e.target.classList.contains("filter-btn")&&(g.querySelectorAll(".filter-btn").forEach((e=>e.classList.remove("active"))),e.target.classList.add("active"),n=e.target.dataset.filter,m())})),d.addEventListener("click",(e=>{e.target.classList.contains("filter-btn")&&(d.querySelectorAll(".filter-btn").forEach((e=>e.classList.remove("active"))),e.target.classList.add("active"),r=e.target.dataset.typeFilter,m())})),u.addEventListener("click",(e=>{const t=e.target.closest(".vocab-item");if(!t)return;const a=t.dataset.id;e.target.classList.contains("remove-btn")?this.remove(a):window.open(`https://klavogonki.ru/vocs/${a}/`,"_blank")})),u.addEventListener("mouseover",(e=>{if(!e.shiftKey)return;const t=e.target.closest(".vocab-item");if(!t)return;const a=t.dataset.id||t.querySelector(".vocab-id")?.textContent;a&&me(a).then((e=>xe(t,e))).catch((()=>{}))}),{capture:!0}),u.addEventListener("mouseout",(e=>{e.target.closest(".vocab-item")&&ke()}),{capture:!0})}else{const e=document.createElement("div");e.className="empty-state",e.textContent=` ${this.getConfig().adjective} `,u.appendChild(e)}return t.appendChild(u),t},async refresh(){if(this.popup){const e=await this.createElements(),t=this.popup.parentNode,a=this.popup.getBoundingClientRect();t.replaceChild(e,this.popup),this.popup=e,this.popup.style.left=a.left+"px",this.popup.style.top=a.top+"px",this.scheduleScrollToBottom()}},async show(e=100,t=100,a=20,n=20){this.hide(),this.popup=await this.createElements(),document.body.appendChild(this.popup),this.popup.style.left=e+a+"px",this.popup.style.top=t+n+"px",this.constrainToScreen(),this.scheduleScrollToBottom(),setTimeout((()=>{document.addEventListener("click",this.outside),document.addEventListener("keydown",this.keydown)}),100)},hide(){this.popup&&(document.body.removeChild(this.popup),this.popup=null,this.isDragging=!1,document.removeEventListener("click",this.outside),document.removeEventListener("keydown",this.keydown),document.removeEventListener("mousemove",this.drag),document.removeEventListener("mouseup",this.stopDrag))},toggle(e,t,a="bannedVocabularies"){this.popup?this.currentListType===a?this.hide():(this.currentListType=a,this.refresh().catch((()=>{}))):(this.currentListType=a,this.show(e,t))},outside:e=>{it.popup?.contains(e.target)||"BUTTON"===e.target.tagName||it.hide()},keydown:e=>{"Escape"===e.key?it.hide():(e.ctrlKey||e.metaKey)&&"s"===e.key?(e.preventDefault(),it.hasUnsavedChanges&&it.handleSave()):(e.ctrlKey||e.metaKey)&&"z"===e.key&&(e.preventDefault(),it.hasUnsavedChanges&&it.handleRevert())},startDrag(e){this.isDragging=!0;const t=this.popup.getBoundingClientRect();this.offsetX=e.clientX-t.left,this.offsetY=e.clientY-t.top,document.addEventListener("mousemove",this.drag),document.addEventListener("mouseup",this.stopDrag)},drag:e=>{it.isDragging&&it.popup&&(it.popup.style.left=e.clientX-it.offsetX+"px",it.popup.style.top=e.clientY-it.offsetY+"px",it.constrainToScreen())},stopDrag:()=>{it.isDragging=!1,document.removeEventListener("mousemove",it.drag),document.removeEventListener("mouseup",it.stopDrag)},constrainToScreen(){if(!this.popup)return;const e=this.popup.getBoundingClientRect(),t=window.innerWidth-e.width,a=window.innerHeight-e.height;e.left<0&&(this.popup.style.left="0px"),e.top<0&&(this.popup.style.top="0px"),e.left>t&&(this.popup.style.left=t+"px"),e.top>a&&(this.popup.style.top=a+"px")}},lt=Object.entries(E).map((([e,t])=>({label:e,key:t}))),ct=e=>{const t=e?JSON.parse(e):[];return Array.isArray(t)?t.map((e=>String("object"==typeof e&&e?.id?e.id:e))):[]};function pt(e,t){try{const a=(e.validVocabularies?.[t]||[]).length,n=new Set(ct(localStorage.getItem("playedVocabularies"))),r=new Set(ct(localStorage.getItem("bannedVocabularies"))),o=(JSON.parse(localStorage.getItem("validVocabularies")||"{}")[t]||[]).filter((e=>n.has(String(e))&&!r.has(String(e)))).length;return{total:o+a,played:o,remained:a}}catch(e){return console.warn("Error calculating vocabulary counts:",e),{total:0,played:0,remained:0}}}function gt(e,t,a){return a&&0!==t?0===e?" danger":e<=10?" warning":"":""}function dt(e,t){const a=lt.map((({label:e,key:a})=>{const n=pt(t,a),r=t.randomVocabulariesType[a];return{text:e,className:`group-tab${r?" active":""}${gt(n.remained,n.total,r)}`,onClick:e=>function(e,t,a){if(!(e instanceof HTMLElement))return;const n=!a.randomVocabulariesType[t];if(a.randomVocabulariesType[t]=n,e.classList.remove("active","warning","danger"),n){e.classList.add("active");const n=pt(a,t),r=gt(n.remained,n.total,!0).trim();r&&e.classList.add(r)}a.settingsManager.saveSettings()}(e,a,t),counts:n}})),n=ue(a,e,"vocabulary-types-popup","",!0);return n.querySelectorAll(".group-tab").forEach(((e,t)=>{const{total:n,played:r,remained:o}=a[t].counts;W(e,`[:]${n} [:]${r} [:]${o}`,"stats")})),n}function ut(e){const t=X("div",{className:"latest-games-controls"}),a=X("div",{className:"controls-limiter"}),n=X("div",{className:"controls-buttons"}),r=X("div",{className:"controls-visible"}),o=X("div",{className:"controls-more"});n.append(r,o),o.appendChild(a),t.append(n);const s=X("span",{id:"latest-games-options"});a.appendChild(s);const i=X("span",{id:"latest-games-count-dec",className:"control-button",innerHTML:$.decrease});W(i,"   ");const l=X("span",{id:"latest-games-count",className:!1===e.shouldAutoSave?"latest-games-disabled":"",textContent:e.maxGameCount.toString()});W(l,e.shouldAutoSave?" ":" "),l.addEventListener("click",(()=>{e.shouldAutoSave=!e.shouldAutoSave,e.uiManager.updateGameCountDisplay(),e.settingsManager.saveSettings(),e.uiManager.refreshContainer()}));const c=X("span",{id:"latest-games-count-inc",className:"control-button",innerHTML:$.increase});W(c,"   "),i.addEventListener("click",(()=>e.gamesManager.changeGameCount(-1))),c.addEventListener("click",(()=>e.gamesManager.changeGameCount(1))),s.append(i,l,c);const p=(e,t,a,n)=>{const r="function"==typeof a.click?a.click(t):a.click,o="function"==typeof a.shift?a.shift(t):a.shift,s=a.ctrl?"function"==typeof a.ctrl?a.ctrl(t):a.ctrl:"",i=a.alt?"function"==typeof a.alt?a.alt(t):a.alt:"",l=a.shiftAlt?"function"==typeof a.shiftAlt?a.shiftAlt(t):a.shiftAlt:"";W(e,`\n      [] ${r}\n      [Shift + ] ${o}${n?` (${n} )`:""}\n      ${s?`[Ctrl + ] ${s}`:""}\n      ${i?`[Alt + ] ${i}`:""}\n      ${l?`[Shift + Alt + ] ${l}`:""}\n    `)},g=(t,a,n,r,o)=>{const s=a[n];t.classList.toggle("latest-games-disabled",!s),p(t,s,o,a[r]),t.onclick=s=>{if(s.ctrlKey&&t===v)return e.replayNextGame=!e.replayNextGame,e.settingsManager.saveSettings(),t.classList.toggle("replay-next-game",e.replayNextGame),t.innerHTML=h(),void p(t,a[n],o,a[r]);if(s.altKey&&t===v)return e.replayWithoutWaiting=!e.replayWithoutWaiting,e.settingsManager.saveSettings(),t.classList.toggle("replay-without-waiting",e.replayWithoutWaiting),t.innerHTML=h(),void p(t,a[n],o,a[r]);const i="function"==typeof o.shift?o.shift(a[n]):o.shift;if(s.shiftKey){const s=prompt(i,"");if(null!==s){const i=parseInt(s,10);!isNaN(i)&&i>=0?(a[r]=i,e.settingsManager.saveSettings(),p(t,a[n],o,i)):alert(o.delayErrorText)}}else a[n]=!a[n],e.settingsManager.saveSettings(),t.classList.toggle("latest-games-disabled",!a[n]),p(t,a[n],o,a[r])}},d=X("span",{className:"latest-games-refresh control-button",innerHTML:$.refresh});W(d,"\n    []    ID     \n    [Shift + ]       ( )\n  "),d.addEventListener("click",(async t=>{if(t.shiftKey){if(!confirm(" ,          ?    ."))return;const t=[];if(e.groupsManager.groups.forEach((e=>{e.games.forEach((a=>{!a.params||null!==a.params.vocType&&void 0!==a.params.vocType||t.push({group:e,game:a})}))})),0===t.length)return void alert("      .");let a=0;const n=500;for(const{group:e,game:r}of t){const e=r.params.vocId;if(e){const t=await Se(e).catch((()=>null));t&&t.vocabularyType&&(r.params.vocType=t.vocabularyType,a++)}n>0&&await new Promise((e=>setTimeout(e,n)))}e.gamesManager.saveGameData(),e.uiManager.refreshContainer(),alert(`  ${a}    .`)}else{if(!confirm(" ,      ID     ?    ."))return;const t=e.groupsManager.currentGroupId,a=e.gamesManager.latestGamesData?.previousGameId;if(e.groupsManager.groups.forEach((e=>{e._oldId=e.id,e.games.forEach((e=>{e._oldId=e.id}))})),e.groupsManager.groups.forEach((t=>{t.id=U(e.groupsManager.groups),t.games.forEach((t=>{t.id=U(e.groupsManager.groups)}))})),t){const a=e.groupsManager.groups.find((e=>e._oldId===t));a&&(e.groupsManager.currentGroupId=a.id)}if(a)for(const t of e.groupsManager.groups){const n=t.games.find((e=>e._oldId===a));if(n){e.gamesManager.latestGamesData.previousGameId=n.id;break}}e.groupsManager.groups.forEach((e=>{delete e._oldId,e.games.forEach((e=>delete e._oldId))})),e.gamesManager.saveGameData(),e.uiManager.refreshContainer(),alert("  ID      !")}}));const u=X("span",{className:"latest-games-reset-panels control-button",innerHTML:$.reset});W(u,"      "),u.addEventListener("click",(()=>{confirm(" ,         ?    .")&&function(e){e.panelWidths={...D.panelWidths},e.panelHeights={...D.panelHeights},e.panelYPosition={...D.panelYPosition},e.alwaysVisiblePanel={...D.alwaysVisiblePanel},e.settingsManager.saveSettings(),e.uiManager&&e.uiManager.refreshContainer&&e.uiManager.refreshContainer()}(e)}));const m=X("span",{className:"latest-games-play control-button",innerHTML:$.play});g(m,e,"shouldStart","startDelay",{click:e=>e?"  ":"  ",shift:()=>"    ",delayErrorText:",     ."});const h=()=>e.replayWithoutWaiting?$.replayImmediately:$.replay,v=X("span",{className:"latest-games-replay control-button"+(e.replayNextGame?" replay-next-game":"")+(e.replayWithoutWaiting?" replay-without-waiting":""),innerHTML:h()});g(v,e,"shouldReplay","replayDelay",{click:e=>e?"  ":"  ",shift:()=>"    :",ctrl:()=>e.replayNextGame?"   ":"   ",alt:()=>e.replayWithoutWaiting?"    ":"    ",delayErrorText:",     ."});const b=X("span",{className:"latest-games-replay-more control-button"+(!1===e.shouldReplayMore?" latest-games-disabled":""),innerHTML:$.replayMore}),y=()=>{W(b,`\n      [] ${e.shouldReplayMore?"   ":"   "}\n      [Shift + ]    (${e.replayNextGameCount})\n    `)};y(),b.onclick=t=>{if(t.shiftKey){let t;for(;;){if(t=prompt("   :",e.replayNextGameCount.toString()),null===t)return;const a=parseInt(t,10);if(!isNaN(a)&&a>=1)return e.replayNextGameCount=a,e.settingsManager.saveSettings(),void y();alert(" ,    (   1).")}}else e.shouldReplayMore=!e.shouldReplayMore,e.settingsManager.saveSettings(),b.classList.toggle("latest-games-disabled",!e.shouldReplayMore),y()};const f=X("span",{className:"latest-games-pinall control-button",innerHTML:$.pin});W(f,"\n    []      \n    [Shift + ]      \n  "),f.onclick=t=>{if(t.shiftKey)e.groupsManager.groups.forEach((e=>e.games.forEach((e=>e.pin=1))));else{const t=e.groupsManager.getCurrentGroup(e.groupsManager.groups,e.groupsManager.currentGroupId);t&&t.games.forEach((e=>e.pin=1))}e.gamesManager.saveGameData(),e.uiManager.refreshContainer()};const x=X("span",{className:"latest-games-unpinall control-button",innerHTML:$.unpin});W(x,"\n    []      \n    [Shift + ]      \n  "),x.onclick=t=>{if(t.shiftKey)e.groupsManager.groups.forEach((e=>e.games.forEach((e=>e.pin=0))));else{const t=e.groupsManager.getCurrentGroup(e.groupsManager.groups,e.groupsManager.currentGroupId);t&&t.games.forEach((e=>e.pin=0))}e.gamesManager.saveGameData(),e.uiManager.refreshContainer()};const w=X("span",{className:"latest-games-sort control-button",innerHTML:$.sort});W(w,"      "),w.addEventListener("click",(()=>e.groupsManager.sortActiveGroupGames()));const k=X("span",{className:"latest-games-import control-button",innerHTML:$.import});W(k,"   JSON "),k.onclick=()=>e.settingsManager.importSettings(e);const M=X("span",{className:"latest-games-export control-button",innerHTML:$.export});W(M,"    JSON "),M.onclick=()=>e.settingsManager.exportSettings(e);const C=X("span",{className:"latest-games-removeall control-button",innerHTML:$.trashNothing});W(C,"  "),C.onclick=()=>e.settingsManager.removeAllSettings(e);const S=X("span",{className:"latest-games-remove-unpinned control-button",innerHTML:$.broom});W(S,"\n    []       \n    [Shift + ]       \n  "),S.onclick=t=>{if(t.shiftKey)e.groupsManager.groups.forEach((e=>{e.games=e.games.filter((e=>e.pin))}));else{const t=e.groupsManager.getCurrentGroup(e.groupsManager.groups,e.groupsManager.currentGroupId);t&&(t.games=t.games.filter((e=>e.pin)))}e.gamesManager.saveGameData(),e.uiManager.refreshContainer()};const E=X("span",{className:"latest-games-drag-toggle control-button",innerHTML:$.dragToggle});W(E,e.enableDragging?" ":" "),E.classList.toggle("latest-games-disabled",!e.enableDragging),E.onclick=()=>{e.enableDragging=!e.enableDragging,e.settingsManager.saveSettings(),e.uiManager.refreshContainer(),W(E,e.enableDragging?" ":" "),E.classList.toggle("latest-games-disabled",!e.enableDragging)};const G=X("span",{className:"latest-games-desc-toggle control-button",innerHTML:$.info});W(G,e.showButtonDescriptions?"  ":"  "),G.classList.toggle("latest-games-disabled",!e.showButtonDescriptions),G.onclick=()=>{e.showButtonDescriptions=!e.showButtonDescriptions,e.settingsManager.saveSettings(),G.classList.toggle("latest-games-disabled",!e.showButtonDescriptions),W(G,e.showButtonDescriptions?"  ":"  "),e.uiManager.refreshContainer(),setTimeout((()=>{const e=document.querySelector(".latest-games-controls");e&&(e.scrollTop=e.scrollHeight)}),0)};const L=X("span",{className:"latest-games-help-toggle control-button"+(e.showHelpTooltips?"":" latest-games-disabled"),innerHTML:$.help}),I=()=>{W(L,e.showHelpTooltips?" ":" ","help"),L.classList.toggle("latest-games-disabled",!e.showHelpTooltips)};I(),L.addEventListener("click",(()=>{P=null,e.showHelpTooltips=!e.showHelpTooltips,e.settingsManager.saveSettings(),I(),e.uiManager.refreshContainer()}));const T=X("span",{className:"latest-games-search-btn control-button"+(e.showSearchBox?"":" latest-games-disabled"),innerHTML:$.search}),N=()=>{W(T,e.showSearchBox?"  ":"  "),T.classList.toggle("latest-games-disabled",!e.showSearchBox)};N(),T.addEventListener("click",(()=>{!function(e){const t=document.querySelector(".latest-games-search-container");if(!t)return;const a=t.classList.toggle("latest-games-hidden");if(e.showSearchBox=!a,e.settingsManager&&"function"==typeof e.settingsManager.saveSettings&&e.settingsManager.saveSettings(),!a){const e=document.getElementById("latest-games-search-input");e&&(e.focus(),e.select())}}(e),N()}));const A=X("span",{className:"latest-games-random control-button"+(e.randomGameId?"":" latest-games-disabled"),innerHTML:$.random}),H=()=>{p(A,!!e.randomGameId,{click:t=>{const a="global"===e.randomGameId?"":"local"===e.randomGameId?"":"";return t?`    (${a})`:`    (${a})`},shift:()=>{let e=[];try{const t=JSON.parse(localStorage.getItem("validVocabularies")||"{}");t&&"object"==typeof t&&(e=Object.values(t).flat().filter(Boolean).map(String))}catch(t){e=[]}const t=new Set(e).size,a=(()=>{try{return new Set([...(JSON.parse(localStorage.getItem("bannedVocabularies")||"[]")||[]).map((e=>String("string"==typeof e?e:e.id||e||""))),...(JSON.parse(localStorage.getItem("playedVocabularies")||"[]")||[]).map((e=>String("string"==typeof e?e:e.id||e||"")))].filter(Boolean))}catch(e){return new Set}})();let n=0;for(const t of new Set(e))a.has(t)||n++;return`    (: ${t}, : ${n})`},ctrl:()=>e.showBlockedVocabAlert?"    ":"    ",alt:t=>"global"===t||"global"===e.randomGameId?"  ":"  ",shiftAlt:()=>"  "}),A.classList.toggle("latest-games-disabled",!e.randomGameId),A.classList.remove("random-global","random-local"),"global"===e.randomGameId?A.classList.add("random-global"):"local"===e.randomGameId&&A.classList.add("random-local")};H(),A.onclick=t=>{if(t.shiftKey&&t.altKey)return t.preventDefault(),void dt(t,e);if(t.ctrlKey)return e.showBlockedVocabAlert=!e.showBlockedVocabAlert,e.settingsManager.saveSettings(),H(),void alert(e.showBlockedVocabAlert?"     .":"     .");if(t.shiftKey){fetch("https://raw.githubusercontent.com/VimiummuimiV/KG_Latest_Games/refs/heads/main/src/etc/valid_vocabularies.txt",{cache:"no-store"}).then((e=>{if(!e.ok)throw new Error("Network response was not ok: "+e.status);return e.json()})).then((t=>{try{const a=e.settingsManager.saveValidVocabularies(t.validVocabularies||{}),n=Object.values(a).flat().length;H(),alert(`   ,  ${n} ID.`)}catch(e){console.warn("Could not save valid vocabularies via SettingsManager",e),alert("      localStorage.")}})).catch((e=>{console.warn("Failed to fetch valid vocabularies:",e),alert("     : "+e.message)}))}else{if(t.altKey)return"global"===e.randomGameId?e.randomGameId=!1:e.randomGameId="global",e.settingsManager.saveSettings(),void H();"local"===e.randomGameId?e.randomGameId=!1:e.randomGameId="local",e.settingsManager.saveSettings(),H()}};const V=X("span",{className:"latest-games-start control-button",innerHTML:$.start});W(V,"\n    [Shift + Enter | ]   (  :     )\n    [Ctrl + Shift + Enter | ]    \n    [Shift + Alt + Enter | ]     \n    ");const B=e=>{try{const t=new URL(e);return t.searchParams.set("qual","1"),t.toString()}catch(t){return e}},j=(t=!1)=>{const a=!t&&e.randomGameId;let n=null;try{if("game"===J()&&!a&&!t){const a=e.groupsManager.getCurrentGroup(e.groupsManager.groups,e.groupsManager.currentGroupId);if(!a||!Array.isArray(a.games)||0===a.games.length)return alert("     ");const n=e.gamesManager.getPreviousGameId();let r=a.games.findIndex((e=>String(e.id)===String(n)));r=-1===r?0:(r+1)%a.games.length;const o=a.games[r];if(!o)return alert("     ");e.groupsManager.selectGroup(a.id),e.gamesManager.latestGamesData=e.gamesManager.latestGamesData||{},e.gamesManager.latestGamesData.previousGameId=o.id,e.gamesManager.saveGameData();const s=String(o.params?.vocId||"");if(s)try{e.gamesManager.registerPendingPlayed(s,o.params?.vocName||null,o.params?.vocType||null)}catch(e){}const i=e.gamesManager.generateGameLink(o);return void(location.href=t?B(i):i)}}catch(e){console.warn("Error selecting next game in group",e)}if(a){if(n=e.gamesManager.getRandomGameId(),!n)return alert("   ")}else{const t=e.gamesManager.getPreviousGameId();if(!t)return alert("   ");const a=e.gamesManager.findGameById(t);if(!a)return alert("   ");n={mode:"local",id:t,game:a,groupId:e.groupsManager.currentGroupId,url:e.gamesManager.generateGameLink(a)}}if("local"!==n.mode)"global"!==n.mode||(async()=>{const a=await e.gamesManager.getValidRandomGameId();if(!a)return alert("       .   .");if(a.id)try{e.gamesManager.registerPendingPlayed(a.id)}catch(e){}window.location.href=t?B(a.url):a.url})();else{if(n.groupId)e.groupsManager.selectGroup(n.groupId);else for(const t of e.groupsManager.groups)if(t.games.some((e=>e.id===n.id))){e.groupsManager.selectGroup(t.id);break}e.gamesManager.latestGamesData=e.gamesManager.latestGamesData||{},e.gamesManager.latestGamesData.previousGameId=n.id,e.gamesManager.saveGameData();const a=String(n.game.params.vocId||"");if(a)try{e.gamesManager.registerPendingPlayed(a,n.game.params.vocName||null,n.game.params.vocType||null)}catch(e){}if(!n.url){if(!n.game)return alert("   ");n.url=e.gamesManager.generateGameLink(n.game)}location.href=t?B(n.url):n.url}};async function O(){if("game"!==J())return alert("       "),!1;const e=Me();if(!e)return alert("    ID  "),!1;try{it.currentListType="bannedVocabularies";const t=it.get();if(t.some((t=>t.id===String(e))))return alert(`  ${e}    `),!1;const a=await Se(e).catch((()=>null)),n={id:String(e),name:a?.vocabularyName||null,author:a?.vocabularyAuthor||null,vocType:a?.vocabularyType||null,isNew:!0},r=[...t,n];it.save(r,!1),alert(`  ${e}    `);try{j()}catch(e){console.warn("Could not start a new game after banning vocabulary",e)}return!0}catch(e){return console.error("Error banning vocabulary:",e),alert("    "),!1}}function q(){if("game"!==J())return alert("        "),!1;const t=Me();if(!t)return alert("    ID  "),!1;let a=e.groupsManager.groups.find((e=>""===e.title));if(!a){const t=e.groupsManager.createGroup("");e.groupsManager.groups.push(t),a=t}(async()=>{try{let n="",r=null;const o=await Se(t).catch((()=>null));o&&o.vocabularyName&&(n=o.vocabularyName,r=o.vocabularyType||null);const s=e.groupsManager.groups.find((e=>e.games.some((e=>String(e.params?.vocId)===String(t)))));if(s)return void(s.id===a.id?alert(`  ${t}    ""`):alert(`  ${t}    "${s.title}"`));Ee(a,String(t),n,r,e.groupsManager.groups,e),alert(`  ${t}    ""`);const i=a.games.find((e=>String(e.params?.vocId)===String(t)));if(i){const t={clientX:Math.floor(window.innerWidth/2),clientY:Math.floor(window.innerHeight/2)};try{Ne(e,e.groupsManager.groups,a.id,t,i.id)}catch(e){console.warn("Could not open migration popup for newly added vocabulary",e)}}}catch(e){console.warn("Could not add vocabulary to favorites group",e),alert("      ")}})()}V.onclick=e=>e.altKey&&e.shiftKey?(e.preventDefault(),void q()):e.ctrlKey&&e.shiftKey?(e.preventDefault(),void j(!0)):void j();const R=X("span",{className:"latest-games-ban-vocabulary control-button",innerHTML:$.slash});W(R,"\n    []   \n    [Alt + Enter | Alt + ]   \n    "),R.onclick=e=>{e.altKey?(e.preventDefault(),O()):(e.stopPropagation(),it.toggle(e.clientX,e.clientY,"bannedVocabularies"))};const z=X("span",{className:"latest-games-played-vocabularies control-button",innerHTML:$.book});W(z,"  "),z.onclick=e=>{e.stopPropagation(),it.toggle(e.clientX,e.clientY,"playedVocabularies")},document.addEventListener("keydown",(e=>e.altKey&&e.shiftKey&&"Enter"===e.code?(e.preventDefault(),void q()):e.ctrlKey&&e.shiftKey&&"Enter"===e.code?(e.preventDefault(),void j(!0)):e.shiftKey&&"Enter"===e.code?void j():e.altKey&&"Enter"===e.code?(e.preventDefault(),void O()):void 0));const _=[m,v,b,A,V,R,z],Y=[e.themeManager.createThemeToggle(),e.viewManager.createDisplayModeToggle(),d,u,f,x,w,k,M,C,S,E,G,L,T],K=X("span",{className:"latest-games-more-toggle control-button",innerHTML:$.moreHorizontal});_.forEach((e=>r.appendChild(e))),r.appendChild(K),W(K,"  "),Y.forEach((e=>o.appendChild(e)));const F=()=>{o.classList.remove("open"),K.classList.remove("open"),document.removeEventListener("click",Z)},Z=e=>{n.contains(e.target)||F()};return K.addEventListener("click",(e=>{e.stopPropagation(),o.classList.contains("open")?F():(o.classList.add("open"),K.classList.add("open"),setTimeout((()=>{document.addEventListener("click",Z)}),0))})),t}function mt(e){const t=X("div",{id:"latest-games-hover-area"});t.addEventListener("mouseenter",(()=>ht(e))),t.addEventListener("mouseleave",(()=>vt(e))),document.body.appendChild(t)}function ht(e){e.isHovered=!0,e.hoverTimeout&&clearTimeout(e.hoverTimeout),e.hoverTimeout=null;const t=document.getElementById("latest-games-container");if(t){const a=t.classList.contains("visible");if(t.classList.add("visible"),t.style.left="0","wrap"===e.viewManager.getDisplayMode()&&(t.style.top=`${e.panelYPosition}vh`),t.scrollTop=e.previousScrollPosition,!a){const e=t.querySelector(".latest-game.previous-game");e&&(e.style.animation="none",setTimeout((()=>e.style.animation=""),10))}}}function vt(e){const t=J();(e.alwaysVisiblePanel[t]??!1)||(e.isHovered=!1,e.hoverTimeout&&clearTimeout(e.hoverTimeout),e.hoverTimeout=setTimeout((()=>{if(!e.isHovered){const t=document.getElementById("latest-games-container");t&&(t.classList.remove("visible"),e.viewManager.updateContainerLeftOffset())}}),e.hidePanelDelay))}function bt(e){const t=document.getElementById("latest-games-container"),a=J(),n=e.alwaysVisiblePanel[a]??!1;return`\n    [] ${t&&t.classList.contains("visible")?"":""} \n    [Shift + ] ${n?"":""} \n    [Ctrl + ]    \n    (${e.hidePanelDelay??D.hidePanelDelay} )\n  `}function yt(e){if(document.getElementById("latest-games-panel-toggle"))return;const t=J(),a=e.alwaysVisiblePanel[t]??!1,n=X("button",{id:"latest-games-panel-toggle",className:"latest-games-panel-toggle",type:"button",innerHTML:a?$.panelToggleOpened:$.panelToggleClosed}),r=document.getElementById("latest-games-container"),o=()=>{Y(n,bt(e))};n.addEventListener("mouseenter",o),W(n,bt(e)),a&&n.classList.add("always-visible"),r&&(r.classList.toggle("visible",a),a||e.viewManager.updateContainerLeftOffset()),n.addEventListener("click",(t=>{const a=document.getElementById("latest-games-container");if(!a)return;const r=J();if(t.ctrlKey){const t=e.hidePanelDelay??D.hidePanelDelay,a=prompt("     :",t),n=parseInt(a,10);!isNaN(n)&&n>=0?(e.hidePanelDelay=n,e.settingsManager.saveSettings()):null!==a&&alert(",    .")}else if(t.shiftKey){e.alwaysVisiblePanel[r]=!e.alwaysVisiblePanel[r];const t=e.alwaysVisiblePanel[r];n.classList.toggle("always-visible",t),n.innerHTML=t?$.panelToggleOpened:$.panelToggleClosed,a.classList.toggle("visible",t),t||e.viewManager.updateContainerLeftOffset(),e.settingsManager.saveSettings(),o()}else{a.classList.contains("visible")?(e.hoverTimeout&&(clearTimeout(e.hoverTimeout),e.hoverTimeout=null),a.classList.remove("visible"),e.viewManager.updateContainerLeftOffset()):e.uiManager.showContainer(),o()}})),document.body.appendChild(n)}class ft{constructor(e){this.main=e,this.createGameElement=et.bind(null,this.main),this.createControls=ut.bind(null,this.main),this.createSearchBox=rt.bind(null,this.main),this.createHoverArea=mt.bind(null,this.main),this.showContainer=ht.bind(null,this.main),this.hideContainer=vt.bind(null,this.main),this.createPanelToggleButton=yt.bind(null,this.main)}scrollToPreviousGame(){const e=document.getElementById("latest-games-content"),t=document.querySelector(".previous-game");if(!e||!t)return;const a=e.getBoundingClientRect(),n=t.getBoundingClientRect(),r=n.top-a.top-a.height/2+n.height/2;e.scrollTop+=r}createContainer(){const e=X("div",{id:"latest-games-container"});e.addEventListener("mouseenter",(()=>{this.showContainer(),requestAnimationFrame((()=>this.scrollToPreviousGame()))}));const t=X("div",{id:"latest-games-content"}),a=this.createSearchBox();t.appendChild(a);const n=this.main.groupsManager.createGroupsContainer();t.appendChild(n);const r=X("ul",{id:"latest-games"});this.populateGamesList(r),t.appendChild(r);const o=this.createControls();e.append(o,t),t.addEventListener("scroll",(()=>{this.main.previousScrollPosition=t.scrollTop,this.main.settingsManager.saveSettings()})),e.addEventListener("mouseenter",(()=>this.showContainer())),e.addEventListener("mouseleave",(()=>this.hideContainer()));let s=null,i=!1;const l=e=>{const t=e.target.closest(".latest-game");if(!t)return;const a=t.id.replace("latest-game-",""),n=this.main.gamesManager.findGameById(a);n&&!this.main.enableDragging&&Re(n,e,this.main)};r.addEventListener("mousedown",(e=>{0===e.button&&(s=setTimeout((()=>{i=!0,e.preventDefault(),l(e)}),300))})),r.addEventListener("mouseup",(()=>{clearTimeout(s)})),r.addEventListener("click",(e=>{i&&(e.stopImmediatePropagation(),e.preventDefault(),i=!1)}),{capture:!0}),r.addEventListener("contextmenu",(e=>{const t=e.target.closest(".latest-game");if(t){e.preventDefault();const a=t.id.replace("latest-game-","");Ne(this.main,this.main.groupsManager.groups,this.main.groupsManager.currentGroupId,e,a)}}));let c=e.querySelector(".resize-handle-horizontal");c||(c=X("div",{className:"resize-handle-horizontal"}),e.appendChild(c));let p=e.querySelector(".resize-handle-vertical-bottom");p||(p=X("div",{className:"resize-handle-vertical resize-handle-vertical-bottom"}),e.appendChild(p));let g=e.querySelector(".resize-handle-vertical-top");g||(g=X("div",{className:"resize-handle-vertical resize-handle-vertical-top"}),e.appendChild(g)),_e(this,e,c,p,g),We(this,e),document.body.appendChild(e),this.main.groupsManager.updateGroupControlStates(),this.main.viewManager.updateDisplayModeClass();e.querySelectorAll(".group-tab").forEach((e=>{e.getBoundingClientRect().width>=300&&W(e,e.textContent)}));const d=this.main.viewManager.updateDisplayModeClass.bind(this.main.viewManager);this.main.viewManager.updateDisplayModeClass=(...t)=>{d(...t),_e(this,e,c,p,g),We(this,e)},this.updateRemoveIcons(),setTimeout((()=>requestAnimationFrame((()=>this.scrollToPreviousGame()))),100)}updateGameCountDisplay(){const e=document.getElementById("latest-games-count");e&&(e.textContent=this.main.maxGameCount.toString(),e.classList.toggle("latest-games-disabled",!1===this.main.shouldAutoSave),W(e,this.main.shouldAutoSave?" ":" "))}populateGamesList(e){if(e.innerHTML="","tabs"===this.main.groupsManager.getGroupViewMode()){const t=this.main.groupsManager.getCurrentGroup();if(!t)return;const a=this.main.groupsManager.getPinnedGameCount(),n=Math.min(t.games.length,this.main.maxGameCount+a);for(let a=0;a<n;a++){const n=t.games[a],r=this.createGameElement(n,n.id);e.appendChild(r)}}else this.main.groupsManager.groups.forEach((t=>{if(t.games.length>0){const a=this.main.groupsManager.createGroupHeader(t);e.appendChild(a);const n=t.games.filter((e=>e.pin)).length,r=Math.min(t.games.length,this.main.maxGameCount+n);for(let a=0;a<r;a++){const n=t.games[a],r=this.createGameElement(n,n.id);e.appendChild(r)}}}))}updateRemoveIcons(){const e=this.main.groupsManager.getCurrentGroup(this.main.groupsManager.groups,this.main.groupsManager.currentGroupId),t=document.querySelector(".group-controls .remove-group.control-button");t&&(t.innerHTML=e&&e.games&&e.games.length>0?$.trashSomething:$.trashNothing);const a=document.querySelector(".latest-games-removeall.control-button"),n=this.main.groupsManager.groups.some((e=>e.games&&e.games.length>0));a&&(a.innerHTML=n?$.trashSomething:$.trashNothing)}refreshContainer(){this.main.groupsManager.refreshGroupsContainer();const e=document.getElementById("latest-games");e&&(this.populateGamesList(e),this.main.viewManager.updateDisplayModeClass()),this.updateRemoveIcons(),this.updateGameCountDisplay(),requestAnimationFrame((()=>this.scrollToPreviousGame()))}}class xt{constructor(e){this.mainManager=e}parseGameParams(e,t){const a=e.className.split("-").pop(),n="voc"===a?e.textContent.replace(/[]/g,""):"";let r="";if("voc"===a){const t=e.querySelector("a");if(t){const e=t.href.match(/vocs\/(\d+)/);r=e?parseInt(e[1],10):""}}let o="normal";//.test(t)?o="practice"://.test(t)&&(o="private");let s=1,i=9;const l=t.match(/ (\S+)(\S+),/);l&&(s=I[l[1]]||1,i=I[l[2]]||9);const c=t.match(/\s(\d+)\s(|)/);return{gametype:a,vocName:n,vocId:r,vocType:null,type:o,level_from:s,level_to:i,timeout:c?""===c[2]?parseInt(c[1],10):60*parseInt(c[1],10):60,qual://.test(t)?1:0,premium_abra:0}}generateGameName(e,t={}){const a=C[e.params.gametype],{vocName:n,timeout:r,type:o,level_from:s,level_to:i,qual:l}=e.params;let c="";t&&t.stateIcon&&(c=t.stateIcon);const p=X("span",{className:`latest-game-name gametype-${e.params.gametype}`});if(p.appendChild(document.createTextNode(""===n?a:`${n}`)),c){const e=X("span",{className:"latest-game-state-icon",innerHTML:c});p.appendChild(e)}let g=null;this.mainManager.showButtonDescriptions&&(g=X("span",{className:"latest-game-description"}));const d=X("span",{className:"latest-game-qual",innerHTML:l?$.qualification:""});let u="";if(1!==s||9!==i){u=` ${L[s-1]} - ${L[i-1]}`}const m=X("span",{className:"latest-game-levels",textContent:u});g&&(g.textContent=`${G[o]}, ${r} `,g.appendChild(d),u&&g.appendChild(m));const h=X("div");return h.appendChild(p),g&&h.appendChild(g),h.innerHTML}generateGameLink(e){const{gametype:t,vocId:a,type:n,level_from:r,level_to:o,timeout:s,qual:i}=e.params,l=new URLSearchParams({gametype:t,type:n,timeout:s.toString(),submit:"1"});return"practice"!==n&&"private"!==n&&(l.set("level_from",r.toString()),l.set("level_to",o.toString())),""!==a&&l.set("voc",a),i&&l.set("qual","1"),`${location.protocol}//klavogonki.ru/create/?${l.toString()}`}loadGameData(){try{let e=localStorage.getItem("latestGamesData");if(e)if(e=JSON.parse(e),Array.isArray(e)){const t=[{id:U(e),title:"-1",games:e}],a=t[0].id;this.mainManager.groupsManager.setGroups(t,a),this.latestGamesData={}}else e&&Array.isArray(e.groups)?(this.mainManager.groupsManager.setGroups(e.groups,e.currentGroupId),this.latestGamesData={previousGameId:e.previousGameId,latestGroupAddedGameId:e.latestGroupAddedGameId}):(this.mainManager.groupsManager.setGroups([],null),this.latestGamesData={});else this.mainManager.groupsManager.setGroups([],null),this.latestGamesData={};this.migrateOldGameData(),this.assignGameIds()}catch(e){console.warn("Could not load game data from localStorage:",e),this.mainManager.groupsManager.setGroups([],null),this.latestGamesData={}}}saveGameData(){try{const e={groups:this.mainManager.groupsManager.groups,currentGroupId:this.mainManager.groupsManager.currentGroupId,previousGameId:this.latestGamesData?.previousGameId,latestGroupAddedGameId:this.latestGamesData?.latestGroupAddedGameId};localStorage.setItem("latestGamesData",JSON.stringify(e))}catch(e){console.warn("Could not save game data to localStorage:",e)}}migrateOldGameData(){this.mainManager.groupsManager.groups.forEach((e=>{e.games=e.games.map((e=>("on"!==e.params.qual&&""!==e.params.qual||(e.params.qual="on"===e.params.qual?1:0),e)))}))}assignGameIds(){const e=new Set;this.mainManager.groupsManager.groups.forEach((t=>{t.games.forEach((t=>{t.id&&e.add(t.id)}))})),this.mainManager.groupsManager.groups.forEach((t=>{t.games=t.games.map((t=>{if(t.id&&-1!==t.id)return e.add(t.id),t;{const a=U(this.mainManager.groupsManager.groups);return e.add(a),{...t,id:a}}}))}))}updateGameOrderFromDOM(){const e=this.mainManager.groupsManager.getCurrentGroup(this.mainManager.groupsManager.groups,this.mainManager.groupsManager.currentGroupId);if(!e)return;const t=Array.from(document.querySelectorAll("#latest-games .latest-game"));e.games=t.map((t=>{const a=t.id.replace("latest-game-","");return e.games.find((e=>e.id===a))})).filter((e=>void 0!==e)),this.saveGameData()}findGameIndex(e){for(const t of this.mainManager.groupsManager.groups){const a=t.games.findIndex((t=>t.id==e));if(-1!==a)return{group:t,index:a}}return null}findGameById(e){for(const t of this.mainManager.groupsManager.groups){const a=t.games.find((t=>t.id===e));if(a)return a}return null}deleteGame(e){const t=this.findGameIndex(e);if(!t)return null;const{group:a,index:n}=t,r=a.games.splice(n,1)[0];return this.assignGameIds(),this.saveGameData(),this.mainManager.uiManager.refreshContainer(),r}pinGame(e){const t=this.findGameIndex(e);if(!t)return;const{group:a,index:n}=t,r=a.games[n];r.pin=r.pin?0:1,a.games.sort(((e,t)=>t.pin-e.pin)),this.assignGameIds(),this.saveGameData(),this.mainManager.uiManager.refreshContainer()}changeGameCount(e){e<0&&this.mainManager.maxGameCount>0?this.mainManager.maxGameCount--:e>0&&this.mainManager.maxGameCount++,this.mainManager.uiManager.updateGameCountDisplay(),this.mainManager.settingsManager.saveSettings(),this.mainManager.uiManager.refreshContainer()}getPreviousGameId(){return this.latestGamesData&&this.latestGamesData.previousGameId?this.latestGamesData.previousGameId:null}getRandomGame(){if(!(this.mainManager&&this.mainManager.validVocabularies&&"object"==typeof this.mainManager.validVocabularies&&this.mainManager.randomVocabulariesType&&"object"==typeof this.mainManager.randomVocabulariesType))return null;const e=new Set;try{const t=localStorage.getItem("bannedVocabularies");if(t){const a=JSON.parse(t);Array.isArray(a)&&a.forEach((t=>{const a="string"==typeof t?t:t.id||String(t);e.add(String(a))}))}const a=localStorage.getItem("playedVocabularies");if(a){const t=JSON.parse(a);Array.isArray(t)&&t.forEach((t=>{const a="string"==typeof t?t:t.id||String(t);e.add(String(a))}))}}catch(e){console.warn("Could not parse banned/played vocabularies",e)}const t=Object.keys(this.mainManager.randomVocabulariesType).filter((e=>!0===this.mainManager.randomVocabulariesType[e]));if("global"===this.mainManager.randomGameId){const a=t.flatMap((e=>this.mainManager.validVocabularies[e]||[])).filter((t=>null!=t&&!e.has(String(t))));if(0===a.length)return null;return{mode:"global",params:{gametype:"voc",vocName:"",vocId:a[Math.floor(Math.random()*a.length)],vocType:null,type:"normal",level_from:1,level_to:9,timeout:10,qual:0,premium_abra:0}}}const a=[];if(this.mainManager.groupsManager.groups.forEach((n=>{n.games.forEach((r=>{const o=String(r.params.vocId||"");!(o&&e.has(o))&&r.params.vocType&&t.includes(r.params.vocType)&&a.push({game:r,groupId:n.id})}))})),0===a.length)return null;const n=Math.floor(Math.random()*a.length);return{mode:"local",game:a[n].game,groupId:a[n].groupId}}getRandomGameId(){const e=this.getRandomGame();if(!e)return null;if("global"===e.mode){const t={params:e.params};return{mode:"global",id:e.params.vocId,params:e.params,url:this.generateGameLink(t)}}return{mode:"local",id:e.game?e.game.id:null,game:e.game,groupId:e.groupId,url:e.game?this.generateGameLink(e.game):null}}async getValidRandomGameId(e=50){const t=!e||e<=0;for(let a=0;t||a<e;a++){const e=this.getRandomGameId();if(!e)return null;if("local"===e.mode)return e;try{let t=await fetch(e.url,{method:"HEAD",cache:"no-store"});if(405===t.status&&(t=await fetch(e.url,{method:"GET",cache:"no-store"})),t.ok){try{this.registerPendingPlayed(e.id)}catch(e){}return e}if(403===t.status)try{if(this.mainManager&&this.mainManager.showBlockedVocabAlert){const t=`${location.protocol}//klavogonki.ru/vocs/${e.id}/`;try{navigator?.clipboard?.writeText&&await navigator.clipboard.writeText(t)}catch(e){}try{this.mainManager.lastTriedVocUrl=t}catch(e){}alert(`          . URL : ${t}`)}}catch(e){}}catch(t){console.warn("Error validating candidate URL",e.url,t)}}return null}registerPendingPlayed(e,t=null,a=null){try{const n=String(e);return!!n&&(sessionStorage.setItem("latestGames_showVocTooltip",JSON.stringify({vocId:n,vocName:t||null,vocType:a||null})),!0)}catch(e){return!1}}async markVocabAsPlayed(e,t=null,a=null){const n=String(e);if(n)try{const e=localStorage.getItem("playedVocabularies")||"[]",r=JSON.parse(e),o=new Date;o.setHours(0,0,0,0);const s=o.toISOString(),i=r.findIndex((e=>("string"==typeof e?e:e.id)===n));if(-1!==i){"string"==typeof r[i]&&(r[i]={id:r[i],playHistory:[]}),r[i].playHistory||(r[i].playHistory=[]);const e=r[i].playHistory.find((e=>{const t=new Date(e.date);return t.setHours(0,0,0,0),t.toISOString()===s}));e?e.count++:r[i].playHistory.push({date:s,count:1}),r[i].playedAt=(new Date).toISOString(),r[i].isNew=!0}else{const e=t&&a?null:await Se(n).catch((()=>null));r.push({id:n,name:t||e?.vocabularyName||null,author:e?.vocabularyAuthor||null,vocType:a||e?.vocabularyType||null,isNew:!0,playedAt:(new Date).toISOString(),playHistory:[{date:s,count:1}]})}localStorage.setItem("playedVocabularies",JSON.stringify(r));try{this.registerPendingPlayed(n)}catch(e){}}catch(e){}}}Object.values(b).forEach((e=>{if(!document.getElementById(e.id)){const t=document.createElement("link");t.id=e.id,t.rel="stylesheet",t.href=e.url,document.head.appendChild(t)}})),window.latestGamesManager??=new class{constructor(){this.initializeDefaults(),this.initializeManagers(),this.init()}initializeDefaults(){Object.assign(this,D)}initializeManagers(){this.themeManager=new te(this),this.settingsManager=new ae(this),this.groupsManager=new ne(this),this.viewManager=new re(this),this.pageHandler=new De(this),this.uiManager=new ft(this),this.gamesManager=new xt(this)}init(){this.settingsManager.loadSettings(),this.gamesManager.loadGameData(),this.groupsManager.initializeGroups(),this.uiManager.createHoverArea(),this.uiManager.createContainer(),this.alwaysVisiblePanel&&this.uiManager.showContainer(),this.uiManager.createPanelToggleButton(),this.pageHandler.handlePageSpecificLogic(),this.exposeGlobalFunctions(),this.themeManager.applyTheme()}exposeGlobalFunctions(){window.latestGamesManager=this}}})();