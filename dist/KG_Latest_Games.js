// ==UserScript==
// @name          KG_Latest_Games
// @namespace     klavogonki
// @version      1.2.6
// @description   Fast game creation buttons on all the pages
// @match         *://klavogonki.ru/*
// @author        Patcher
// @icon          https://www.google.com/s2/favicons?sz=64&domain=klavogonki.ru
// ==/UserScript==

(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var o={},s=[],i=0;i<e.length;i++){var l=e[i],c=a.base?l[0]+a.base:l[0],p=o[c]||0,g="".concat(c," ").concat(p);o[c]=p+1;var d=n(g),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(m);else{var u=r(m,a);a.byIndex=i,t.splice(i,0,{identifier:g,updater:u,references:1})}s.push(g)}return s}function r(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=a(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var i=n(o[s]);t[i].references--}for(var l=a(e,r),c=0;c<o.length;c++){var p=n(o[c]);0===t[p].references&&(t[p].updater(),t.splice(p,1))}o=l}}},100:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(601),r=n.n(a),o=n(314),s=n.n(o)()(r());s.push([e.id,':root.latest-games-light-theme{--rg-bg-primary:#fff;--rg-bg-secondary:hsl(0,0%,98%);--rg-bg-card:hsl(0,0%,98%);--rg-bg-card-pinned:hsl(120,50%,96%);--rg-bg-hover:hsl(0,0%,96%);--rg-border-primary:hsl(0,0%,88%);--rg-border-hover:hsl(0,0%,74%);--rg-border-pinned:hsl(122,39%,49%);--rg-text-primary:hsl(0,0%,15%);--rg-text-secondary:#666;--rg-text-tertiary:hsl(0,0%,55%);--rg-text-options:hsl(0,0%,30%);--rg-text-count:hsl(0,0%,15%);--rg-gametype-voc:hsl(215,75%,50%);--rg-gametype-normal:hsl(130,50%,30%);--rg-gametype-abra:hsl(215,20%,40%);--rg-gametype-referats:hsl(80,55%,30%);--rg-gametype-noerror:hsl(200,45%,35%);--rg-gametype-marathon:hsl(340,65%,45%);--rg-gametype-chars:rgb(153,89.25,0);--rg-gametype-digits:hsl(0,0%,50%);--rg-gametype-sprint:hsl(5,40%,40%);--rg-icon-primary:currentColor;--rg-icon-pin:hsl(122,39%,49%);--rg-icon-pin-fill:hsl(122,39%,49%);--rg-icon-delete:hsl(4,90%,58%);--rg-icon-theme-sun:hsl(48,100%,41%);--rg-icon-theme-moon:hsl(207,89%,76%);--rg-hover-pin:hsla(122,39%,49%,.2);--rg-hover-delete:hsla(4,90%,58%,.2);--rg-hover-control:hsl(0,0%,92%);--rg-hover-control-btn:hsl(213,77%,96%);--rg-bg-card-pinned-voc:hsl(215,80%,95%);--rg-border-pinned-voc:hsl(215,80%,80%);--rg-bg-card-pinned-normal:hsl(130,50%,90%);--rg-border-pinned-normal:hsl(130,50%,70%);--rg-bg-card-pinned-abra:hsl(215,20%,90%);--rg-border-pinned-abra:hsl(215,20%,70%);--rg-bg-card-pinned-referats:hsl(80,55%,90%);--rg-border-pinned-referats:hsl(80,55%,70%);--rg-bg-card-pinned-noerror:hsl(200,45%,90%);--rg-border-pinned-noerror:hsl(200,45%,70%);--rg-bg-card-pinned-marathon:hsl(340,65%,90%);--rg-border-pinned-marathon:hsl(340,65%,70%);--rg-bg-card-pinned-chars:hsl(35,100%,90%);--rg-border-pinned-chars:hsl(35,100%,70%);--rg-bg-card-pinned-digits:hsl(0,0%,90%);--rg-border-pinned-digits:hsl(0,0%,70%);--rg-bg-card-pinned-sprint:hsl(5,40%,90%);--rg-border-pinned-sprint:hsl(5,40%,70%);--rg-bg-tab:hsl(0,0%,97%);--rg-bg-tab-hover:hsl(0,0%,94%);--rg-bg-tab-active:#fff;--rg-icon-accent:hsl(215,75%,50%);--rg-qualification-icon:hsl(48,100%,41%);--rg-panel-toggle-background:hsl(215,80%,95%);--rg-panel-toggle-stroke:hsl(215,75%,50%);--rg-panel-toggle-border:hsl(215,80%,80%);--rg-panel-toggle-bg-hover:hsl(215,80%,88%);--rg-header-text:hsl(77,100%,30%);--rg-rank-slider-track-bg:hsl(215,80%,95%);--rg-rank-slider-border:hsl(215,80%,80%);--rg-rank-slider-range:hsl(215,80%,80%);--rg-rank-slider-handle-bg:hsl(215,80%,95%);--rg-rank-slider-border-focus:hsl(215,80%,60%)}:root.latest-games-dark-theme{--rg-bg-primary:hsl(210,10%,11%);--rg-bg-secondary:hsl(220,10%,15%);--rg-bg-card:hsl(220,10%,15%);--rg-bg-card-pinned:hsl(140,20%,15%);--rg-bg-hover:hsl(220,10%,15%);--rg-border-primary:hsl(220,10%,15%);--rg-border-hover:hsl(0,0%,38%);--rg-border-pinned:hsl(133,43%,47%);--rg-text-primary:hsl(0,0%,88%);--rg-text-secondary:hsl(0,0%,88%);--rg-text-tertiary:hsl(0,0%,88%);--rg-text-options:hsl(0,0%,88%);--rg-text-count:#fc0;--rg-gametype-voc:hsl(215,80%,65%);--rg-gametype-normal:#6c7;--rg-gametype-abra:hsl(215,20%,60%);--rg-gametype-referats:hsl(80,55%,40%);--rg-gametype-noerror:hsl(200,45%,65%);--rg-gametype-marathon:hsl(340,70%,55%);--rg-gametype-chars:hsl(35,100%,45%);--rg-gametype-digits:hsl(0,0%,50%);--rg-gametype-sprint:hsl(5,40%,60%);--rg-icon-primary:hsl(207,89%,76%);--rg-icon-pin:hsl(133,43%,47%);--rg-icon-pin-fill:hsl(133,43%,47%);--rg-icon-delete:hsl(4,100%,75%);--rg-icon-theme-sun:#fc0;--rg-icon-theme-moon:hsl(207,89%,76%);--rg-hover-pin:hsla(133,43%,47%,.2);--rg-hover-delete:hsla(4,100%,75%,.2);--rg-hover-control:hsl(0,0%,38%);--rg-hover-control-btn:hsl(213,81.6%,29.8%);--rg-bg-card-pinned-voc:hsl(215,80%,10%);--rg-border-pinned-voc:hsl(215,80%,30%);--rg-bg-card-pinned-normal:hsl(130,50%,10%);--rg-border-pinned-normal:hsl(130,50%,30%);--rg-bg-card-pinned-abra:hsl(215,20%,10%);--rg-border-pinned-abra:hsl(215,20%,30%);--rg-bg-card-pinned-referats:hsl(80,55%,10%);--rg-border-pinned-referats:hsl(80,55%,30%);--rg-bg-card-pinned-noerror:hsl(200,45%,10%);--rg-border-pinned-noerror:hsl(200,45%,30%);--rg-bg-card-pinned-marathon:hsl(340,65%,10%);--rg-border-pinned-marathon:hsl(340,65%,30%);--rg-bg-card-pinned-chars:#320;--rg-border-pinned-chars:#960;--rg-bg-card-pinned-digits:hsl(0,0%,10%);--rg-border-pinned-digits:hsl(0,0%,30%);--rg-bg-card-pinned-sprint:hsl(5,40%,10%);--rg-border-pinned-sprint:hsl(5,40%,30%);--rg-bg-tab:hsl(220,10%,15%);--rg-bg-tab-hover:hsl(220,10%,18%);--rg-bg-tab-active:hsl(210,10%,11%);--rg-icon-accent:hsl(207,89%,76%);--rg-qualification-icon:#fc0;--rg-panel-toggle-background:hsl(215,80%,20%);--rg-panel-toggle-stroke:hsl(215,80%,65%);--rg-panel-toggle-border:hsl(215,80%,30%);--rg-panel-toggle-bg-hover:hsl(215,80%,25%);--rg-header-text:#fc0;--rg-rank-slider-track-bg:hsl(215,80%,10%);--rg-rank-slider-border:hsl(215,80%,30%);--rg-rank-slider-range:hsl(215,80%,30%);--rg-rank-slider-handle-bg:hsl(215,80%,10%);--rg-rank-slider-border-focus:hsl(215,80%,50%)}#latest-games-container{display:flex;flex-direction:column;font-family:"Montserrat",sans-serif;position:fixed;top:50px;width:auto;min-width:200px;max-width:330px;max-height:calc(100vh - 100px);background-color:var(--rg-bg-primary);border:1px solid var(--rg-border-primary);border-left:none;border-radius:0 8px 8px 0 !important;box-shadow:2px 0 10px rgba(0,0,0,.1) !important;z-index:1020;padding:10px 0;opacity:0;pointer-events:none;user-select:none;transition:left .3s ease,opacity .3s ease;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;color:var(--rg-text-primary)}#latest-games-container.visible{left:0 !important;opacity:1;pointer-events:auto;user-select:auto}#latest-games-container.display-mode-wrap{max-width:none;width:95vw;display:flex;flex-direction:row;flex-wrap:wrap;align-items:flex-start;position:fixed}#latest-games-container.display-mode-wrap .resize-handle{position:absolute;top:0;right:0;width:10px;height:100%;cursor:ew-resize;background-color:rgba(0,0,0,0);z-index:1021}#latest-games-container.display-mode-wrap .latest-games-controls{flex-direction:row}#latest-games-container #latest-games{margin:0;position:relative;padding:0;list-style:none;display:flex;flex-direction:column;gap:5px}#latest-games-container #latest-games .group-header{display:inline-flex;padding:5px 15px;max-width:300px;font:600 14px "Montserrat",sans-serif;border-radius:4px !important;background:var(--rg-bg-card);color:var(--rg-text-primary);border:2px solid var(--rg-border-primary);cursor:pointer;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:fit-content;width:100%;margin:0 10px}#latest-games-container #latest-games .group-header:hover,#latest-games-container #latest-games .group-header:focus{border-color:var(--rg-border-hover);background:var(--rg-bg-hover);color:var(--rg-text-primary)}#latest-games-container #latest-games .group-header.active{border:2px solid var(--rg-border-pinned-voc);background:var(--rg-bg-card-pinned-voc);color:var(--rg-gametype-voc) !important;z-index:1}#latest-games-container #latest-games.display-mode-wrap{display:flex;flex-direction:row;flex-wrap:wrap;width:100%;max-height:none;overflow-y:visible;margin:0 10px}#latest-games-container #latest-games.display-mode-wrap .latest-game,#latest-games-container #latest-games.display-mode-wrap .group-header{margin:0 !important;max-width:none}#latest-games-container #latest-games .latest-game{position:relative;margin:0 10px;border:1px solid var(--rg-border-primary);border-radius:4px !important;background-color:var(--rg-bg-card);transition:all .2s ease;display:inline-flex;max-width:300px}#latest-games-container #latest-games .latest-game.pin-game{cursor:move}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-voc{border:2px solid var(--rg-border-pinned-voc);background-color:var(--rg-bg-card-pinned-voc)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-normal{border:2px solid var(--rg-border-pinned-normal);background-color:var(--rg-bg-card-pinned-normal)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-abra{border:2px solid var(--rg-border-pinned-abra);background-color:var(--rg-bg-card-pinned-abra)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-referats{border:2px solid var(--rg-border-pinned-referats);background-color:var(--rg-bg-card-pinned-referats)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-noerror{border:2px solid var(--rg-border-pinned-noerror);background-color:var(--rg-bg-card-pinned-noerror)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-marathon{border:2px solid var(--rg-border-pinned-marathon);background-color:var(--rg-bg-card-pinned-marathon)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-chars{border:2px solid var(--rg-border-pinned-chars);background-color:var(--rg-bg-card-pinned-chars)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-digits{border:2px solid var(--rg-border-pinned-digits);background-color:var(--rg-bg-card-pinned-digits)}#latest-games-container #latest-games .latest-game.pin-game.pin-gametype-sprint{border:2px solid var(--rg-border-pinned-sprint);background-color:var(--rg-bg-card-pinned-sprint)}#latest-games-container #latest-games .latest-game:hover{border-color:var(--rg-border-hover);background-color:var(--rg-bg-hover);transform:translateX(2px)}#latest-games-container #latest-games .latest-game.dragging{opacity:.7;z-index:1021;transition:transform .1s ease}#latest-games-container #latest-games .latest-game.display-mode-wrap{margin:0}#latest-games-container #latest-games .latest-game a{display:block;width:100%;padding:5px 15px;text-decoration:none;color:inherit}#latest-games-container #latest-games .latest-game .latest-game-name{display:block;font-weight:bold;font-size:12px;margin-bottom:2px}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-voc{color:var(--rg-gametype-voc) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-normal{color:var(--rg-gametype-normal) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-abra{color:var(--rg-gametype-abra) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-referats{color:var(--rg-gametype-referats) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-noerror{color:var(--rg-gametype-noerror) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-marathon{color:var(--rg-gametype-marathon) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-chars{color:var(--rg-gametype-chars) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-digits{color:var(--rg-gametype-digits) !important}#latest-games-container #latest-games .latest-game .latest-game-name.gametype-sprint{color:var(--rg-gametype-sprint) !important}#latest-games-container #latest-games .latest-game .latest-game-description{display:inline-flex;font-size:10px;color:var(--rg-text-secondary)}#latest-games-container #latest-games .latest-game .latest-game-qual{display:inline-flex;align-items:center;justify-content:center;margin-left:4px}#latest-games-container #latest-games .latest-game .latest-game-qual svg{width:14px;height:14px}#latest-games-container #latest-games .latest-game .latest-game-levels{display:block;font-size:9px;color:var(--rg-text-tertiary);margin-top:1px}#latest-games-container #latest-games .latest-game .latest-game-buttons{position:relative;justify-content:space-around;display:flex;flex-direction:column;margin-right:2px;opacity:0;transition:opacity .2s ease;order:1}#latest-games-container #latest-games .latest-game:hover .latest-game-buttons{opacity:1}#latest-games-container #latest-games .latest-game .latest-game-pin,#latest-games-container #latest-games .latest-game .latest-game-delete{width:16px;height:16px;cursor:pointer;border-radius:2px !important;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease}#latest-games-container #latest-games .latest-game .latest-game-pin:hover,#latest-games-container #latest-games .latest-game .latest-game-delete:hover{background-color:var(--rg-hover-pin)}#latest-games-container #latest-games .latest-game .latest-game-pin svg,#latest-games-container #latest-games .latest-game .latest-game-delete svg{width:10px;height:10px;opacity:.6;stroke:var(--rg-icon-pin-fill)}#latest-games-container #latest-games .latest-game .latest-game-pin:hover svg,#latest-games-container #latest-games .latest-game .latest-game-delete:hover svg{opacity:1}#latest-games-container #latest-games .latest-game .latest-game-delete:hover{background-color:var(--rg-hover-delete)}#latest-games-container #latest-games .latest-game .latest-game-delete svg{stroke:var(--rg-icon-delete);fill:none}#latest-games-container .latest-games-controls{display:flex;flex-direction:column;justify-content:space-between;align-items:flex-start;padding:0 10px;margin-top:10px}#latest-games-container .latest-games-controls .controls-buttons{gap:2px}#latest-games-container .latest-games-controls .controls-buttons{display:inline-flex}#latest-games-container #latest-games-options{display:flex;align-items:center;font-size:13px;gap:5px;color:var(--rg-text-options);user-select:none}#latest-games-container #latest-games-count{margin:0 6px;font-weight:bold;font-size:14px;min-width:18px;text-align:center;color:var(--rg-text-count);cursor:pointer}#latest-games-container #latest-games-count-inc,#latest-games-container #latest-games-count-dec{height:24px;width:24px;cursor:pointer;font-size:16px;border-radius:3px !important;transition:background .15s;user-select:none;display:flex;align-items:center;justify-content:center;color:var(--rg-icon-primary)}#latest-games-container #latest-games-count-inc:hover,#latest-games-container #latest-games-count-dec:hover{background:var(--rg-hover-control-btn)}#latest-games-container #latest-games-count-inc svg,#latest-games-container #latest-games-count-dec svg{width:16px;height:16px}#latest-games-container .theme-toggle,#latest-games-container .display-mode-toggle,#latest-games-container .control-button{cursor:pointer;display:flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:4px;transition:background .15s;user-select:none}#latest-games-container .theme-toggle svg,#latest-games-container .display-mode-toggle svg,#latest-games-container .control-button svg{width:16px;height:16px;display:block;transition:stroke .2s,fill .2s}#latest-games-container .theme-toggle svg.feather-sun,#latest-games-container .display-mode-toggle svg.feather-sun,#latest-games-container .control-button svg.feather-sun{stroke:var(--rg-icon-theme-sun);fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}#latest-games-container .theme-toggle svg.feather-moon,#latest-games-container .display-mode-toggle svg.feather-moon,#latest-games-container .control-button svg.feather-moon{stroke:var(--rg-icon-theme-moon);fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}#latest-games-container .control-button{box-sizing:border-box}#latest-games-container .control-button svg{pointer-events:none}#latest-games-container #latest-games-groups{display:flex;flex-direction:column;align-items:start;margin-bottom:0}#latest-games-container #latest-games-groups .tabs-container{display:inline-flex;flex-direction:row;gap:5px;flex-wrap:wrap;align-items:center;margin:0 0 5px 10px}#latest-games-container #latest-games-groups .group-tab{display:inline-flex;padding:5px 15px;max-width:300px;font:600 14px "Montserrat",sans-serif;border-radius:4px !important;background:var(--rg-bg-card);color:var(--rg-text-primary);border:2px solid var(--rg-border-primary);cursor:pointer;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:fit-content}#latest-games-container #latest-games-groups .group-tab:hover,#latest-games-container #latest-games-groups .group-tab:focus{border-color:var(--rg-border-hover);background:var(--rg-bg-hover);color:var(--rg-text-primary)}#latest-games-container #latest-games-groups .group-tab.active{border:2px solid var(--rg-border-pinned-voc);background:var(--rg-bg-card-pinned-voc);color:var(--rg-gametype-voc) !important;z-index:1}#latest-games-container #latest-games-groups .group-controls{gap:2px;display:inline-flex;align-items:center;margin:0 0 10px 10px}.game-migration-popup,.vocabulary-creation-popup,.game-popup{position:fixed;display:flex;flex-direction:column;gap:5px;padding:5px;background-color:var(--rg-bg-primary);border:1px solid var(--rg-border-primary);border-radius:8px !important;box-shadow:0 2px 10px rgba(0,0,0,.1) !important;max-height:50vh;max-width:400px;overflow-y:auto;scrollbar-width:none;z-index:1025;user-select:none}.game-migration-popup .popup-header-qualification,.vocabulary-creation-popup .popup-header-qualification,.game-popup .popup-header-qualification{display:flex;align-items:center;justify-content:center;width:16px;height:16px;cursor:pointer}.game-migration-popup .popup-header,.vocabulary-creation-popup .popup-header,.game-popup .popup-header{display:inline-flex;font:600 14px "Montserrat",sans-serif;color:var(--rg-header-text);padding:6px;justify-content:space-between}.game-migration-popup .popup-subheader,.vocabulary-creation-popup .popup-subheader,.game-popup .popup-subheader{font:600 14px "Montserrat",sans-serif;color:var(--rg-text-secondary);padding:6px}.game-migration-popup .timeouts-container,.vocabulary-creation-popup .timeouts-container,.game-popup .timeouts-container{display:flex;flex-direction:row;gap:5px}.game-migration-popup .timeouts-container .game-popup-button,.vocabulary-creation-popup .timeouts-container .game-popup-button,.game-popup .timeouts-container .game-popup-button{display:inline-block;padding:5px 15px;font:600 14px "Montserrat",sans-serif;border-radius:4px !important;background:var(--rg-bg-card) !important;color:var(--rg-text-primary) !important;border:1.5px solid var(--rg-border-primary);cursor:pointer;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:left;text-decoration:none}.game-migration-popup .timeouts-container .game-popup-button:hover,.game-migration-popup .timeouts-container .game-popup-button:focus,.vocabulary-creation-popup .timeouts-container .game-popup-button:hover,.vocabulary-creation-popup .timeouts-container .game-popup-button:focus,.game-popup .timeouts-container .game-popup-button:hover,.game-popup .timeouts-container .game-popup-button:focus{border-color:var(--rg-border-hover);background:var(--rg-bg-hover);color:var(--rg-text-primary)}.game-migration-popup .group-tab,.vocabulary-creation-popup .group-tab,.game-popup .group-tab{display:inline-flex;padding:5px 15px;max-width:300px;font:600 14px "Montserrat",sans-serif;border-radius:4px !important;background:var(--rg-bg-card);color:var(--rg-text-primary);border:2px solid var(--rg-border-primary);cursor:pointer;user-select:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:fit-content}.game-migration-popup .group-tab:hover,.game-migration-popup .group-tab:focus,.vocabulary-creation-popup .group-tab:hover,.vocabulary-creation-popup .group-tab:focus,.game-popup .group-tab:hover,.game-popup .group-tab:focus{border-color:var(--rg-border-hover);background:var(--rg-bg-hover);color:var(--rg-text-primary)}.game-migration-popup .group-tab.active,.vocabulary-creation-popup .group-tab.active,.game-popup .group-tab.active{border:2px solid var(--rg-border-pinned-voc);background:var(--rg-bg-card-pinned-voc);color:var(--rg-gametype-voc) !important;z-index:1}.game-migration-popup .rank-slider-container,.vocabulary-creation-popup .rank-slider-container,.game-popup .rank-slider-container{display:flex;flex-direction:column;align-items:stretch;margin:6px}.game-migration-popup .rank-slider-container .rank-slider-display,.vocabulary-creation-popup .rank-slider-container .rank-slider-display,.game-popup .rank-slider-container .rank-slider-display{margin:0 0 12px;font:600 14px "Montserrat",sans-serif;color:var(--rg-text-secondary)}.game-migration-popup .rank-slider-container .rank-slider-track,.vocabulary-creation-popup .rank-slider-container .rank-slider-track,.game-popup .rank-slider-container .rank-slider-track{position:relative;height:8px;background:var(--rg-rank-slider-track-bg);border-radius:4px !important;cursor:pointer;border:2px solid var(--rg-rank-slider-border);box-sizing:border-box}.game-migration-popup .rank-slider-container .rank-slider-range,.vocabulary-creation-popup .rank-slider-container .rank-slider-range,.game-popup .rank-slider-container .rank-slider-range{position:absolute;height:100%;background:var(--rg-rank-slider-range);border-radius:4px !important;z-index:1}.game-migration-popup .rank-slider-container .rank-slider-handle,.vocabulary-creation-popup .rank-slider-container .rank-slider-handle,.game-popup .rank-slider-container .rank-slider-handle{position:absolute;top:50%;width:18px;height:18px;background:var(--rg-rank-slider-handle-bg);border:2px solid var(--rg-rank-slider-border);border-radius:50% !important;transform:translate(-50%, -50%);z-index:2;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.08) !important;transition:border-color .2s,background .2s}.game-migration-popup .rank-slider-container .rank-slider-handle:focus,.vocabulary-creation-popup .rank-slider-container .rank-slider-handle:focus,.game-popup .rank-slider-container .rank-slider-handle:focus{outline:none;border-color:var(--rg-rank-slider-border-focus)}.game-migration-popup .rank-slider-container .rank-slider-handle.overlap-left,.vocabulary-creation-popup .rank-slider-container .rank-slider-handle.overlap-left,.game-popup .rank-slider-container .rank-slider-handle.overlap-left{transform:translate(-100%, -50%)}.game-migration-popup .rank-slider-container .rank-slider-handle.overlap-right,.vocabulary-creation-popup .rank-slider-container .rank-slider-handle.overlap-right,.game-popup .rank-slider-container .rank-slider-handle.overlap-right{transform:translate(0, -50%)}#latest-games-hover-area{position:fixed;left:0;top:0;width:4px;height:100vh;z-index:1023;background-color:rgba(0,0,0,0);pointer-events:auto}.latest-games-panel-toggle{position:fixed;left:0;top:50%;transform:translateY(-50%);z-index:1024;background:var(--rg-panel-toggle-background);border:2px solid var(--rg-panel-toggle-border);border-radius:0 .5em .5em 0 !important;box-shadow:0 2px 8px rgba(0,0,0,.15) !important;width:40px;height:40px;display:flex;justify-content:center;align-items:center;cursor:pointer;transition:background .2s;outline:none}.latest-games-panel-toggle:hover,.latest-games-panel-toggle:focus{background:var(--rg-panel-toggle-bg-hover)}.latest-games-panel-toggle svg{stroke:var(--rg-panel-toggle-stroke);width:1.5em;height:1.5em;display:block;pointer-events:none}.custom-tooltip-popup{position:fixed;background:#161616;color:#dedede;padding:.5em;z-index:1200;font-size:.9em;pointer-events:none;white-space:nowrap;opacity:0;transition:opacity .1s;display:none;flex-direction:column;left:0;top:0;border:1px solid #3c3c3c !important;border-radius:4px !important;box-shadow:0 2px 5px rgba(0,0,0,.3) !important}.custom-tooltip-popup .tooltip-item{display:inline-flex !important;align-items:center !important}.custom-tooltip-popup .tooltip-action{font-weight:bold !important;color:var(--rg-text-count) !important}.vocabulary-tooltip-popup{font:500 14px "Montserrat",sans-serif;position:fixed;background:#161616;color:#dedede;padding:.5em;z-index:1200;font-size:.9em;pointer-events:auto;white-space:pre-wrap;border:1px solid #3c3c3c !important;border-radius:4px !important;box-shadow:0 2px 5px rgba(0,0,0,.3) !important;max-width:700px;width:auto;max-height:400px;overflow-y:auto;overflow-x:hidden;scrollbar-width:thin;scrollbar-color:#8c8c8c #161616;word-wrap:break-word;overflow-wrap:break-word}.vocabulary-tooltip-popup .tooltip-number{color:#8c8c8c;opacity:.8}.vocabulary-tooltip-popup::-webkit-scrollbar{width:8px;height:8px}.vocabulary-tooltip-popup::-webkit-scrollbar-track{background:#161616 !important}.vocabulary-tooltip-popup::-webkit-scrollbar-thumb{background-color:#8c8c8c !important}.vocabulary-tooltip-popup::-webkit-scrollbar-thumb:hover{background-color:#a0a0a0 !important}.latest-games-disabled{filter:grayscale(1);opacity:.5}.latest-games-hidden{display:none !important}',""]);const i=s},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(a)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var p=[].concat(e[c]);a&&s[p[0]]||(void 0!==o&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=o),n&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=n):p[2]=n),r&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=r):p[4]="".concat(r)),t.push(p))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,r&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={id:a,exports:{}};return e[a](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;const a="http://www.w3.org/2000/svg",r={sun:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="12" r="5"></circle>\n      <line x1="12" y1="1" x2="12" y2="3"></line>\n      <line x1="12" y1="21" x2="12" y2="23"></line>\n      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>\n      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>\n      <line x1="1" y1="12" x2="3" y2="12"></line>\n      <line x1="21" y1="12" x2="23" y2="12"></line>\n      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>\n      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>\n    </svg>\n  `,moon:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>\n    </svg>\n  `,pin:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="5" r="3"></circle>\n      <line x1="12" y1="22" x2="12" y2="8"></line>\n      <path d="M5 12H2a10 10 0 0 0 20 0h-3"></path>\n    </svg>\n  `,delete:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round">\n      <line x1="18" y1="6" x2="6" y2="18"></line>\n      <line x1="6" y1="6" x2="18" y2="18"></line>\n    </svg>\n  `,decrease:`\n    <svg xmlns="${a}" viewBox="0 0 24 24">\n      <path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z" fill="currentColor"/>\n    </svg>\n  `,increase:`\n    <svg xmlns="${a}" viewBox="0 0 24 24">\n      <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" fill="currentColor"/>\n    </svg>\n  `,play:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="9 18 15 12 9 6"></polyline>\n    </svg>\n  `,replay:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="13 17 18 12 13 7"></polyline>\n      <polyline points="6 17 11 12 6 7"></polyline>\n    </svg>\n  `,pinAll:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>\n      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>\n    </svg>\n  `,unpinAll:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>\n      <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>\n    </svg>\n  `,sort:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="16 3 21 3 21 8"></polyline>\n      <line x1="4" y1="20" x2="21" y2="3"></line>\n      <polyline points="21 16 21 21 16 21"></polyline>\n      <line x1="15" y1="15" x2="21" y2="21"></line>\n      <line x1="4" y1="4" x2="9" y2="9"></line>\n    </svg>\n  `,import:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n      <polyline points="7 10 12 15 17 10"></polyline>\n      <line x1="12" y1="15" x2="12" y2="3"></line>\n    </svg>\n  `,export:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n      <polyline points="17 8 12 3 7 8"></polyline>\n      <line x1="12" y1="3" x2="12" y2="15"></line>\n    </svg>\n  `,trashNothing:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <polyline points="3 6 5 6 21 6"></polyline>\n      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n    </svg>\n  `,trashSomething:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="3 6 5 6 21 6"></polyline>\n      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n      <line x1="10" y1="11" x2="10" y2="17"></line>\n      <line x1="14" y1="11" x2="14" y2="17"></line>\n    </svg>\n  `,wrap:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="3" y="3" width="7" height="7"/>\n      <rect x="14" y="3" width="7" height="7"/>\n      <rect x="14" y="14" width="7" height="7"/>\n      <rect x="3" y="14" width="7" height="7"/>\n    </svg>\n  `,scroll:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="2" y="2" width="20" height="20" rx="2"/>\n      <line x1="2" y1="8" x2="22" y2="8"/>\n      <line x1="2" y1="16" x2="22" y2="16"/>\n    </svg>\n  `,addGroup:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <line x1="12" y1="5" x2="12" y2="19"></line>\n      <line x1="5" y1="12" x2="19" y2="12"></line>\n    </svg>\n  `,renameGroup:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>\n    </svg>\n  `,qualification:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="var(--rg-qualification-icon)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="8" r="7"></circle>\n      <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>\n    </svg>\n  `,panelToggleClosed:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>\n      <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>\n    </svg>\n  `,panelToggleOpened:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>\n      <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>\n    </svg>\n  `,broom:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none"\n    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <line x1="12" y1="2" x2="12" y2="8.5"/>\n      <path d="M12 8.5c3.63,0 6.61,2.76 6.96,6.3 0.02,0.18 -0.03,0.35 -0.16,0.49 -0.12,0.14 -0.29,0.21 -0.47,0.21l-12.66 0c-0.18,0 -0.35,-0.07 -0.47,-0.21 -0.13,-0.14 -0.18,-0.31 -0.16,-0.49 0.35,-3.54 3.33,-6.3 6.96,-6.3z"/>\n      <path d="M5 15.5l14 0 1.04 5.74c0.03,0.2 -0.02,0.38 -0.14,0.53 -0.13,0.15 -0.3,0.23 -0.49,0.23l-14.81 0c-0.2,0 -0.37,-0.08 -0.49,-0.23 -0.13,-0.15 -0.18,-0.33 -0.14,-0.53l1.03 -5.74z"/>\n    </svg>\n  `,checkmark:`\n    <svg xmlns="${a}" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#4caf50" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="20 6 9 17 4 12"></polyline>\n    </svg>\n  `,dragToggle:`\n    <svg xmlns="${a}" viewBox="0 0 24 24" fill="none"\n    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n      <polyline points="5 9 2 12 5 15"></polyline>\n      <polyline points="9 5 12 2 15 5"></polyline>\n      <polyline points="15 19 12 22 9 19"></polyline>\n      <polyline points="19 9 22 12 19 15"></polyline>\n      <line x1="2" y1="12" x2="22" y2="12"></line>\n      <line x1="12" y1="2" x2="12" y2="22"></line>\n    </svg>\n  `};var o=n(72),s=n.n(o),i=n(825),l=n.n(i),c=n(659),p=n.n(c),g=n(56),d=n.n(g),m=n(540),u=n.n(m),h=n(113),v=n.n(h),f=n(100),y={};y.styleTagTransform=v(),y.setAttributes=d(),y.insert=p().bind(null,"head"),y.domAPI=l(),y.insertStyleElement=u();s()(f.A,y);f.A&&f.A.locals&&f.A.locals;function b(){return Array.from(crypto.getRandomValues(new Uint8Array(9))).map((e=>(e%36).toString(36))).join("")}function x(e){return new Promise((t=>setTimeout(t,e)))}function w(e,t={}){const n=document.createElement(e);return t.className&&(n.className=t.className),t.id&&(n.id=t.id),t.innerHTML&&(n.innerHTML=t.innerHTML),t.textContent&&(n.textContent=t.textContent),t.href&&(n.href=t.href),t.title&&(n.title=t.title),t.src&&(n.src=t.src),t.style&&Object.assign(n.style,t.style),t.attributes&&Object.entries(t.attributes).forEach((([e,t])=>{n.setAttribute(e,t)})),n}const k={normal:"Oбычный",abra:"Абракадабра",referats:"Яндекс.Рефераты",noerror:"Безошибочный",marathon:"Марафон",chars:"Буквы",digits:"Цифры",sprint:"Спринт",voc:"По словарю"},C={normal:"открытый",practice:"одиночный",private:"дружеский"},M=["новички","любители","таксисты","профи","гонщики","маньяки","супермены","кибергонщики","экстракиберы"],E={новичков:1,любителей:2,таксистов:3,профи:4,гонщиков:5,маньяков:6,суперменов:7,кибергонщиков:8,экстракиберов:9},L=[5,10,20,30,45,60];function G(e){const t=k[e.params.gametype],{vocName:n,timeout:a,type:o,level_from:s,level_to:i,qual:l}=e.params,c=w("span",{className:`latest-game-name gametype-${e.params.gametype}`,textContent:""===n?t:`«${n}»`}),p=w("span",{className:"latest-game-description"}),g=w("span",{className:"latest-game-qual",innerHTML:l?r.qualification:""});let d="";if(1!==s||9!==i){d=` ${M[s-1]} - ${M[i-1]}`}const m=w("span",{className:"latest-game-levels",textContent:d});p.textContent=`${C[o]}, ${a} секунд`,p.appendChild(g),d&&p.appendChild(m);const u=w("div");return u.appendChild(c),u.appendChild(p),u.innerHTML}function S(e){const{gametype:t,vocId:n,type:a,level_from:r,level_to:o,timeout:s,qual:i}=e.params,l=new URLSearchParams({gametype:t,type:a,timeout:s.toString(),submit:"1"});return"practice"!==a&&"private"!==a&&(l.set("level_from",r.toString()),l.set("level_to",o.toString())),""!==n&&l.set("voc",n),i&&l.set("qual","1"),`${location.protocol}//klavogonki.ru/create/?${l.toString()}`}function D(e,t=[]){const n=e||function(e){const t=e.map((e=>{const t=e.title.match(/^Группа-(\d+)$/);return t?parseInt(t[1],10):0})).filter((e=>!isNaN(e)));return`Группа-${(t.length>0?Math.max(...t):0)+1}`}(t);return{id:I(t),title:n,games:[]}}function T(e,t){return e.find((e=>e.id===t))||null}function I(e){let t;do{t=b()}while(e.some((e=>e.id===t)));return t}let N=null,H=null,$=null,A=!1,B=!1,q=null;const P=(e,t)=>{if(!N)return;let n=e+10;const a=N.offsetWidth,r=window.innerWidth;n=Math.min(Math.max(n,10),r-a-10),N.style.left=`${n}px`,N.style.top=`${t+18}px`},O=e=>N&&P(e.clientX,e.clientY);function j(){A=!1,q=null,clearTimeout($),clearTimeout(H),H=setTimeout((()=>{N&&(N.style.opacity="0",B=!1,setTimeout((()=>{!A&&N&&(N.style.display="none",N.textContent="",document.removeEventListener("mousemove",O))}),50))}),100)}function R(e,t){null!=t&&(e._tooltipContent=t,e._tooltipInitialized||(e._tooltipInitialized=!0,N||=(()=>{const e=document.createElement("div");return e.classList.add("custom-tooltip-popup"),e.style.display="none",e.style.opacity="0",document.body.appendChild(e),e})(),e.addEventListener("mouseenter",(t=>{A=!0,q=e,clearTimeout(H),clearTimeout($),N.innerHTML=function(e){const t=/\[([^\]]+)\]([^\[]*)/g;let n,a="",r=0;for(;null!==(n=t.exec(e));)n.index>r&&(a+=e.slice(r,n.index)),a+=`\n    <div class="tooltip-item">\n      <span class="tooltip-action">${n[1]}</span>&nbsp;\n      <span class="tooltip-message">${n[2].trim()}</span>\n    </div>`,r=t.lastIndex;r<e.length&&(a+=e.slice(r));return a}(e._tooltipContent),N.style.display="flex",N.style.opacity="0",N.offsetHeight,P(t.clientX,t.clientY),document.addEventListener("mousemove",O),$=setTimeout((()=>{N.style.opacity="1",B=!0}),600)})),e.addEventListener("mouseleave",(()=>{j(),document.removeEventListener("mousemove",O)})),e.addEventListener("click",j)))}function V(e){const t=new Map;e.forEach((e=>{e.games.forEach((n=>{if(n.params&&n.params.vocId){const a=String(n.params.vocId);t.has(a)||t.set(a,[]),t.get(a).push(e.name||e.title||"Группа")}}))}));document.querySelectorAll('a.name[href*="/vocs/"]').forEach((e=>{const n=e.getAttribute("href"),a=n&&n.match(/\/vocs\/(\d+)(?:\/|$)/);if(a){const n=a[1],o=e.parentNode,s=o.querySelector(".kg-voc-checkmark");if(s&&s.remove(),t.has(n)){const a=document.createElement("span");a.className="kg-voc-checkmark",a.innerHTML=r.checkmark;R(a,"Словарь уже существует в группе: "+t.get(n).join(", "));const s=o.querySelector(".desc");s?o.insertBefore(a,s):e.appendChild(a)}}}))}function z(e,t,n="popup",a){const r=document.querySelector(`.${n}`);r&&r.remove();const o=w("div",{className:n});if(a){const e=w("div",{className:"popup-header",textContent:a});o.appendChild(e)}e.forEach((e=>{const t=w("button",{className:e.className||"popup-button",textContent:e.text,...e.dataset&&{dataset:e.dataset}});e.onClick&&t.addEventListener("click",(()=>{e.onClick(),o.remove()})),o.appendChild(t)})),o.style.visibility="hidden",document.body.appendChild(o),o.querySelectorAll("button").forEach((e=>{e.scrollWidth>e.clientWidth&&R(e,e.textContent)}));const s=o.getBoundingClientRect(),i=window.innerWidth,l=window.innerHeight;let c=Math.max(10,Math.min(t.clientX,i-s.width-10)),p=Math.max(10,Math.min(t.clientY,l-s.height-10));o.style.left=`${c}px`,o.style.top=`${p}px`,o.style.visibility="visible";const g=e=>{e&&"keydown"===e.type&&"Escape"!==e.key||(o.remove(),document.removeEventListener("click",d),document.removeEventListener("keydown",m))},d=e=>{o.contains(e.target)||g(e)},m=e=>{"Escape"===e.key&&g(e)};return requestAnimationFrame((()=>{document.addEventListener("click",d),document.addEventListener("keydown",m)})),o}new MutationObserver((()=>{q&&!document.contains(q)&&j()})).observe(document,{childList:!0,subtree:!0});let Y=null,_=null,W=null,X=null;function J(e,t){_&&(clearTimeout(_),_=null),W&&(clearTimeout(W),W=null),Y&&X===e||(Y&&F(),W=setTimeout((()=>{X=e,Y=function(e){const t=document.createElement("div");t.className="vocabulary-tooltip-popup";const n=e.replace(/^(\d+)\.\s/gm,'<span class="tooltip-number">$1.</span> ');return t.innerHTML=n,document.body.appendChild(t),t}(t),function(e,t){const n=e.getBoundingClientRect(),a=window.innerWidth,r=window.innerHeight,o=10,s=t.getBoundingClientRect();let i=n.left,l=n.bottom+5;i+s.width>a-o&&(i=a-s.width-o);i<o&&(i=o);if(l+s.height>r-o){const e=n.top-s.height-5;l=e>=o?e:o}l<o&&(l=o);t.style.left=`${i}px`,t.style.top=`${l}px`}(e,Y),Y.addEventListener("mouseenter",(()=>{_&&(clearTimeout(_),_=null)})),Y.addEventListener("mouseleave",(()=>{U()})),W=null}),400))}function F(){Y&&(Y.remove(),Y=null,X=null),_&&(clearTimeout(_),_=null),W&&(clearTimeout(W),W=null)}function U(){_&&clearTimeout(_),_=setTimeout((()=>{F()}),300)}function K(){const e=document.querySelector(".columns.voclist");e?(e.addEventListener("mouseenter",(async e=>{const t=e.target.closest('a.name[href*="/vocs/"]');if(t){const e=t.getAttribute("href"),n=e.match(/\/vocs\/(\d+)(?:\/|$)/);if(!n)return void console.warn(`Invalid vocabulary href: ${e}`);const a=n[1];t._tooltipContent?J(t,t._tooltipContent):async function(e){try{const t=await fetch(`https://klavogonki.ru/vocs/${e}/`),n=await t.text(),a=(new DOMParser).parseFromString(n,"text/html").querySelector(".words");if(!a)return console.warn(`No element with class "words" found for vocId ${e}`),"Vocabulary content not found";const r=a.querySelectorAll("tr");return 0===r.length?(console.warn(`No table rows found for vocId ${e}`),"No words available"):Array.from(r).map(((e,t)=>{const n=e.querySelector("td.num"),a=e.querySelector("td.text");if(!a)return null;const r=a.innerHTML.replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]*>/g,"").trim();if(""===r||"…"===r)return null;if(n){const e=n.textContent.trim();return""===e||"…"===e?null:`${e}. ${r}`}return`${t+1}. ${r}`})).filter((e=>null!==e)).join("\n\n")}catch(t){return console.error(`Error fetching vocabulary content for vocId ${e}:`,t),"Error loading vocabulary"}}(a).then((e=>{t._tooltipContent=e,J(t,e)}))}}),{capture:!0}),e.addEventListener("mouseleave",(e=>{const t=e.target.closest('a.name[href*="/vocs/"]');t&&X===t&&U(),W&&(clearTimeout(W),W=null)}),{capture:!0})):console.warn('Element with class "columns voclist" not found.')}function Q(e,t){const n=document.querySelector(".columns.voclist");n?n.addEventListener("contextmenu",(n=>{const a=n.target.closest('a.name[href*="/vocs/"]');if(a){n.preventDefault();const r=a.getAttribute("href").match(/\/vocs\/(\d+)(?:\/|$)/);if(r){const o=r[1],s=a.textContent.trim();!function(e,t,n,a,r){F(),z(e.map((t=>{const o=t.games.some((e=>String(e.params?.vocId)===String(n)));return{text:t.title,className:"group-tab"+(o?" active":""),dataset:{groupId:t.id},onClick:()=>{const s=e.find((e=>e.games.some((e=>String(e.params?.vocId)===String(n)))));if(s)alert(`Этот словарь уже добавлен в ${s.title}`);else if(!o){const o={id:b(),params:{gametype:"voc",vocName:a,vocId:n,type:"normal",level_from:1,level_to:9,timeout:10,qual:0,premium_abra:0},pin:1};t.games.unshift(o),r.saveGameData(),r.refreshContainer(),V(e)}}}})),t,"vocabulary-creation-popup","Добавить")}(e,n,o,s,t)}}})):console.warn('Element with class "columns voclist" not found.')}const Z=Object.keys(C),ee="latestGamesSettings",te=0,ne=5,ae=5,re=8,oe=10,se={load(){try{return JSON.parse(localStorage.getItem(ee))||{}}catch(e){return{}}},save(e){try{localStorage.setItem(ee,JSON.stringify(e))}catch(e){console.warn("Failed to save settings:",e)}},getRankRange(){return this.load().rankRange||[te,re]},saveRankRange(e,t){const n=this.load();n.rankRange=[e,t],this.save(n)},getQualificationState(){const e=this.load();return void 0!==e.qualificationEnabled&&e.qualificationEnabled},saveQualificationState(e){const t=this.load();t.qualificationEnabled=e,this.save(t)}};function ie(e,t){return t?Math.max(te,Math.min(ne,e)):Math.max(ae,Math.min(re,e))}function le(e,t,n="game-popup"){j();const a=document.querySelector(`.${n}`);a&&a.remove();const o=w("div",{className:n}),s=w("div",{className:"popup-header"}),i=w("div",{className:"popup-header-title",textContent:"Выбрать"}),l=w("span",{className:"popup-header-qualification",innerHTML:r.qualification});let c=se.getQualificationState();l.classList.toggle("latest-games-disabled",!c),R(l,"Квалификация "+(c?"включена":"выключена")),l.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),c=!c,se.saveQualificationState(c),l.classList.toggle("latest-games-disabled",!c),R(l,"Квалификация "+(c?"включена":"выключена")),b()})),s.append(i,l),o.appendChild(s);const p=w("div",{className:"rank-slider-container"}),g=w("div",{className:"rank-slider-track"}),d=w("div",{className:"rank-slider-range"}),m=[w("div",{className:"rank-slider-handle",tabIndex:0}),w("div",{className:"rank-slider-handle",tabIndex:0})],u=w("div",{className:"rank-slider-display"});let[h,v]=se.getRankRange();h=ie(h,!0),v=ie(v,!1),h>v&&(h=v),v<h&&(v=h);const f=[];function y(){h=ie(h,!0),v=ie(v,!1),h>v&&(h=v),v<h&&(v=h);const e=h/(M.length-1)*100,t=v/(M.length-1)*100;m[0].style.left=e+"%",m[1].style.left=t+"%",d.style.left=e+"%",d.style.width=t-e+"%",u.textContent=M[h]+(h===v?"":" — "+M[v]);const n=h===v,a=[["overlap","overlap-left"],["overlap","overlap-right"]];m.forEach(((e,t)=>{a[t].forEach((t=>e.classList.toggle(t,n)))})),b()}function b(){const t=h!==te||v!==re;f.forEach((({btn:n,type:a,timeout:r})=>{const o={...e,params:{...e.params,type:a,timeout:r,level_from:t?h+1:e.params.level_from,level_to:t?v+1:e.params.level_to}};c&&(o.params.qual=1);const s=S(o);n.setAttribute("href",s),n.onclick=e=>{e.preventDefault(),window.location.href=s}}))}function x(){se.saveRankRange(h,v)}return g.addEventListener("click",(e=>{const t=g.getBoundingClientRect(),n=(e.clientX-t.left)/t.width;let a=Math.round(n*(M.length-1));Math.abs(a-h)<Math.abs(a-v)?h=Math.min(ie(a,!0),v):v=Math.max(ie(a,!1),h),y(),x()})),m.forEach(((e,t)=>{e.addEventListener("mousedown",(e=>{e.preventDefault();let n=0===t?h:v;const a=({clientX:e})=>{const{left:a,width:r}=g.getBoundingClientRect();let o=Math.round((e-a)/r*(M.length-1));o=ie(o,0===t);const s=0===t?Math.min(o,v):Math.max(o,h);s!==n&&(n=s,0===t?h=s:v=s,y())},r=()=>{x(),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",r)}))})),g.appendChild(d),m.forEach((e=>g.appendChild(e))),p.appendChild(u),p.appendChild(g),o.appendChild(p),y(),Z.forEach((t=>{const n=w("div",{className:"popup-subheader",textContent:C[t]});o.appendChild(n);const a=w("div",{className:"timeouts-container"});L.forEach((n=>{if("normal"===t&&5===n)return;const r=h!==te||v!==re,o={...e,params:{...e.params,type:t,timeout:n,level_from:r?h+1:e.params.level_from,level_to:r?v+1:e.params.level_to}};c&&(o.params.qual=1);const s=S(o),i=w("a",{href:s,className:"game-popup-button",textContent:n});i.addEventListener("click",(e=>{e.preventDefault(),window.location.href=s})),f.push({btn:i,type:t,timeout:n}),a.appendChild(i)})),o.appendChild(a)})),function(e,t){e.style.visibility="hidden",document.body.appendChild(e),e.querySelectorAll("a").forEach((e=>{e.scrollWidth>e.clientWidth&&R(e,e.textContent)}));const n=(t,n)=>{const a=window.innerWidth,r=window.innerHeight,o=e.getBoundingClientRect(),s=a-o.width-oe,i=r-o.height-oe,l=Math.max(oe,Math.min(t,s)),c=Math.max(oe,Math.min(n,i));e.style.left=`${l}px`,e.style.top=`${c}px`};n(t.clientX,t.clientY),e.style.visibility="visible";const a={clickOutside:null,keydown:null,popupMouseDown:null,currentDrag:null};a.popupMouseDown=t=>{const r=e=>[".game-popup-button",".rank-slider-handle",".rank-slider-track",".rank-slider-range",".popup-header-qualification"].some((t=>e.matches&&(e.matches(t)||e.closest(t))));if(!(t=>{if(t===e)return!0;return[".popup-header",".popup-header-title",".popup-subheader",".rank-slider-display",".timeouts-container"].some((e=>t.matches&&t.matches(e)))})(t.target)||r(t.target))return;if(0!==t.button)return;t.preventDefault();const o=t.clientX,s=t.clientY,i=parseInt(e.style.left,oe),l=parseInt(e.style.top,oe),c=e=>{const t=e.clientX-o,a=e.clientY-s;n(i+t,l+a)},p=()=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",p),a.currentDrag=null};a.currentDrag={onMouseMove:c,onMouseUp:p},document.addEventListener("mousemove",c),document.addEventListener("mouseup",p)},e.addEventListener("mousedown",a.popupMouseDown),e.style.cursor="move";const r=t=>{t&&"keydown"===t.type&&"Escape"!==t.key||(a.clickOutside&&document.removeEventListener("click",a.clickOutside),a.keydown&&document.removeEventListener("keydown",a.keydown),a.popupMouseDown&&e.removeEventListener("mousedown",a.popupMouseDown),a.currentDrag&&(document.removeEventListener("mousemove",a.currentDrag.onMouseMove),document.removeEventListener("mouseup",a.currentDrag.onMouseUp)),e.remove())};a.clickOutside=t=>{e.contains(t.target)||r(t)},a.keydown=e=>{"Escape"===e.key&&r(e)},requestAnimationFrame((()=>{document.addEventListener("click",a.clickOutside),document.addEventListener("keydown",a.keydown)}))}(o,t),o}const ce={draggedElement:null,isDragging:!1,isRightHalf:!1,dragDirection:0,lastDragDirection:0,lastPanelDragY:0,dragOffset:{x:0,y:0},initialX:0,initialY:0,dragThreshold:1,rotationAccumulator:0,rotationDegreeLimit:5,globalEvents:{},reset(){this.draggedElement=null,this.isDragging=!1,this.isRightHalf=!1,this.dragDirection=0,this.lastDragDirection=0,this.lastPanelDragY=0,this.dragOffset={x:0,y:0},this.initialX=0,this.initialY=0,this.rotationAccumulator=0,this.globalEvents={}},cleanup(){this.globalEvents.handleDragMove&&document.removeEventListener("mousemove",this.globalEvents.handleDragMove),this.globalEvents.handleDragEnd&&document.removeEventListener("mouseup",this.globalEvents.handleDragEnd),this.globalEvents={}}};function pe(e){const t=e.getBoundingClientRect(),n=e.parentElement.getBoundingClientRect(),a=e.parentElement;return{element:{rect:t,width:e.offsetWidth,height:e.offsetHeight},parent:{rect:n,width:a.offsetWidth,height:a.offsetHeight}}}function ge(e,t){ce.cleanup(),t.addEventListener("mousedown",(n=>{if(n.preventDefault(),0!==n.button)return;if(n.target.closest(".latest-game-buttons"))return;ce.cleanup(),e.wasDragging=!1,ce.initialX=n.clientX,ce.initialY=n.clientY,ce.isDragging=!0,ce.draggedElement=t;const a=pe(t),r=n.clientX-a.element.rect.left;ce.isRightHalf=r>a.element.rect.width/2,ce.lastPanelDragY=n.clientY,ce.dragOffset={x:n.clientX-a.element.rect.left,y:n.clientY-a.element.rect.top},ce.globalEvents.handleDragMove=t=>function(e,t){if(!ce.isDragging||!ce.draggedElement)return;if(!t.wasDragging&&function(e){return Math.abs(e.clientX-ce.initialX)>ce.dragThreshold||Math.abs(e.clientY-ce.initialY)>ce.dragThreshold}(e)&&(t.wasDragging=!0,ce.draggedElement.classList.add("dragging"),"wrap"===t.getDisplayMode())){const e=pe(ce.draggedElement);ce.draggedElement.style.position="absolute",ce.draggedElement.style.left=e.element.rect.left-e.parent.rect.left+"px",ce.draggedElement.style.top=e.element.rect.top-e.parent.rect.top+"px",ce.draggedElement.style.width=`${e.element.rect.width}px`}e.preventDefault();const n=t.getDisplayMode(),a=document.getElementById("latest-games");"scroll"===n?function(e,t){const n=Array.from(t.querySelectorAll(".pin-game:not(.dragging)"));let a=null;for(const t of n){const n=t.getBoundingClientRect(),r=n.top+n.height/2;if(e.clientY<r)break;a=t}if(a)t.insertBefore(ce.draggedElement,a.nextSibling);else{const e=t.querySelector(".pin-game:not(.dragging)");e&&t.insertBefore(ce.draggedElement,e)}}(e,a):function(e,t){const n=pe(ce.draggedElement);let a=e.clientX-ce.dragOffset.x-n.parent.rect.left,r=e.clientY-ce.dragOffset.y-n.parent.rect.top;a=Math.max(0,Math.min(a,n.parent.width-n.element.width)),r=Math.max(0,Math.min(r,n.parent.height-n.element.height)),ce.draggedElement.style.left=`${a}px`,ce.draggedElement.style.top=`${r}px`;const o=Array.from(t.querySelectorAll(".pin-game:not(.dragging)"));let s=null,i=1/0;if(o.forEach((t=>{const n=t.getBoundingClientRect(),a=n.left+n.width/2,r=n.top+n.height/2,o=Math.hypot(e.clientX-a,e.clientY-r);o<i&&(i=o,s=t)})),s){const n=s.getBoundingClientRect();e.clientX<n.left+n.width/2?t.insertBefore(ce.draggedElement,s):t.insertBefore(ce.draggedElement,s.nextSibling)}}(e,a);const r=e.clientY,o=r-ce.lastPanelDragY;if(ce.lastPanelDragY=r,0!==o){const e=.2;ce.rotationAccumulator=(ce.rotationAccumulator||0)+(ce.isRightHalf?o:-o)*e,ce.rotationAccumulator=Math.max(-ce.rotationDegreeLimit,Math.min(ce.rotationDegreeLimit,ce.rotationAccumulator)),ce.draggedElement.style.transform=`rotate(${ce.rotationAccumulator}deg)`}}(t,e),ce.globalEvents.handleDragEnd=()=>function(e){if(ce.cleanup(),!ce.isDragging||!ce.draggedElement)return void ce.reset();ce.isDragging=!1,ce.draggedElement.classList.remove("dragging");const t=e.getDisplayMode();"wrap"===t&&(ce.draggedElement.style.position="",ce.draggedElement.style.left="",ce.draggedElement.style.top="",ce.draggedElement.style.width="");ce.draggedElement.style.transform="",e.updateGameOrderFromDOM(),ce.reset()}(e),document.addEventListener("mousemove",ce.globalEvents.handleDragMove),document.addEventListener("mouseup",ce.globalEvents.handleDragEnd)}))}class de{constructor(e){this.main=e}applyTheme(){document.documentElement.classList.remove("latest-games-light-theme","latest-games-dark-theme"),document.documentElement.classList.add("light"===this.main.currentTheme?"latest-games-light-theme":"latest-games-dark-theme"),this.updateThemeIcon()}updateThemeIcon(){const e=document.querySelector("#latest-games-container .theme-toggle");e&&(e.innerHTML="light"===this.main.currentTheme?r.sun:r.moon)}toggleTheme(e){this.main.currentTheme="light"===this.main.currentTheme?"dark":"light",R(e,"Изменить тему на "+("light"===this.main.currentTheme?"тёмную":"светлую")),this.main.saveSettings(),this.applyTheme()}createThemeToggle(){const e=w("div",{className:"theme-toggle control-button"});return e.innerHTML="light"===this.main.currentTheme?r.sun:r.moon,e.addEventListener("click",(()=>this.toggleTheme(e))),R(e,"Изменить тему на "+("light"===this.main.currentTheme?"тёмную":"светлую")),e}}class me{constructor(e){this.target=e}loadSettings(){try{const e=JSON.parse(localStorage.getItem("latestGamesSettings"))||{};this.target.maxGameCount=e.gamesLimit||5,this.target.currentTheme=e.theme||"light",this.target.displayMode=e.displayMode||"scroll",this.target.groupViewMode=e.groupViewMode||"tabs",this.target.previousScrollPosition=e.previousScrollPosition||0,this.target.panelYPosition=e.panelYPosition||0,this.target.panelWidth=e.panelWidth||"95vw",this.target.shouldAutoSave=!1!==e.shouldAutoSave,this.target.enableDragging=void 0===e.enableDragging||e.enableDragging,this.target.alwaysVisiblePanel=void 0!==e.alwaysVisiblePanel&&e.alwaysVisiblePanel,this.target.shouldStart=void 0!==e.shouldStart&&e.shouldStart,this.target.startDelay=void 0!==e.startDelay?e.startDelay:this.target.startDelay,this.target.shouldReplay=void 0!==e.shouldReplay&&e.shouldReplay,this.target.replayDelay=void 0!==e.replayDelay?e.replayDelay:this.target.replayDelay}catch(e){console.warn("Could not load latest games settings from localStorage:",e),this.target.maxGameCount=5,this.target.currentTheme="light",this.target.displayMode="scroll",this.target.groupViewMode="tabs",this.target.previousScrollPosition=0,this.target.panelYPosition=0,this.target.panelWidth="95vw",this.target.shouldAutoSave=!0,this.target.enableDragging=!0,this.target.alwaysVisiblePanel=!1,this.target.shouldStart=!1,this.target.startDelay=1e3,this.target.shouldReplay=!1,this.target.replayDelay=1e3}}saveSettings(){try{const e={gamesLimit:this.target.maxGameCount,theme:this.target.currentTheme,displayMode:this.target.displayMode,groupViewMode:this.target.groupViewMode,previousScrollPosition:this.target.previousScrollPosition,panelYPosition:this.target.panelYPosition,panelWidth:this.target.panelWidth,shouldAutoSave:this.target.shouldAutoSave,enableDragging:this.target.enableDragging,alwaysVisiblePanel:this.target.alwaysVisiblePanel,shouldStart:this.target.shouldStart,startDelay:this.target.startDelay,shouldReplay:this.target.shouldReplay,replayDelay:this.target.replayDelay};localStorage.setItem("latestGamesSettings",JSON.stringify(e))}catch(e){console.warn("Could not save latest games settings to localStorage:",e)}}}!function(){if(!document.getElementById("kg-latest-games-montserrat-font")){const e=document.createElement("link");e.id="kg-latest-games-montserrat-font",e.rel="stylesheet",e.href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap",document.head.appendChild(e)}}(),window.latestGamesManager??=new class{constructor(){this.initializeDefaults(),this.initializeManagers(),this.init()}initializeDefaults(){this.maxGameCount=5,this.currentTheme="light",this.displayMode="scroll",this.groupViewMode="tabs",this.previousScrollPosition=0,this.panelWidth="95vw",this.groups=[],this.currentGroupId=null,this.hoverTimeout=null,this.isHovered=!1,this.enableDragging=!0,this.wasDragging=!1,this.shouldAutoSave=!0,this.alwaysVisiblePanel=!1,this.panelYPosition=0,this.hidePanelDelay=1e3,this.shouldStart=!1,this.startDelay=1e3,this.shouldReplay=!1,this.replayDelay=1e3}initializeManagers(){this.themeManager=new de(this),this.settingsManager=new me(this)}init(){if(this.settingsManager.loadSettings(),this.loadGameData(),0===this.groups.length){const e=D("Группа-1");this.groups=[e],this.currentGroupId=e.id}else this.currentGroupId&&this.groups.some((e=>e.id===this.currentGroupId))||(this.currentGroupId=this.groups[0].id);this.createHoverArea(),this.createContainer(),this.alwaysVisiblePanel&&this.showContainer(),this.createPanelToggleButton(),this.handlePageSpecificLogic(),this.exposeGlobalFunctions(),this.themeManager.applyTheme()}createDisplayModeToggle(){const e=w("div",{className:"display-mode-toggle control-button"});return e.innerHTML="wrap"===this.displayMode?r.wrap:r.scroll,R(e,"wrap"===this.displayMode?"Переключить режим отображения в вертикальный вид":"Переключить режим отображения в горизонтальный вид"),e.addEventListener("click",(()=>{const t="scroll"===this.getDisplayMode()?"wrap":"scroll";if(this.setDisplayMode(t),this.updateDisplayModeIcon(e,t),this.updateDisplayModeClass(),R(e,"wrap"===t?"Переключить режим отображения в вертикальный вид":"Переключить режим отображения в горизонтальный вид"),"scroll"===t){const e=document.getElementById("latest-games-container");e&&setTimeout((()=>e.scrollTop=e.scrollHeight),0)}})),e}updateDisplayModeIcon(e,t){e.innerHTML="wrap"===t?r.wrap:r.scroll}getDisplayMode(){return this.displayMode}setDisplayMode(e){this.displayMode=e,this.settingsManager.saveSettings()}updateDisplayModeClass(){const e=document.getElementById("latest-games-container"),t=document.getElementById("latest-games");if(!e||!t)return;const n=this.getDisplayMode();e.classList.toggle("display-mode-wrap","wrap"===n),t.classList.toggle("display-mode-wrap","wrap"===n),this.updateContainerLeftOffset()}updateContainerLeftOffset(){const e=document.getElementById("latest-games-container");if(!e)return;const t=this.getDisplayMode();e.style.left="wrap"===t?"calc(-1 * (100vw - 100px))":"-330px"}createGameElement(e,t){const n=e.pin?` pin-gametype-${e.params.gametype}`:"",a=w("li",{className:`latest-game${e.pin?" pin-game":""}${n}`,id:`latest-game-${t}`}),o=w("div",{className:"latest-game-buttons"}),s=w("div",{className:"latest-game-pin",innerHTML:r.pin});R(s,e.pin?"Открепить":"Закрепить"),s.addEventListener("click",(()=>this.pinGame(t)));const i=w("div",{className:"latest-game-delete",innerHTML:r.delete});R(i,"Удалить"),i.addEventListener("click",(()=>this.deleteGame(t))),o.appendChild(s),o.appendChild(i);const l=w("a",{href:S(e),innerHTML:G(e)});return l.addEventListener("click",(e=>{this.wasDragging&&(e.preventDefault(),this.wasDragging=!1)})),R(l,"\n      [Клик] Перейти к игре с текущими параметрами\n      [Shift + Клик] Перейти к игре с альтернативными параметрами\n      [Удерживание (ЛКМ)] аналогично (Shift + Клик)\n    "),a.appendChild(o),a.appendChild(l),e.pin&&this.enableDragging&&ge(this,a),a}createGroupViewToggle(){const e=w("div",{className:"group-view-toggle control-button"});return e.innerHTML="tabs"===this.groupViewMode?r.wrap:r.scroll,R(e,"tabs"===this.groupViewMode?"Переключить в единый вид со всеми играми":"Переключить в режим вкладок по группам"),e.addEventListener("click",(()=>{this.groupViewMode="tabs"===this.groupViewMode?"unified":"tabs",this.settingsManager.saveSettings(),this.updateGroupViewToggle(e),this.refreshContainer()})),e}updateGroupViewToggle(e){e.innerHTML="tabs"===this.groupViewMode?r.wrap:r.scroll,R(e,"tabs"===this.groupViewMode?"Переключить в единый вид со всеми играми":"Переключить в режим вкладок по группам")}moveGroup(e){const t=this.groups.findIndex((e=>e.id===this.currentGroupId));if(-1===t)return;const n=t+e;if(n<0||n>=this.groups.length)return;const a=this.groups[t];this.groups[t]=this.groups[n],this.groups[n]=a,this.saveGameData(),this.refreshContainer()}updateGroupControlStates(){const e=document.querySelector(".move-group-left"),t=document.querySelector(".move-group-right");if(e&&t){const n=this.groups.findIndex((e=>e.id===this.currentGroupId)),a=0===n,r=n===this.groups.length-1;e.classList.toggle("latest-games-disabled",a),t.classList.toggle("latest-games-disabled",r)}}createGroupHeader(e){const t=w("div",{className:"group-header "+(e.id===this.currentGroupId?"active":""),textContent:e.title,dataset:{groupId:e.id}});return t.addEventListener("click",(()=>{this.selectGroup(e.id)})),t}createGroupsContainer(){const e=w("div",{id:"latest-games-groups"}),t=w("div",{className:"group-controls"+("unified"===this.groupViewMode?" unified-controls":"")}),n=w("span",{className:"add-group control-button",innerHTML:r.addGroup});R(n,"Добавить группу"),n.addEventListener("click",(()=>this.addGroup()));const a=w("span",{className:"rename-group control-button",innerHTML:r.renameGroup});R(a,"Переименовать группу"),a.addEventListener("click",(()=>this.renameCurrentGroup()));const o=w("span",{className:"remove-group control-button",innerHTML:r.trashNothing});R(o,"Удалить группу"),o.addEventListener("click",(()=>this.removeCurrentGroup()));const s=this.createGroupViewToggle(),i=w("span",{className:"move-group-left control-button",innerHTML:r.decrease});R(i,"Переместить вкладку назад"),i.addEventListener("click",(()=>{i.classList.contains("latest-games-disabled")||this.moveGroup(-1)}));const l=w("span",{className:"move-group-right control-button",innerHTML:r.increase});R(l,"Переместить вкладку вперёд"),l.addEventListener("click",(()=>{l.classList.contains("latest-games-disabled")||this.moveGroup(1)})),t.append(n,a,o,s,i,l),e.appendChild(t);const c=w("div",{className:"tabs-container"});return this.groups.forEach((e=>{const t=w("span",{className:"group-tab "+(e.id===this.currentGroupId?"active":""),textContent:e.title,dataset:{groupId:e.id}});t.addEventListener("click",(()=>{this.selectGroup(e.id)})),c.appendChild(t)})),"unified"===this.groupViewMode&&c.classList.add("latest-games-hidden"),e.appendChild(c),e}isCyrillic(e){const t=e.charCodeAt(0);return t>=1040&&t<=1103||1025===t||1105===t}compareGameNames(e,t){const n=G(e).toLowerCase(),a=G(t).toLowerCase(),r=this.isCyrillic(n[0]),o=this.isCyrillic(a[0]);return r&&!o?-1:!r&&o?1:n.localeCompare(a,"ru")}sortCurrentGroupGames(){const e=T(this.groups,this.currentGroupId);if(!e)return;const t=e.games.filter((e=>e.pin)),n=e.games.filter((e=>!e.pin));t.sort(((e,t)=>this.compareGameNames(e,t))),n.sort(((e,t)=>this.compareGameNames(e,t))),e.games=[...t,...n],this.saveGameData(),this.refreshContainer()}createControls(){const e=w("div",{className:"latest-games-controls"}),t=w("div",{className:"controls-limiter"}),n=w("div",{className:"controls-buttons"});e.append(t,n);const a=w("span",{id:"latest-games-options"}),o=w("span",{id:"latest-games-count-dec",className:"control-button",innerHTML:r.decrease});R(o,"Уменьшить количество сохраняемых игр");const s=w("span",{id:"latest-games-count",className:!1===this.shouldAutoSave?"latest-games-disabled":"",textContent:this.maxGameCount.toString()});R(s,this.shouldAutoSave?"Автосохранение включено":"Автосохранение отключено"),s.addEventListener("click",(()=>{this.shouldAutoSave=!this.shouldAutoSave,this.updateGameCountDisplay(),this.settingsManager.saveSettings(),this.refreshContainer()}));const i=w("span",{id:"latest-games-count-inc",className:"control-button",innerHTML:r.increase});R(i,"Увеличить количество сохраняемых игр"),o.addEventListener("click",(()=>this.changeGameCount(-1))),i.addEventListener("click",(()=>this.changeGameCount(1))),a.append(o,s,i);const l=(e,t,n,a,r,o)=>{R(e,`\n        [Клик] ${t?n:a}\n        [Shift + Клик] ${o+(r?` (${r} мс)`:"")}\n      `)},c=(e,t,n,a,r)=>{const{enabledText:o,disabledText:s,delayText:i,delayPromptText:c,delayErrorText:p}=r,g=t[n];e.classList.toggle("latest-games-disabled",!g),l(e,g,o,s,t[a],i),e.onclick=r=>{if(r.shiftKey){const r=prompt(c,"");if(null!==r){const c=parseInt(r,10);!isNaN(c)&&c>=0?(t[a]=c,this.settingsManager.saveSettings(),l(e,t[n],o,s,c,i)):alert(p)}}else t[n]=!t[n],this.settingsManager.saveSettings(),e.classList.toggle("latest-games-disabled",!t[n]),l(e,t[n],o,s,t[a],i)}},p=w("span",{className:"latest-games-play control-button",innerHTML:r.play});c(p,this,"shouldStart","startDelay",{enabledText:"Отключить автозапуск игры",disabledText:"Включить автозапуск игры",delayText:"Изменить задержку запуска в миллисекундах",delayPromptText:"Введите задержку запуска в миллисекундах:",delayErrorText:"Пожалуйста, введите корректное значение задержки запуска."});const g=w("span",{className:"latest-games-replay control-button",innerHTML:r.replay});c(g,this,"shouldReplay","replayDelay",{enabledText:"Отключить автоповтор игры",disabledText:"Включить автоповтор игры",delayText:"Изменить задержку автоповтора в миллисекундах",delayPromptText:"Введите задержку автоповтора в миллисекундах:",delayErrorText:"Пожалуйста, введите корректное значение задержки автоповтора."});const d=w("span",{className:"latest-games-pinall control-button",innerHTML:r.pinAll});R(d,"\n      [Клик] Закрепить все игры в текущей группе\n      [Shift + Клик] Закрепить все игры во всех группах\n    "),d.onclick=e=>{if(e.shiftKey)this.groups.forEach((e=>e.games.forEach((e=>e.pin=1))));else{const e=T(this.groups,this.currentGroupId);e&&e.games.forEach((e=>e.pin=1))}this.saveGameData(),this.refreshContainer()};const m=w("span",{className:"latest-games-unpinall control-button",innerHTML:r.unpinAll});R(m,"\n      [Клик] Открепить все игры в текущей группе\n      [Shift + Клик] Открепить все игры во всех группах\n    "),m.onclick=e=>{if(e.shiftKey)this.groups.forEach((e=>e.games.forEach((e=>e.pin=0))));else{const e=T(this.groups,this.currentGroupId);e&&e.games.forEach((e=>e.pin=0))}this.saveGameData(),this.refreshContainer()};const u=w("span",{className:"latest-games-sort control-button",innerHTML:r.sort});R(u,"Сортировать игры в текущей группе по алфавиту"),u.addEventListener("click",(()=>this.sortCurrentGroupGames()));const h=w("span",{className:"latest-games-import control-button",innerHTML:r.import});R(h,"Импортировать настройки из JSON файла"),h.onclick=async()=>{const e=document.createElement("input");e.type="file",e.accept=".json,application/json",e.style.display="none",e.onchange=async e=>{const t=e.target.files[0];if(t)try{const e=await t.text(),n=JSON.parse(e);"object"==typeof n&&null!==n?(n.latestGamesSettings&&localStorage.setItem("latestGamesSettings",JSON.stringify(n.latestGamesSettings)),n.latestGamesData&&localStorage.setItem("latestGamesData",JSON.stringify(n.latestGamesData)),this.loadSettings(),this.loadGameData(),this.refreshContainer(),this.themeManager.applyTheme()):alert("Файл не содержит валидный JSON настроек.")}catch(e){alert("Ошибка при импорте: "+e)}},document.body.appendChild(e),e.click(),setTimeout((()=>e.remove()),1e3)};const v=w("span",{className:"latest-games-export control-button",innerHTML:r.export});R(v,"Экспортировать все настройки в JSON файл"),v.onclick=()=>{const e={latestGamesSettings:JSON.parse(localStorage.getItem("latestGamesSettings")||"{}"),latestGamesData:{groups:this.groups,currentGroupId:this.currentGroupId}},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="kg-latest-games-settings.json",document.body.appendChild(a),a.click(),setTimeout((()=>{URL.revokeObjectURL(n),a.remove()}),1e3)};const f=w("span",{className:"latest-games-removeall control-button",innerHTML:r.trashNothing});R(f,"Удалить все настройки"),f.onclick=()=>{localStorage.removeItem("latestGamesSettings"),localStorage.removeItem("latestGamesData"),this.groups=[D("Группа-1")],this.currentGroupId=this.groups[0].id,this.saveGameData(),this.refreshContainer()};const y=w("span",{className:"latest-games-remove-unpinned control-button",innerHTML:r.broom});R(y,"\n      [Клик] Удалить все незакреплённые игры в текущей группе\n      [Shift + Клик] Удалить все незакреплённые игры во всех группах\n    "),y.onclick=e=>{if(e.shiftKey)this.groups.forEach((e=>{e.games=e.games.filter((e=>e.pin))}));else{const e=T(this.groups,this.currentGroupId);e&&(e.games=e.games.filter((e=>e.pin)))}this.saveGameData(),this.refreshContainer()};const b=w("span",{className:"latest-games-drag-toggle control-button",innerHTML:r.dragToggle});return R(b,this.enableDragging?"Перетаскивание включено":"Перетаскивание отключено"),b.classList.toggle("latest-games-disabled",!this.enableDragging),b.onclick=()=>{this.enableDragging=!this.enableDragging,this.settingsManager.saveSettings(),this.refreshContainer(),R(b,this.enableDragging?"Перетаскивание включено":"Перетаскивание отключено"),b.classList.toggle("latest-games-disabled",!this.enableDragging)},t.appendChild(a),n.append(this.themeManager.createThemeToggle(),this.createDisplayModeToggle(),p,g,d,m,u,h,v,f,y,b),e}updateContainerYPosition(){const e=document.getElementById("latest-games-container");e&&(e.style.top="wrap"===this.getDisplayMode()?`${this.panelYPosition}vh`:"")}createContainer(){const e=w("div",{id:"latest-games-container"}),t=this.createGroupsContainer();e.appendChild(t);const n=w("ul",{id:"latest-games"});this.populateGamesList(n),e.appendChild(n);const a=this.createControls();e.appendChild(a),e.addEventListener("scroll",(()=>{this.previousScrollPosition=e.scrollTop,this.saveSettings()})),e.addEventListener("mouseenter",(()=>this.showContainer())),e.addEventListener("mouseleave",(()=>this.hideContainer()));let r=null,o=!1;const s=e=>{const t=e.target.closest(".latest-game");if(!t)return;const n=t.id.replace("latest-game-",""),a=this.findGameById(n);a&&!this.enableDragging&&le(a,e)};n.addEventListener("mousedown",(e=>{0===e.button&&(e.shiftKey?(o=!0,e.preventDefault(),s(e)):r=setTimeout((()=>{o=!0,e.preventDefault(),s(e)}),300))})),n.addEventListener("mouseup",(()=>{clearTimeout(r)})),n.addEventListener("click",(e=>{o&&(e.stopImmediatePropagation(),e.preventDefault(),o=!1)}),{capture:!0}),n.addEventListener("contextmenu",(e=>{const t=e.target.closest(".latest-game");if(t){e.preventDefault();const n=t.id.replace("latest-game-","");!function(e,t,n,a,r){j();const o=t.filter((e=>e.id!==n)).map((t=>({text:t.title,className:"group-tab",dataset:{groupId:t.id},onClick:()=>{!function(e,t,n){const a=e.groups.find((t=>t.id===e.currentGroupId)),r=e.groups.find((e=>e.id===n));if(!a||!r)return;const o=a.games.findIndex((e=>e.id===t));if(-1===o)return;const[s]=a.games.splice(o,1);r.games.push(s),e.saveGameData(),e.refreshContainer()}(e,r,t.id)}})));z(o,a,"game-migration-popup","Переместить")}(this,this.groups,this.currentGroupId,e,n)}}));let i=e.querySelector(".resize-handle");i||(i=w("div",{className:"resize-handle"}),e.appendChild(i));const l=()=>{if("wrap"===this.getDisplayMode()){e.style.width=this.panelWidth,i.style.display="";let t,n,a=!1;const r=r=>{if(!a)return;const o=r.clientX-t;let s=n+o;const i=.95*window.innerWidth;s=Math.max(350,Math.min(s,i));const l=Math.round(s/window.innerWidth*100*10)/10;e.style.width=`${l}vw`},o=()=>{a&&(a=!1,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o),this.panelWidth=e.style.width,this.settingsManager.saveSettings())};i.onmousedown=s=>{0===s.button&&(a=!0,t=s.clientX,n=e.offsetWidth,document.addEventListener("mousemove",r),document.addEventListener("mouseup",o),s.preventDefault())}}else i.style.display="none",e.style.width="",i.onmousedown=null};l();const c=()=>{if("wrap"===this.getDisplayMode()){this.updateContainerYPosition();let t,n,a=!1;const r=r=>{if(!a)return;const o=r.clientY-t,s=n+o/window.innerHeight*100,i=e.offsetHeight,l=Math.max(0,(window.innerHeight-i)/window.innerHeight*100),c=Math.max(0,Math.min(s,l)),p=Math.round(10*c)/10;e.style.top=`${p}vh`},o=()=>{if(!a)return;a=!1,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o);const t=e.getBoundingClientRect();this.panelYPosition=Math.round(t.top/window.innerHeight*100*10)/10,this.settingsManager.saveSettings()},s=s=>{if(0!==s.button)return;if(s.target.closest(".latest-game, .group-tab, .control-button, .resize-handle"))return;a=!0,t=s.clientY;const i=e.getBoundingClientRect();n=i.top/window.innerHeight*100,document.addEventListener("mousemove",r),document.addEventListener("mouseup",o),s.preventDefault()};e.addEventListener("mousedown",s)}else e.style.top=""};c(),document.body.appendChild(e),this.updateGroupControlStates(),this.updateDisplayModeClass();e.querySelectorAll(".group-tab").forEach((e=>{e.getBoundingClientRect().width>=300&&R(e,e.textContent)}));const p=this.updateDisplayModeClass.bind(this);this.updateDisplayModeClass=(...e)=>{p(...e),l(),c()},this.updateRemoveIcons(),e.scrollTop=this.previousScrollPosition}updateGameCountDisplay(){const e=document.getElementById("latest-games-count");e&&(e.textContent=this.maxGameCount.toString(),e.classList.toggle("latest-games-disabled",!1===this.shouldAutoSave),R(e,this.shouldAutoSave?"Автосохранение включено":"Автосохранение отключено"))}loadGameData(){try{let e=localStorage.getItem("latestGamesData");e?(e=JSON.parse(e),Array.isArray(e)?(this.groups=[{id:b(),title:"Группа-1",games:e}],this.currentGroupId=this.groups[0].id):e&&Array.isArray(e.groups)?(this.groups=e.groups,this.currentGroupId=e.currentGroupId):(this.groups=[],this.currentGroupId=null)):(this.groups=[],this.currentGroupId=null),this.migrateOldGameData(),this.assignGameIds()}catch(e){console.warn("Could not load game data from localStorage:",e),this.groups=[],this.currentGroupId=null}}migrateOldGameData(){this.groups.forEach((e=>{e.games=e.games.map((e=>("on"!==e.params.qual&&""!==e.params.qual||(e.params.qual="on"===e.params.qual?1:0),e)))}))}assignGameIds(){const e=new Set(this.groups.flatMap((e=>e.games.map((e=>e.id)))));this.groups.forEach((t=>{t.games=t.games.map((t=>{if(!t.id||-1===t.id||e.has(t.id)){let n;do{n=b()}while(e.has(n));return e.add(n),{...t,id:n}}return e.add(t.id),t}))}))}saveGameData(){try{const e={groups:this.groups,currentGroupId:this.currentGroupId};localStorage.setItem("latestGamesData",JSON.stringify(e))}catch(e){console.warn("Could not save game data to localStorage:",e)}}updateGameOrderFromDOM(){const e=T(this.groups,this.currentGroupId);if(!e)return;const t=Array.from(document.querySelectorAll("#latest-games .latest-game"));e.games=t.map((t=>{const n=t.id.replace("latest-game-","");return e.games.find((e=>e.id===n))})).filter((e=>void 0!==e)),this.saveGameData()}getPinnedGameCount(){const e=T(this.groups,this.currentGroupId);return e?e.games.filter((e=>e.pin)).length:0}createHoverArea(){const e=w("div",{id:"latest-games-hover-area"});e.addEventListener("mouseenter",(()=>this.showContainer())),e.addEventListener("mouseleave",(()=>this.hideContainer())),document.body.appendChild(e)}populateGamesList(e){if(e.innerHTML="","tabs"===this.groupViewMode){const t=T(this.groups,this.currentGroupId);if(!t)return;const n=this.getPinnedGameCount(),a=Math.min(t.games.length,this.maxGameCount+n);for(let n=0;n<a;n++){const a=t.games[n],r=this.createGameElement(a,a.id);e.appendChild(r)}}else this.groups.forEach((t=>{if(t.games.length>0){const n=this.createGroupHeader(t);e.appendChild(n);const a=t.games.filter((e=>e.pin)).length,r=Math.min(t.games.length,this.maxGameCount+a);for(let n=0;n<r;n++){const a=t.games[n],r=this.createGameElement(a,a.id);e.appendChild(r)}}}))}showContainer(){this.isHovered=!0,this.hoverTimeout&&clearTimeout(this.hoverTimeout),this.hoverTimeout=null;const e=document.getElementById("latest-games-container");e&&(e.classList.add("visible"),e.style.left="0","wrap"===this.getDisplayMode()&&(e.style.top=`${this.panelYPosition}vh`),e.scrollTop=this.previousScrollPosition)}hideContainer(){this.alwaysVisiblePanel||(this.isHovered=!1,this.hoverTimeout&&clearTimeout(this.hoverTimeout),this.hoverTimeout=setTimeout((()=>{if(!this.isHovered){const e=document.getElementById("latest-games-container");e&&(e.classList.remove("visible"),this.updateContainerLeftOffset())}}),this.hidePanelDelay))}updateRemoveIcons(){const e=T(this.groups,this.currentGroupId),t=document.querySelector(".group-controls .remove-group.control-button");t&&(t.innerHTML=e&&e.games&&e.games.length>0?r.trashSomething:r.trashNothing);const n=document.querySelector(".latest-games-removeall.control-button"),a=this.groups.some((e=>e.games&&e.games.length>0));n&&(n.innerHTML=a?r.trashSomething:r.trashNothing)}refreshContainer(){const e=document.getElementById("latest-games-groups");if(e){const t=e.querySelector(".group-controls");t&&(t.className="group-controls"+("unified"===this.groupViewMode?" unified-controls":""));const n=e.querySelector(".tabs-container");n&&(n.innerHTML="","tabs"===this.groupViewMode?(this.groups.forEach((e=>{const t=w("span",{className:"group-tab "+(e.id===this.currentGroupId?"active":""),textContent:e.title,dataset:{groupId:e.id}});t.addEventListener("click",(()=>this.selectGroup(e.id))),n.appendChild(t)})),n.classList.remove("latest-games-hidden")):n.classList.add("latest-games-hidden"))}const t=document.getElementById("latest-games");t&&(this.populateGamesList(t),this.updateDisplayModeClass()),this.updateRemoveIcons(),this.updateGameCountDisplay(),this.updateGroupControlStates()}updateActiveGroup(){document.querySelectorAll(".group-header").forEach((e=>e.classList.toggle("active",e.dataset.groupId===this.currentGroupId))),document.querySelectorAll(".group-tab").forEach((e=>e.classList.toggle("active",e.dataset.groupId===this.currentGroupId)))}selectGroup(e){this.groups.some((t=>t.id===e))&&(this.currentGroupId=e,this.saveGameData(),this.updateActiveGroup(),this.refreshContainer())}addGroup(){const e=D(prompt("Введите название группы:")?.trim()||null,this.groups);this.groups.push(e),this.currentGroupId=e.id,this.saveGameData(),this.refreshContainer()}renameCurrentGroup(){const e=prompt("Введите новое название группы:",T(this.groups,this.currentGroupId)?.title)?.trim();e&&(!function(e,t,n){const a=e.find((e=>e.id===t));a&&(a.title=n)}(this.groups,this.currentGroupId,e),this.saveGameData(),this.refreshContainer())}removeCurrentGroup(){this.groups.length<=1?alert("Нельзя удалить последнюю группу."):(this.groups=function(e,t){const n=e.findIndex((e=>e.id===t));return-1!==n&&e.splice(n,1),e}(this.groups,this.currentGroupId),this.currentGroupId=this.groups[0].id,this.saveGameData(),this.refreshContainer())}findGameIndex(e){for(const t of this.groups){const n=t.games.findIndex((t=>t.id==e));if(-1!==n)return{group:t,index:n}}return null}findGameById(e){for(const t of this.groups){const n=t.games.find((t=>t.id===e));if(n)return n}return null}deleteGame(e){const t=this.findGameIndex(e);if(!t)return null;const{group:n,index:a}=t,r=n.games.splice(a,1)[0];return this.assignGameIds(),this.saveGameData(),this.refreshContainer(),r}pinGame(e){const t=this.findGameIndex(e);if(!t)return;const{group:n,index:a}=t,r=n.games[a];r.pin=r.pin?0:1,n.games.sort(((e,t)=>t.pin-e.pin)),this.assignGameIds(),this.saveGameData(),this.refreshContainer()}saveCurrentGameParams(){const e=document.getElementById("gamedesc");if(!e)throw new Error("#gamedesc element not found.");const t=e.querySelector("span");if(!t)throw new Error("#gamedesc span element not found.");const n=e.textContent;if(/соревнование/.test(n)||!this.maxGameCount||!1===this.shouldAutoSave)return!1;const a=function(e,t){const n=e.className.split("-").pop(),a="voc"===n?e.textContent.replace(/[«»]/g,""):"";let r="";if("voc"===n){const t=e.querySelector("a");if(t){const e=t.href.match(/vocs\/(\d+)/);r=e?parseInt(e[1],10):""}}let o="normal";/одиночный/.test(t)?o="practice":/друзьями/.test(t)&&(o="private");let s=1,i=9;const l=t.match(/для (\S+)–(\S+),/);l&&(s=E[l[1]]||1,i=E[l[2]]||9);const c=t.match(/таймаут\s(\d+)\s(сек|мин)/);return{gametype:n,vocName:a,vocId:r,type:o,level_from:s,level_to:i,timeout:c?"сек"===c[2]?parseInt(c[1],10):60*parseInt(c[1],10):60,qual:/квалификация/.test(t)?1:0,premium_abra:0}}(t,n),r=JSON.stringify(a),o=T(this.groups,this.currentGroupId);if(!o)return;if(o.games.some((e=>JSON.stringify(e.params)===r)))return;const s={params:a,id:b(),pin:0},i=o.games.filter((e=>e.pin)).length;o.games.splice(i,0,s);const l=i+this.maxGameCount;o.games.length>l&&o.games.splice(l,o.games.length-l),this.assignGameIds(),this.saveGameData()}handleGameActions(){if(this.shouldStart){const e=document.querySelector("#status-inner #paused");e&&"none"!==e.style.display&&"undefined"!=typeof game&&game.hostStart&&x(this.startDelay).then((()=>{game.hostStart()}))}if(this.shouldReplay){const e=document.querySelector("#status-inner #finished");if(e&&"none"!==e.style.display){const e=location.href.match(/gmid=(\d+)/);if(e){const t=e[1];x(this.replayDelay).then((()=>{window.location.href=`https://klavogonki.ru/g/${t}.replay`}))}}}}changeGameCount(e){e<0&&this.maxGameCount>0?this.maxGameCount--:e>0&&this.maxGameCount++,this.updateGameCountDisplay(),this.settingsManager.saveSettings(),this.refreshContainer()}handlePageSpecificLogic(){const{href:e}=location;if(/https?:\/\/klavogonki\.ru\/g\/\?gmid=/.test(e)){const e=new MutationObserver((()=>{const t=document.querySelector("#gamedesc");t&&t.textContent&&(e.disconnect(),this.saveCurrentGameParams(),this.handleGameActions())}));e.observe(document.body,{childList:!0,subtree:!0});const t=document.getElementById("finished");if(t){const e=new MutationObserver((()=>{e.disconnect(),this.handleGameActions()}));e.observe(t,{attributes:!0})}}/klavogonki\.ru\/vocs\//.test(e)&&(V(this.groups),Q(this.groups,this),K())}exposeGlobalFunctions(){window.latestGamesManager=this}createPanelToggleButton(){if(document.getElementById("latest-games-panel-toggle"))return;const e=w("button",{id:"latest-games-panel-toggle",className:"latest-games-panel-toggle",type:"button",innerHTML:this.alwaysVisiblePanel?r.panelToggleOpened:r.panelToggleClosed});R(e,"\n      [Клик] (Показать/Скрыть) панель\n      [Shift + Клик] (Закрепить/Открепить) панель"),this.alwaysVisiblePanel&&e.classList.add("always-visible"),e.addEventListener("click",(t=>{const n=document.getElementById("latest-games-container");if(n)if(t.shiftKey)this.alwaysVisiblePanel=!this.alwaysVisiblePanel,e.classList.toggle("always-visible",this.alwaysVisiblePanel),e.innerHTML=this.alwaysVisiblePanel?r.panelToggleOpened:r.panelToggleClosed,n.classList.toggle("visible",this.alwaysVisiblePanel),this.alwaysVisiblePanel||this.updateContainerLeftOffset(),this.settingsManager.saveSettings();else{n.classList.contains("visible")?(this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null),n.classList.remove("visible"),this.updateContainerLeftOffset()):this.showContainer()}})),document.body.appendChild(e)}}})();